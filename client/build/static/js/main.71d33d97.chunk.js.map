{"version":3,"sources":["logo.svg","config.js","ContextProvider.js","ImagePlugin.js","BoldPlugin.js","EmojiPlugin.js","MentionPlugin.js","DeleteBlogPlugin.js","DraftEditor.js","LinkPlugin.js","BackColorPlugin.js","Content.js","App.js","reportWebVitals.js","index.js"],"names":["url","Context","createContext","breakpoints","createBreakpoints","breakpointsAttribute","xs","sm","md","lg","xl","args","forEach","item","only","ContextProvider","props","useState","EditorState","createWithContent","ContentState","createFromText","editorContent","setEditorContent","isLight","setIsLight","picArr","setPicArr","postArr","setPostArr","postPicArr","setPostPicArr","postCount","useRef","getSinglePost","useCallback","num","current","axios","get","then","response","console","log","data","pre","map","content","sizeArr","iconSizeArr","useEffect","theme","useMemo","muiTheme","createTheme","backgourndImageArr","backgroundImage","color","palette","primary","primaryColor","type","typography","fontSize","button","textTransform","body2","overrides","MuiAvatar","root","MuiSvgIcon","MuiChip","marginLeft","marginRight","objectFit","textAlign","label","mentionBackColor","light","useMediaQuery","deviceSize","Provider","value","lgSizeObj","smSizeObj","ThemeProvider","children","genKey","length","result","characters","charactersLength","i","charAt","Math","floor","random","BoldButton","makeBold","isBoldOn","setIsBoldOn","editor","styleType","useTheme","Button","style","backgroundColor","main","contrastText","text","secondary","onClick","e","focus","FormatBold","ItalicButton","isItalicOn","setIsItalicOn","FormatItalic","UnderlineButton","isUnderlineOn","setIsUnderlineOn","FormatUnderlined","EmojiButton","isEmojiPanelOn","setIsEmojiPanelOn","InsertEmoticon","EmojiPanel","emoji","insertEmoji","Paper","maxWidth","overflow","marginTop","maxHeight","transitionProperty","transitionDuration","opacity","marginBottom","spacing","Object","keys","icon","index","variant","Avatar","src","replace","transform","borderRadius","useStyles","makeStyles","mentionHeadAvatar","position","top","left","mentionHeadRoot","borderTopRightRadius","borderBottomRightRadius","height","mentionBodyRoot","borderTopLeftRadius","borderBottomLeftRadius","mentionBodyRoot2","boxShadow","shadows","mentionHeadLabel","paddingLeft","paddingRight","borderStyle","mentionHeadLabel2","mentionBodyLabel","externalES","externalSetEditorState","setOn","getSelection","isCollapsed","selection","toArray","anchorKey","anchorOffset","focusKey","focusOffset","styleObj","getCurrentInlineStyle","toObject","newContent","Modifier","replaceText","getCurrentContent","newSelection","merge","isBackward","hasFocus","applyInlineStyle","push","acceptSelection","RichUtils","toggleInlineStyle","makeLarge","insertText","removeInlineStyle","LARGE","SMALL","boldPlugin","onChange","editorState","setEditorState","LargeButton","isLargeOn","setIsLargeOn","TextFieldsOutlined","SmallButton","isSmallOn","setIsSmallOn","FormatSize","createBoldPlugin","emojiUrl","anchorStartKey","anchorStartOffset","emojiPlugin","oldSelection","getBlocksAsArray","block","blockKey","blockText","itemEntityKey","getEntity","getType","applyEntity","emojiKey","matchArr","regx","RegExp","array","exec","start","offset","entityKey","createEntity","symbol","getLastCreatedEntityKey","taggingEmoji","decorators","strategy","contentBlock","callback","contentState","findEntityRanges","character","component","offsetKey","end","decoratedText","iconRef","ref","className","backgroundRepeat","backgroundPosition","backgroundSize","display","isMobile","clipPath","createEmojiPlugin","removeImageBlog","selectionBefore","getSelectionBefore","selectionAfter","getSelectionAfter","imageBlog","find","newContentBlockArr","filter","imageBLogKey","getKey","createEmpty","setTimeout","getBlockForKey","createFromBlockArray","hasImageBlock","getEndKey","getBlockMap","findIndex","ImageBlog","picNum","imgArr","width","paddingBottom","divider","backgroundPositionX","backgroundPositionY","localUrl","ImageButton","inputRef","action","disabled","click","AddPhotoAlternateOutlined","currentTarget","files","name","trim","match","file","URL","createObjectURL","currentKey","currentIndex","key","splice","ContentBlock","insertImageBlock","TopImageButton","sort","itemA","itemB","topImage","Image","imagePlugin","createImagePlugin","friendsList","friendObj","friendName","responseType","onDownloadProgress","progressEvent","base64","btoa","Uint8Array","reduce","byte","String","fromCharCode","headers","tabIndex","Panel","inMentionPanel","setOpacity","mentionHeadKey","mentionBodyKey","elevation","contentEditable","suppressContentEditableWarning","zIndex","flexDirection","Chip","classes","disabledBackground","cursor","avatar","alt","onMouseDown","insertMention","Typography","mentionBodyText","getData","person","hasOnAtTag","isAtOn","getCharacterList","tagKey","mentionType","indexOf","mentionPlugin","handleBeforeInput","chars","evenTimeStamp","anchorFocusOffset","isFirefox","handleReturn","newState","insertSoftNewline","keyBindingFn","getEditorState","keyCode","handleKeyCommand","command","hasfocus","anchorFocusKey","contentLenth","contentFocusAt","shortMentionOff","longMentionOnAt","longMentionOnOther","longMentionOff","createTag","tagName","mergeEntityData","substring","imgurl","taggingMention","size","MentionButton","isMentionPanelOn","setIsMentionPanelOn","AlternateEmailSharp","MentionPanel","createMentionPlugin","linkPlugin","getText","entityType","getStyle","includes","linkAddress","linkHost","linkOff","linkType","taggingLink","Link","createLinkPlugin","addTopLine","isTopLine","currentBlock","centerBlock","pos","currentType","setBlockType","DeleteBlogButton","deleteBlock","DeleteOutlineOutlined","AddTopLineButton","HorizontalSplitOutlined","AddBottomLineButton","AlignCenterButton","isCenterOn","setIsCenterOn","FormatAlignCenter","AlignRightButton","isRightOn","setIsRightOn","FormatAlignRight","AddBackColorButton","addBackColor","PaletteOutlined","BackColorPanel","deleteBlogPlugin","createDeleteBlogPlugin","isBackColorPanelOn","setIsBackColorPanelOn","backImageArr","setBackImageArr","backImageIndex","setBackImageIndex","Box","justifyContent","img","imgUrl","textColor","setBlockData","backColorPlugin","blockStyleFn","createBackColorPlugin","obj","element","editorPaperCss","borderWidth","borderColor","isEditorFocusOn","wordBreak","whiteSpace","lineBreak","unstyledBlockCss","imageBlockCss","margin","padding","centerBlockCss","rightBlockCss","colorBlockCss","alignItems","className1","background","initialState","entityMap","blocks","DraftEditor","useContext","setIsEditorFocusOn","restCss","convertFromRaw","toPreHtml","postID","preHtml","stateToHTML","defaultBlockTag","inlineStyles","attributes","colorblock","backimage","toJS","textcolor","blockRenderers","imageBlock","escape","entityStyleFn","entity","mutablity","moveFocusToEnd","Container","disableGutters","flexWrap","gap","ButtonGroup","Brightness5","Brightness4","editorState_","moveSelectionToEnd","forceSelection","BOLD","ITALIC","UNDERLINE","getFocusKey","Boolean","plugins","preserveSelectionOnBlur","customStyleMap","Immutable","Map","customStyleFn","styleNames","CENTER","blockRenderMap","blockRendererFn","editable","post","ownerName","FormData","picName","pic","picID","append","JSON","stringify","Content","mentionStyles","toHtml","inView","ReactHtmlParser","transformFn","node","ImgTag","attribs","id","arr","convertNodeToElement","arr2","BackColorTag","LinkTag","breakpointColumnsObj","values","useInView","threshold","triggerOnce","initialInView","entry","breakpointCols","columnClassName","PaperContent","Number","split","photoIndex","setPhotoIndex","isOpen","setIsOpen","images","mainSrc","nextSrc","prevSrc","onCloseRequest","onMovePrevRequest","onMoveNextRequest","host","linkhost","address","linkaddress","substr","setContent","target","stopPropagation","href","rel","isOverFlow","setIsOverFlow","overFlow","App","CssBaseline","Grid","container","direction","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"wNAAe,I,mJCoBAA,EAZP,O,OCeKC,EAAUC,0BACjBC,EAAcC,IAAkB,IAEtC,SAASC,IAA8B,IAAC,IAAD,EAEjCC,EAAK,GACLC,EAAK,GACLC,EAAK,GACLC,EAAK,GACLC,EAAK,GAN4B,mBAANC,EAAM,yBAANA,EAAM,gBAiBrC,OATAA,EAAKC,SAAQ,SAAAC,GACXP,EAAE,2BAAQA,GAAR,kBAAaO,EAAK,GAAKA,EAAK,KAC9BN,EAAE,2BAAQA,GAAR,kBAAaM,EAAK,GAAKA,EAAK,IAAMA,EAAK,KACzCL,EAAE,2BAAQA,GAAR,kBAAaK,EAAK,GAAKA,EAAK,IAAMA,EAAK,IAAMA,EAAK,KACpDJ,EAAE,2BAAQA,GAAR,kBAAaI,EAAK,GAAKA,EAAK,IAAMA,EAAK,IAAMA,EAAK,IAAMA,EAAK,KAC/DH,EAAE,2BAAQA,GAAR,kBAAaG,EAAK,GAAKA,EAAK,IAAMA,EAAK,IAAMA,EAAK,IAAMA,EAAK,IAAMA,EAAK,QAIrE,EAAP,iBACGV,EAAYW,KAAK,MADpB,eACiCR,IADjC,cAEGH,EAAYW,KAAK,MAFpB,eAEiCP,IAFjC,cAGGJ,EAAYW,KAAK,MAHpB,eAGiCN,IAHjC,cAIGL,EAAYW,KAAK,MAJpB,eAIiCL,IAJjC,cAKGN,EAAYW,KAAK,MALpB,eAKiCJ,IALjC,EAWa,SAASK,EAAgBC,GAGtC,MAA0CC,mBACxCC,cAAYC,kBAAkBC,eAAaC,eAAe,MAD5D,mBAAOC,EAAP,KAAsBC,EAAtB,KAIA,EAA8BN,oBAAS,GAAvC,mBAAOO,EAAP,KAAgBC,EAAhB,KACA,EAA4BR,mBAAS,IAArC,mBAAOS,EAAP,KAAeC,EAAf,KAEA,EAA8BV,mBAAS,IAAvC,mBAAOW,EAAP,KAAgBC,EAAhB,KACA,EAAoCZ,mBAAS,IAA7C,mBAAOa,EAAP,KAAmBC,EAAnB,KAEMC,EAAYC,iBAAO,GAGnBC,EAAgBC,uBAAY,SAAUC,IAEtCA,EAAMJ,EAAUK,SAAiB,IAAND,IAC7BE,IAAMC,IAAN,UAAavC,EAAb,+BAAuCoC,IAAOI,MAAK,SAAAC,GAEjDC,QAAQC,IAAIF,EAASG,MAErBf,GAAW,SAAAgB,GAAS,MAAM,GAAN,mBAAWA,GAAX,YAAmBJ,EAASG,KAAKE,KAAI,SAAAjC,GAAI,OAAIA,EAAKkC,gBACtEhB,GAAc,SAAAc,GAAG,4BAAQA,GAAR,CAAa,cAe9BG,EAAU,CAAC,SAAU,SAAU,SAAU,SAAU,UACnDC,EAAc,CAAC,OAAQ,OAAQ,OAAQ,OAAQ,QAGrDC,qBAAU,WACRZ,IAAMC,IAAN,UAAavC,EAAb,mBAAkCwC,MAAK,SAAAC,GACrCT,EAAUK,QAAUI,EAASG,UAiB9B,IAIH,IAAMO,EAAQC,mBAAQ,WAEpB,IAAIC,EAAWC,YAAY,CAEzBC,mBAAoB,CAUlB,CAAEC,gBAAiB,oFAAqFC,MAAO,YAC/G,CAAED,gBAAiB,oFAAqFC,MAAO,UAC/G,CAAED,gBAAiB,oFAAqFC,MAAO,SAC/G,CAAED,gBAAiB,sCAAuCC,MAAO,UAEnEC,QAAS,CACPC,QAASC,IACTC,KAAMrC,EAAU,QAAU,QAG5BsC,WAAY,CACVC,SAAU,GACVC,OAAQ,CAAEC,cAAe,QACzBC,MAAO7D,EAAqB,CAAC,YAAF,OAAiB2C,KAG9CmB,UAAW,CAETC,UAAW,CACTC,KAAK,eACAhE,EAAqB,CAAC,SAAF,OAAc4C,GAAd,CAA6B,UAA7B,OAA0CA,MAIrEqB,WAAY,CACVD,KAAK,eACAhE,EAAqB,CAAC,YAAF,OAAiB4C,MAG5CsB,QAAS,CACPF,KAAM,CACJ,oBAAoB,aAClBZ,MAAO,UACPe,WAAY,MACZC,YAAa,OACbC,UAAW,QACXC,UAAW,UAERtE,EAAqB,CAAC,SAAF,OAAc2C,GAAd,CAAyB,UAAzB,OAAsCA,MAGjE4B,MAAO,CACL,8CAA8C,eACzCvE,EAAqB,CAAC,WAAY,SAAU,iBAOzD,OADAgD,EAASK,QAAQmB,iBAAmBrD,EAAU,UAAY6B,EAASK,QAAQC,QAAQmB,MAC5EzB,IACN,CAAC7B,IAGElB,EAAKyE,YAAc5B,EAAMhD,YAAYW,KAAK,OAC1CP,EAAKwE,YAAc5B,EAAMhD,YAAYW,KAAK,OAC1CN,EAAKuE,YAAc5B,EAAMhD,YAAYW,KAAK,OAC1CL,EAAKsE,YAAc5B,EAAMhD,YAAYW,KAAK,OAG1CkE,GAFKD,YAAc5B,EAAMhD,YAAYW,KAAK,OAE7BR,EAAK,KAAOC,EAAK,KAAOC,EAAK,KAAOC,EAAK,KAAO,MAenE,OACE,cAACR,EAAQgF,SAAT,CAAkBC,MAAO,CACvB1D,UAASC,aAAY0B,QAAO9C,uBAAsBiB,gBAClDC,mBAAkB4D,UAjBJ,CAAE7E,GAAI,SAAUC,GAAI,SAAUC,GAAI,SAAUC,GAAI,SAAUC,GAAI,UAiB/C0E,UAhBf,CAAE9E,GAAI,OAAQC,GAAI,OAAQC,GAAI,OAAQC,GAAI,OAAQC,GAAI,QAgB5BsE,aACxCtD,SAAQC,YACRC,UAASC,aACTC,aAAYC,gBACZG,iBANF,SAWE,cAACmD,EAAA,EAAD,CAAelC,MAAOA,EAAtB,SACGnC,EAAMsE,a,sMCg0Bf,SAASC,IAKP,IAL2B,IAAbC,EAAY,uDAAH,EAEnBC,EAAS,GACTC,EAAa,iEACbC,EAAmBD,EAAWF,OACzBI,EAAI,EAAGA,EAAIJ,EAAQI,IAC1BH,GAAUC,EAAWG,OAAOC,KAAKC,MAAMD,KAAKE,SAAWL,IAEzD,OAAOF,E,gXCjwBT,SAASQ,EAAT,GAGiC,EAHXX,SAGY,IAHFY,EAGC,EAHDA,SAC9BC,EAE+B,EAF/BA,SAAUC,EAEqB,EAFrBA,YAECC,GAAoB,EAA/BC,UAA+B,EAApBD,QAAWrF,EAAS,iBAEzBmC,EAAQoD,cAGd,OAEE,cAACC,EAAA,EAAD,2BAAcxF,GAAd,IAEEyF,MAAO,CAELC,gBAAiBP,EAAWhD,EAAMO,QAAQC,QAAQgD,KAAO,GAGzDlD,MAA8B,UAAvBN,EAAMO,QAAQG,KACjBsC,EACEhD,EAAMO,QAAQC,QAAQiD,aACtBzD,EAAMO,QAAQC,QAAQgD,KACxBR,EACEhD,EAAMO,QAAQC,QAAQiD,aACtBzD,EAAMO,QAAQmD,KAAKC,WAK3BC,QAAS,SAAUC,GAGjBX,EAAOhE,QAAQ4E,QAOff,EAAS,OAAQE,IA5BrB,SAgCE,cAACc,EAAA,EAAD,OAMN,SAASC,GAAT,GAIiC,EAJT7B,SAIU,IAJAY,EAID,EAJCA,SAEhCkB,EAE+B,EAF/BA,WAAYC,EAEmB,EAFnBA,cAEDhB,GAAoB,EAA/BC,UAA+B,EAApBD,QAAWrF,EAAS,iBACzBmC,EAAQoD,cACd,OACE,cAACC,EAAA,EAAD,2BAAcxF,GAAd,IAEEyF,MAAO,CAELC,gBAAiBU,EAAajE,EAAMO,QAAQC,QAAQgD,KAAO,GAG3DlD,MAA8B,UAAvBN,EAAMO,QAAQG,KACjBuD,EACEjE,EAAMO,QAAQC,QAAQiD,aACtBzD,EAAMO,QAAQC,QAAQgD,KACxBS,EACEjE,EAAMO,QAAQC,QAAQiD,aACtBzD,EAAMO,QAAQmD,KAAKC,WAK3BC,QAAS,SAAUC,GACjBX,EAAOhE,QAAQ4E,QAGff,EAAS,SAAUmB,IAtBvB,SA0BE,cAACC,EAAA,EAAD,OAON,SAASC,GAAT,GAIiC,EAJNjC,SAIO,IAJGY,EAIJ,EAJIA,SAEnCsB,EAE+B,EAF/BA,cAAeC,EAEgB,EAFhBA,iBAEJpB,GAAoB,EAA/BC,UAA+B,EAApBD,QAAWrF,EAAS,iBACzBmC,EAAQoD,cACd,OACE,cAACC,EAAA,EAAD,2BAAcxF,GAAd,IAGEyF,MAAO,CAELC,gBAAiBc,EAAgBrE,EAAMO,QAAQC,QAAQgD,KAAO,GAG9DlD,MAA8B,UAAvBN,EAAMO,QAAQG,KACjB2D,EACErE,EAAMO,QAAQC,QAAQiD,aACtBzD,EAAMO,QAAQC,QAAQgD,KACxBa,EACErE,EAAMO,QAAQC,QAAQiD,aACtBzD,EAAMO,QAAQmD,KAAKC,WAK3BC,QAAS,SAAUC,GAEjBX,EAAOhE,QAAQ4E,QACff,EAAS,YAAauB,IAtB1B,SA0BE,cAAEC,EAAA,EAAF,O,8IC5GN,SAASC,GAAT,GAAgF,EAAzDrC,SAA0D,IAAhDsC,EAA+C,EAA/CA,eAAgBC,EAA+B,EAA/BA,kBAAsB7G,EAAS,kBAExEmC,EAAQoD,cAEd,OACE,mCACE,cAACC,EAAA,EAAD,2BACMxF,GADN,IAGEyF,MAAO,CAELC,gBAAiBkB,EAAiBzE,EAAMO,QAAQC,QAAQgD,KAAO,GAG/DlD,MAA8B,UAAvBN,EAAMO,QAAQG,KACjB+D,EACEzE,EAAMO,QAAQC,QAAQiD,aACtBzD,EAAMO,QAAQC,QAAQgD,KACxBiB,EACEzE,EAAMO,QAAQC,QAAQiD,aACtBzD,EAAMO,QAAQmD,KAAKC,WAM3BC,QAAS,SAAUC,GACjBa,GAAkB,SAAAhF,GAAG,OAAKA,MArB9B,SAwBE,cAACiF,GAAA,EAAD,SASR,SAASC,GAAT,GAAgF,EAA1DzC,SAA2D,IAAjD0C,EAAgD,EAAhDA,MAAOC,EAAyC,EAAzCA,YAAaL,EAA4B,EAA5BA,eAE5CzE,GAFwE,kBAEhEoD,eAEd,OAEE,cAAC2B,GAAA,EAAD,CAGEzB,MAAO,CACL0B,SAAU,OACVC,SAAU,OAEVC,UAAWT,EAAiB,OAAS,EAErCU,UAAWV,EAAiB,OAAS,EAErCW,mBAAoB,6BACpBC,mBAAoB,OACpBC,QAASb,EAAiB,EAAI,EAE9Bc,aAAcvF,EAAMwF,QAAQ,IAfhC,SAoBGC,OAAOC,KAAKb,GAAOlF,KAAI,SAAUgG,EAAMC,GAGtC,OAAO,cAACvC,EAAA,EAAD,CAAQwC,QAAQ,OAAkBjC,QACvC,SAAUC,GAERiB,EAAYa,IAHT,SAOL,cAACG,GAAA,EAAD,CAAQC,IAAKlB,EAAMc,GAAMK,QAAQ,OAAQ,IAAIA,QAAQ,IAAK,IAAK1C,MAAO,CAAE2C,UAAW,aAAcC,aAAc,MAP9EP,Q,qMC7V9BQ,GAAYC,cAAW,SAAAvI,GAClC,IAAMmC,EAAQoD,cAEd,MAAO,CAELiD,kBAAmB,SAAAxI,GACjB,MAAO,CACLyI,SAAU,WACVC,IAAK,MACLC,KAAM,MAGNP,UAAW,mCAKfQ,gBAAiB,SAAA5I,GACf,OAAO,aACLqI,aAAc,IACdQ,qBAAsB,EACtBC,wBAAyB,EAEzBL,SAAU,WAGVM,OAAQ,OAERrD,gBAAiBvD,EAAMO,QAAQmB,kBAVjC,WAWY,aAMdmF,gBAAiB,SAAAhJ,GACf,MAAO,CACLqI,aAAc,IACdY,oBAAqB,EACrBC,uBAAwB,EAExBH,OAAQ,OAERrD,gBAAiBvD,EAAMO,QAAQmB,mBAInCsF,iBAAkB,SAAAnJ,GAChB,MAAO,CACLqI,aAAc,IACdU,OAAQ,OACRrD,gBAAiBvD,EAAMO,QAAQmB,iBAC/BuF,UAAWjH,EAAMkH,QAAQ,KAM7BC,iBAAkB,SAAAtJ,GAChB,MAAO,CAGLuJ,YAAa,EACbC,aAAc,EACdC,YAAa,SAQjBC,kBAAmB,SAAA1J,GACjB,MAAO,CAGLuJ,YAAa,EACbC,aAAc,EACdC,YAAa,OACbhH,MAAO,oBAMXkH,iBAAkB,SAAA3J,GAChB,MAAO,CAELyJ,YAAa,aAyvBrB,I,4MCthBA,SAASlF,KAKP,IAL2B,IAAbC,EAAY,uDAAH,EAEnBC,EAAS,GACTC,EAAa,iEACbC,EAAmBD,EAAWF,OACzBI,EAAI,EAAGA,EAAIJ,EAAQI,IAC1BH,GAAUC,EAAWG,OAAOC,KAAKC,MAAMD,KAAKE,SAAWL,IAEzD,OAAOF,E,wWClTT,GJrBe,WACb,IAAImF,EAAa,KACbC,EAAyB,KAE7B,SAAS3E,EAASI,EAAWwE,GAI3B,GAFoBF,EAAWG,eAAeC,cA+BzC,CAEH,IAAMC,EAAYL,EAAWG,eAC7B,EAA+EE,EAAUC,UAAzF,mBAAOC,EAAP,KAAkBC,EAAlB,KAAgCC,EAAhC,KAA0CC,EAA1C,KACMC,GADN,UACiBX,EAAWY,wBAAwBC,YAIhDC,EAAaC,WAASC,YACxBhB,EAAWiB,oBACXZ,EAHW,KAOTa,EAAeb,EAAUc,MAAM,CAEjCZ,UAAWA,EACXC,aAAcA,EACdC,SAAUA,EACVC,YAAaA,EAZF,IAYqB9F,OAChCwG,YAAY,EACZC,UAAU,IAGZrD,OAAOC,KAAK0C,GAAU3K,SAAQ,SAAAC,GACxBA,IAASyF,IACboF,EAAaC,WAASO,iBAAiBR,EAAYI,EAAcP,EAAS1K,QAG5E6K,EAAaC,WAASO,iBAAiBR,EAAYI,EAAcP,EAASjF,GAAa,GAAKA,GAC5FsE,EAAa1J,cAAYiL,KAAKvB,EAAYc,EAAY,qBACtDd,EAAa1J,cAAYkL,gBAAgBxB,EAAYkB,GAErDjB,EAAuBD,OA9DP,CAGhB,IACA,GAFAA,EAAayB,YAAUC,kBAAkB1B,EAAYtE,IAC1ByE,eAC8DG,UAAzF,iDAqBAL,EAAuBD,IAgD3B,SAAS2B,IAAgC,IAAtBjG,EAAqB,uDAAT,QAEvB0E,EAAcJ,EAAWG,eAAeC,cAE9C,GAAKA,GA4CA,GAAIA,EAAa,CACpB,IAAMC,EAAYL,EAAWG,eAC7B,EAA+EE,EAAUC,UAAzF,mBAAOC,EAAP,KAAkBC,EAAlB,KAAgCC,EAAhC,KAA0CC,EAA1C,KACMC,GADN,UACiBX,EAAWY,wBAAwBC,YAE9C5E,EAAO,IACT6E,EAAaC,WAASa,WACxB5B,EAAWiB,oBACXZ,EACApE,GAGEiF,EAAeb,EAAUc,MAAM,CAEjCZ,UAAWA,EACXC,aAAcA,EACdC,SAAUA,EACVC,YAAaA,EAAczE,EAAKrB,OAChCwG,YAAY,EACZC,UAAU,IAGZrD,OAAOC,KAAK0C,GAAU3K,SAAQ,SAAAC,GACxBA,IAASyF,GAAsB,UAATzF,GAA6B,UAATA,IAG9C6K,EAAaC,WAASO,iBAAiBR,EAAYI,EAAcP,EAAS1K,QAG5E6K,EAAaC,WAASO,iBAAiBR,EAAYI,EAAcP,EAASjF,GAAa,GAAKA,GAC5FsE,EAAa1J,cAAYiL,KAAKvB,EAAYc,EAAY,qBACtDd,EAAa1J,cAAYkL,gBAAgBxB,EAAYkB,GAErDjB,EAAuBD,QA7EP,CAChB,IAAIK,EAAYL,EAAWG,eAC3B,EAA+EE,EAAUC,UAAzF,mBACMK,GADN,8BACiBX,EAAWY,wBAAwBC,YAChDC,EAAad,EAAWiB,oBAE5BnJ,QAAQC,IAAI4I,GACM,UAAdjF,GACFoF,EAAaC,WAASc,kBAAkBf,EAAYT,EAAW,SAC/DS,EAAaC,WAASc,kBAAkBf,EAAYT,EAAW,SAC1DM,EAASmB,QACZhB,EAAaC,WAASO,iBAAiBR,EAAYT,EAAW,WAG3C,UAAd3E,IACPoF,EAAaC,WAASc,kBAAkBf,EAAYT,EAAW,SAC/DS,EAAaC,WAASc,kBAAkBf,EAAYT,EAAW,SAC1DM,EAASoB,QACZjB,EAAaC,WAASO,iBAAiBR,EAAYT,EAAW,WAkBlEL,EAAa1J,cAAYiL,KAAKvB,EAAYc,EAAY,uBACtDd,EAAa1J,cAAYkL,gBAAgBxB,EAAYK,GACrDJ,EAAuBD,IA6H3B,MAAO,CAGLgC,WAAY,CAEVC,SAAU,SAAUC,EAAV,GAA4C,IAAnBC,EAAkB,EAAlBA,eAGjC,OADAlC,EAAyBkC,EADzBnC,EAAakC,IASjB7G,WAAY,SAAUjF,GAAS,OAAO,cAAC,EAAD,aAAYkF,SAAUA,GAAelF,KAC3EmG,aAAc,SAAUnG,GAAS,OAAO,cAAC,GAAD,aAAckF,SAAUA,GAAelF,KAC/EuG,gBAAiB,SAAUvG,GAAS,OAAO,cAAC,GAAD,aAAiBkF,SAAUA,GAAelF,KACrFgM,YA9FF,YAAqE,IAA9C3G,EAA6C,EAA7CA,OAAQ4G,EAAqC,EAArCA,UAAWC,EAA0B,EAA1BA,aAAiBlM,EAAS,iBAC5DmC,EAAQoD,cACd,OACE,cAACC,EAAA,EAAD,2BAAYxF,GAAZ,IACEyF,MAAO,CACLC,gBAAiBuG,EAAY9J,EAAMO,QAAQC,QAAQgD,KAAO,GAC1DlD,MAA8B,UAAvBN,EAAMO,QAAQG,KACjBoJ,EACE9J,EAAMO,QAAQC,QAAQiD,aACtBzD,EAAMO,QAAQC,QAAQgD,KACxBsG,EACE9J,EAAMO,QAAQC,QAAQiD,aACtBzD,EAAMO,QAAQmD,KAAKC,WAE3BC,QAAS,SAAUC,GAEjBX,EAAOhE,QAAQ4E,QACfsF,EAAU,QAASW,IAdvB,SAiBE,cAACC,EAAA,EAAD,QA2EJC,YAtEF,YAAqE,IAA9C/G,EAA6C,EAA7CA,OAAQgH,EAAqC,EAArCA,UAAWC,EAA0B,EAA1BA,aAAiBtM,EAAS,iBAC5DmC,EAAQoD,cACd,OACE,cAACC,EAAA,EAAD,2BAAYxF,GAAZ,IACEyF,MAAO,CACLC,gBAAiB2G,EAAYlK,EAAMO,QAAQC,QAAQgD,KAAO,GAC1DlD,MAA8B,UAAvBN,EAAMO,QAAQG,KACjBwJ,EACElK,EAAMO,QAAQC,QAAQiD,aACtBzD,EAAMO,QAAQC,QAAQgD,KACxB0G,EACElK,EAAMO,QAAQC,QAAQiD,aACtBzD,EAAMO,QAAQmD,KAAKC,WAE3BC,QAAS,SAAUC,GAEjBX,EAAOhE,QAAQ4E,QACfsF,EAAU,QAASe,IAdvB,SAiBE,cAACC,EAAA,EAAD,SIpMqFC,GAArFZ,GAAR,GAAQA,WAAY3G,GAApB,GAAoBA,WAAYkB,GAAhC,GAAgCA,aAAcI,GAA9C,GAA8CA,gBAAiByF,GAA/D,GAA+DA,YAAaI,GAA5E,GAA4EA,YAC5E,GHrBe,WACb,IACIxC,EAAa,KACbC,EAAyB,KAwDvB4C,EAAQ,cA1DF,iCA0DE,yBACVzF,EAAQ,GAQZ,SAASC,EAAYpB,GAEnB,MAA+E+D,EAAWG,eAAeG,UAAzG,mBAAOC,EAAP,KAAkBC,EAAlB,KAAgCC,EAAhC,KAA0CC,EAA1C,KAAuDU,EAAvD,KACA,GADA,KAEI,CAAEA,EAAyBX,EAAZF,EAAuBa,EAA4BV,EAAfF,EAA4BY,EAAab,EAAYE,EAAUW,EAAaZ,EAAeE,IAD3IoC,EAAP,KAAuBC,EAAvB,KAIIjC,EAAaC,WAASC,YACxBhB,EAAWiB,oBACXjB,EAAWG,eACXlE,GAGEiF,EAAelB,EAAWG,eAAegB,MAAM,CAEjDZ,UAAWuC,EACXtC,aAAcuC,EAAoB9G,EAAKrB,OACvC6F,SAAUqC,EACVpC,YAAaqC,EAAoB9G,EAAKrB,OACtCwG,YAAY,EACZC,UAAU,IAGZrB,EAAa1J,cAAYiL,KAAKvB,EAAYc,EAAY,qBACtDd,EAAa1J,cAAYkL,gBAAgBxB,EAAYkB,GAErDjB,EAAuBD,GA+JzB,MAxPe,CACb,SACA,SACA,qEACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,iCACA,eACA,gBAKOhK,SAAQ,SAAAkI,GAEfd,EAAMc,GAAQ2E,EAAW3E,EAAO,UA6L3B,CAIL8E,YAAa,CAEXf,SAAU,SAAUC,EAAV,GAA4C,IAAnBC,EAAkB,EAAlBA,eAOjC,OAJAnC,EAAakC,EACbjC,EAAyBkC,EACzBnC,EAvKN,WAEE,MAA+EA,EAAWG,eAAeG,UAAzG,mBAKM2C,GALN,8BAKqBjD,EAAWG,gBAC5BW,EAAad,EAAWiB,oBACxBC,EAAelB,EAAWG,eAgE9B,OA9DAH,EAAWiB,oBAAoBiC,mBAAmBlN,SAAQ,SAAUmN,GAElE,MAAyCA,EAAM7C,UAA/C,mBAAO8C,EAAP,KAAmBC,EAAnB,UAEQrN,SAAQ,SAAUC,EAAMkI,GAC9B,IAAMmF,EAAgBrN,EAAKsN,YACvBD,GAEiB,UADAxC,EAAWyC,UAAUD,GAAeE,YAGrDtC,EAAeA,EAAaC,MAAM,CAChCZ,UAAW6C,EACX5C,aAAcrC,EACdsC,SAAU2C,EACV1C,YAAavC,EAAQ,EACrBiD,YAAY,EACZC,UAAU,IAEZP,EAAaC,WAAS0C,YAAY3C,EAAYI,EAAc,UAMlElD,OAAOC,KAAKb,GAAOpH,SAAQ,SAAU0N,GAMnC,IAJA,IAGIC,EAHEC,EAAO,IAAIC,OAAJ,UAAcH,GAAY,KAEjCI,EAAQ,GAE+B,QAArCH,EAAWC,EAAKG,KAAKV,KAAsB,CAEjD,IAAMW,EAAQL,EAASxF,MACXwF,EAASxF,MAAQwF,EAAS,GAAG/I,OAEzCkJ,EAAMvC,KAAKyC,GAIbF,EAAM9N,SAAQ,SAAUiO,GAGtB,IAAMC,GADNpD,EAAaA,EAAWqD,aAAa,QAAS,YAAa,CAAE/O,IAAKgI,EAAMsG,GAAWU,OAAQV,KAC9DW,0BAE7BnD,EAAeA,EAAaC,MAAM,CAChCZ,UAAW6C,EACX5C,aAAcyD,EACdxD,SAAU2C,EACV1C,YAAauD,EAASP,EAAS9I,OAC/BwG,YAAY,EACZC,UAAU,IAGZP,EAAaC,WAAS0C,YAAY3C,EAAYI,EAAcgD,YAOlElE,EAAa1J,cAAYiL,KAAKvB,EAAYc,EAAY,qBACtDd,EAAa1J,cAAYkL,gBAAgBxB,EAAYiD,GA+FpCqB,IAIfC,WAAY,CACV,CACEC,SAjGR,SAAuBC,EAAcC,EAAUC,GAG7CF,EAAaG,kBACX,SAAUC,GACR,IAAMX,EAAYW,EAAUtB,YAC5B,OACgB,OAAdW,GACgD,UAAhDS,EAAapB,UAAUW,GAAWV,YAItCkB,IAsFII,UAlFR,SAAe1O,GACuEA,EAA5EuO,aAA4EvO,EAA9D8N,UAA8D9N,EAAnDgN,SAAmDhN,EAAzC2O,UAAyC3O,EAA9B4N,MAA8B5N,EAAvB4O,IAA7D,IAAkEC,EAAkB7O,EAAlB6O,cAK5DC,EAAU7N,mBACVkB,EAAQoD,cAWd,OACE,mCAIE,sBAEEwJ,IAAKD,EACLE,UAAU,QACVvJ,MAAO,CAGLwJ,iBAAkB,YAElBC,mBAAoB,gBACpBC,eAAgB,UAChBC,QAAS,eAETzL,UAAW,QACXH,WAAwC,IAA5BrB,EAAMW,WAAWC,SAC7BU,YAAyC,IAA5BtB,EAAMW,WAAWC,SAE9BqF,WAAWiH,WAAW,cACtB7M,gBAAiBwE,EAAM6H,IAlB3B,SAuBE,sBAAMpJ,MAAO,CACX6J,SAAU,yBADZ,SAKGtP,EAAMsE,mBAqCfqC,YAAa,SAAU3G,GAAS,OAAO,cAAC,GAAD,eAAiBA,KACxD+G,WAAY,SAAU/G,GAAS,OAAO,cAAC,GAAD,aAAYgH,MAAOA,EAAOC,YAAaA,GAAiBjH,MGjQjDuP,GAAzC3C,GAAR,GAAQA,YAAajG,GAArB,GAAqBA,YAAaI,GAAlC,GAAkCA,WAClC,GLlBe,WACb,IAAI6C,EAAa,KACbC,EAAyB,KAuQ7B,SAAS2F,IAEP,IAAIjB,EAAe3E,EAAWiB,oBACxB4E,EAAkBlB,EAAamB,qBAC/BC,EAAiBpB,EAAaqB,oBAGhCC,EAAYtB,EAAazB,mBAAmBgD,MAAK,SAAAjQ,GAAU,MAAqB,eAAdA,EAAKgD,MAAuC,WAAdhD,EAAKgD,QAGrGkN,EAAqBxB,EAAazB,mBAAmBkD,QAAO,SAAUnQ,GAGxE,QAAwB,eAAdA,EAAKgD,MAAuC,WAAdhD,EAAKgD,SAKzCoN,EAAeJ,GAAaA,EAAUK,SAE5C,GAAKD,EAAL,CACA,GAAKA,GAAkB1B,EAAazB,mBAAmBtI,QAAU,EAK/D,OAJAoF,EAAa1J,cAAYiQ,cACzBC,YAAW,WACTvG,EAAuBD,KACtB,GACI,KAGTiG,EAAYtB,EAAa8B,eAAeJ,GAExC1B,GADAA,EAAenO,eAAakQ,qBAAqBP,IACrBhF,MAAM,CAChC4E,iBACAF,oBAIF7F,EAAa1J,cAAYC,kBAAkBoO,GAG3C1E,EAAuBD,IAKzB,SAAS2G,IACP,IAAMtG,EAAYL,EAAWG,eAEzBwE,EAAe3E,EAAWiB,oBACT0D,EAAa8B,eAAepG,EAAUuG,aAE3D,OADiBjC,EAAakC,cACdvG,UAAUwG,WAAU,SAAC7Q,GAGnC,MAD8B,WAAdA,EAAKgD,MAAmC,mBAAdhD,EAAKgG,MAA4C,eAAdhG,EAAKgD,SAE9E,EA0qBR,MAAO,CAEL8N,UA/mBF,YAAiF,EAA5D5D,MAA4D,EAArD1H,OAAqD,EAA7CkJ,aAA8C,IAAhC7N,EAA+B,EAA/BA,OAAQC,EAAuB,EAAvBA,UAIlDwB,GAJyE,iBAIjEoD,eAERqL,EAASlQ,EAAO8D,OAChBqM,EAASnQ,EAGf,OAAe,IAAXkQ,EAOA,qBAAKnL,MAAO,CAEVgD,SAAU,WACVqI,MAAO,OACP/H,OAAQ,EACRgI,cAAe,SAQfrL,gBAAiBvD,EAAMO,QAAQsO,QAC/B5J,SAAU,UAdZ,SAmBE,wBACErB,QAAS,aADX,sBAec,IAAX6K,EACA,qBAAKnL,MAAO,CAEjBgD,SAAU,WACVqI,MAAO,OACP/H,OAAQ,EACRgI,cAAe,SAEf9B,iBAAkB,YAClBgC,oBAAqB,SACrBC,oBAAqB,SACrB/B,eAAgB,QAChB3M,gBAAiB,OAASqO,EAAO,GAAGM,SAAW,IAE/CzL,gBAAiBvD,EAAMO,QAAQsO,QAC/B5J,SAAU,UAGVrB,QAAS,WAEPpF,GAAU,SAAAkB,GAER,OADAuO,YAAW,WAAQZ,MAAqB,GACjC,SAQK,IAAXoB,EAEL,sBAAKnL,MAAO,CACVgD,SAAU,WACVqI,MAAO,OACP/H,OAAQ,EACRgI,cAAe,SACfE,oBAAqB,SACrBC,oBAAqB,SACrBxL,gBAAiBvD,EAAMO,QAAQsO,QAC/B5J,SAAU,UARZ,UAcE,qBAAK3B,MAAK,aACRgD,SAAU,WACVqI,MAAO,MACP/H,OAAQ,OAERrD,gBAAiB,OACjBiD,KAAM,KACND,IAAK,KACLuG,iBAAkB,YAClB7H,SAAU,SACV6J,oBAAqB,SACrBC,oBAAqB,SACrB/B,eAAgB,QAChB3M,gBAAiB,OAASqO,EAAO,GAAGM,SAAW,IAC/C/I,UAAW,oCAdH,kBAeS,SAEjBrC,QAAS,WACPpF,GAAU,SAAAkB,GAAG,MAAI,CAACA,EAAI,UAI1B,qBAAK4D,MAAK,aACRgD,SAAU,WACVqI,MAAO,MACP/H,OAAQ,OAERrD,gBAAiB,QACjBiD,KAAM,MACND,IAAK,KACLuG,iBAAkB,YAClB7H,SAAU,SACV6J,oBAAqB,SACrBC,oBAAqB,SACrB/B,eAAgB,QAChB3M,gBAAiB,OAASqO,EAAO,GAAGM,SAAW,IAC/C/I,UAAW,mCAdH,kBAeS,SAEjBrC,QAAS,WACPpF,GAAU,SAAAkB,GAAG,MAAI,CAACA,EAAI,aASZ,IAAX+O,EAEL,sBAAKnL,MAAO,CACVgD,SAAU,WACVqI,MAAO,OACP/H,OAAQ,EACRgI,cAAe,SACfE,oBAAqB,SACrBC,oBAAqB,SACrBxL,gBAAiBvD,EAAMO,QAAQsO,QAC/B5J,SAAU,UARZ,UAYE,qBAAK3B,MAAK,aACRgD,SAAU,WACVqI,MAAO,MACP/H,OAAQ,OAERrD,gBAAiB,OACjBiD,KAAM,KACND,IAAK,KACLuG,iBAAkB,YAClB7H,SAAU,SACV6J,oBAAqB,SACrBC,oBAAqB,SACrB/B,eAAgB,QAChB3M,gBAAiB,OAASqO,EAAO,GAAGM,SAAW,IAC/C/I,UAAW,oCAdH,kBAeS,SAEjBrC,QAAS,WACPpF,GAAU,SAAAkB,GAAG,MAAI,CAACA,EAAI,GAAIA,EAAI,UAIlC,qBAAK4D,MAAO,CACVgD,SAAU,WACVqI,MAAO,MACP/H,OAAQ,MACRrD,gBAAiB,QACjBiD,KAAM,MACND,IAAK,KACLuG,iBAAkB,YAClB7H,SAAU,SACV6J,oBAAqB,SACrBC,oBAAqB,SACrB/B,eAAgB,QAChB3M,gBAAiB,OAASqO,EAAO,GAAGM,SAAW,IAC/C/I,UAAW,oCAGVrC,QACD,WACEpF,GAAU,SAAAkB,GAAG,MAAI,CAACA,EAAI,GAAIA,EAAI,UAGlC,qBAAK4D,MAAO,CACVgD,SAAU,WACVqI,MAAO,MACP/H,OAAQ,MACRrD,gBAAiB,QACjBiD,KAAM,MACND,IAAK,MACLuG,iBAAkB,YAClB7H,SAAU,SACV6J,oBAAqB,SACrBC,oBAAqB,SACrB/B,eAAgB,QAChB3M,gBAAiB,OAASqO,EAAO,GAAGM,SAAW,IAC/C/I,UAAW,mCAEVrC,QACD,WACEpF,GAAU,SAAAkB,GAAG,MAAI,CAACA,EAAI,GAAIA,EAAI,aAUpC,sBAAK4D,MAAO,CACVgD,SAAU,WACVqI,MAAO,OACP/H,OAAQ,EACRgI,cAAe,SACfE,oBAAqB,SACrBC,oBAAqB,SACrBxL,gBAAiBvD,EAAMO,QAAQsO,QAC/B5J,SAAU,UARZ,UAYE,qBAAK3B,MAAO,CACVgD,SAAU,WACVqI,MAAO,MACP/H,OAAQ,MACRrD,gBAAiB,QACjBgD,IAAK,KACLC,KAAM,KACNsG,iBAAkB,YAClB7H,SAAU,SACV6J,oBAAqB,SACrBC,oBAAqB,SACrB/B,eAAgB,QAChB3M,gBAAiB,OAASqO,EAAO,GAAGM,SAAW,IAC/C/I,UAAW,qCAEVrC,QAAS,WACVpF,GAAU,SAAAkB,GAAG,MAAI,CAACA,EAAI,GAAIA,EAAI,GAAIA,EAAI,UAGxC,qBAAK4D,MAAO,CACVgD,SAAU,WACVqI,MAAO,MACP/H,OAAQ,MACRrD,gBAAiB,QACjBgD,IAAK,KACLC,KAAM,MACNsG,iBAAkB,YAClB7H,SAAU,SACV6J,oBAAqB,SACrBC,oBAAqB,SACrB/B,eAAgB,QAChB3M,gBAAiB,OAASqO,EAAO,GAAGM,SAAW,IAC/C/I,UAAW,oCAEVrC,QAAS,WACVpF,GAAU,SAAAkB,GAAG,MAAI,CAACA,EAAI,GAAIA,EAAI,GAAIA,EAAI,UAGxC,qBAAK4D,MAAO,CACVgD,SAAU,WACVqI,MAAO,MACP/H,OAAQ,MACRrD,gBAAiB,QACjBgD,IAAK,MACLC,KAAM,KACNsG,iBAAkB,YAClB7H,SAAU,SACV6J,oBAAqB,SACrBC,oBAAqB,SACrB/B,eAAgB,QAChB3M,gBAAiB,OAASqO,EAAO,GAAGM,SAAW,IAC/C/I,UAAW,oCAEXrC,QACE,WACEpF,GAAU,SAAAkB,GAAG,MAAI,CAACA,EAAI,GAAIA,EAAI,GAAIA,EAAI,UAI5C,qBAAK4D,MAAO,CACVgD,SAAU,WACVqI,MAAO,MACP/H,OAAQ,MACRrD,gBAAiB,QACjBgD,IAAK,MACLC,KAAM,MACNsG,iBAAkB,YAClB7H,SAAU,SACV6J,oBAAqB,SACrBC,oBAAqB,SACrB/B,eAAgB,QAChB3M,gBAAiB,OAASqO,EAAO,GAAGM,SAAW,IAC/C/I,UAAW,mCAEVrC,QACD,WACEpF,GAAU,SAAAkB,GAAG,MAAI,CAACA,EAAI,GAAIA,EAAI,GAAIA,EAAI,cAmThDuP,YApHF,YAAwE,EAAjD9M,SAAkD,IAAxC5D,EAAuC,EAAvCA,OAAQC,EAA+B,EAA/BA,UAAW0E,EAAoB,EAApBA,OAAWrF,EAAS,iBAGhEqR,EAAWpQ,mBACXkB,EAAQoD,cAGd,OACE,qCAEE,cAACC,EAAA,EAAD,2BACMxF,GADN,IAGEyF,MAAO,CACLhD,MAA8B,SAAvBN,EAAMO,QAAQG,KAEjBnC,EAAO8D,QAAU,GAAK+L,IAAkBpO,EAAMO,QAAQ4O,OAAOC,SAAWpP,EAAMO,QAAQmD,KAAKC,UAC3FpF,EAAO8D,QAAU,GAAK+L,IAAkBpO,EAAMO,QAAQ4O,OAAOC,SAAWpP,EAAMO,QAAQC,QAAQgD,MAGpG4L,SAAU7Q,EAAO8D,QAAU,GAAK+L,IAChCxK,QAAS,SAAUC,GAYjBqL,EAAShQ,QAAQmQ,SAvBrB,SA8BE,cAACC,EAAA,EAAD,OAIF,uBAAO1C,IAAKsC,EAAUxO,KAAK,OAAO4C,MAAO,CAAE2J,QAAS,QAClDrJ,QAAS,SAAUC,GAAKA,EAAE0L,cAAcxN,MAAQ,MAChD2H,SAAU,SAAU7F,GAClB,GAAIA,EAAE0L,cAAcC,MAAM,GAAGC,KAAKC,OAAOC,MAAM,qCAAsC,CAInF,IAAMC,EAAO/L,EAAE0L,cAAcC,MAAM,GACnCI,EAAKZ,SAAWa,IAAIC,gBAAgBjM,EAAE0L,cAAcC,MAAM,IAE1DjQ,QAAQC,IAAIqE,EAAE0L,cAAcC,MAAM,IAClChR,GAAU,SAAAkB,GAGR,MAAM,GAAN,mBAAWA,GAAX,CAAgBkQ,OAMbxB,IAGHlL,EAAOhE,QAAQ4E,QA71B7B,SAA0BZ,GAGxB,IAAIkJ,EAAe3E,EAAWiB,oBACxBZ,EAAYL,EAAWG,eAEvBmI,EAAajI,EAAUuG,YAIzBT,GAHiBxB,EAAa8B,eAAepG,EAAUuG,aAGlCjC,EAAazB,oBAChC2C,EAAkBlB,EAAamB,qBAC/BC,EAAiBpB,EAAaqB,oBAEhCuC,EAAepC,EAAmBW,WAAU,SAAA7Q,GAAU,OAAOA,EAAKuS,MAAQF,KAC9EC,EAAeA,GAAgB,EAAIA,EAAepC,EAAmBvL,OAAS,EAC9E9C,QAAQC,IAAIwQ,GAEZpC,EAAmBsC,OAAOF,EAAe,EAAG,EAC1C,IAAIG,eAAa,CACfF,IAAK7N,IACL1B,KAAM,aACNgD,KAAM,MAKV0I,GADAA,EAAenO,eAAakQ,qBAAqBP,IACrBhF,MAAM,CAChC4E,iBACAF,oBAKF7F,EAAa1J,cAAYiL,KAAKvB,EAAY2E,EAAc,mBACxD1E,EAAuBD,GAuzBW2I,CAAiBP,IAAIC,gBAAgBjM,EAAE0L,cAAcC,MAAM,aAqD7Fa,eAhCF,YAA8C,EAApBnN,OAAqB,IAAVrF,EAAS,iBAEtCmC,EAAQoD,cACd,OAEE,cAACC,EAAA,EAAD,2BAAYxF,GAAZ,IAEEyF,MAAO,CAELhD,MAA8B,UAAvBN,EAAMO,QAAQG,KACjBV,EAAMO,QAAQC,QAAQgD,KACtBxD,EAAMO,QAAQmD,KAAKC,WAEzBC,QAAS,YAvpBf,SAAkBV,GAGEuE,EAAWG,eAA7B,IAGIwE,EAAe3E,EAAWiB,oBACxB4E,EAAkBlB,EAAamB,qBAC/BC,EAAiBpB,EAAaqB,oBAGhCC,EAAYtB,EAAazB,mBAAmBgD,MAAK,SAAAjQ,GAAU,MAAqB,eAAdA,EAAKgD,MAAuC,WAAdhD,EAAKgD,QAGrGkN,EAAqBxB,EAAazB,mBAAmB2F,MAAK,SAAUC,EAAOC,GAC7E,MAAmB,eAAfD,EAAM7P,MAAwC,WAAf6P,EAAM7P,MAC/B,EAGD,KAKLoN,EAAeJ,GAAaA,EAAUK,SAEvCD,IAELJ,EAAYtB,EAAa8B,eAAeJ,GAExCvO,QAAQC,IAAI4M,EAAazB,mBAAmBtI,QAG5C+J,GADAA,EAAenO,eAAakQ,qBAAqBP,IACrBhF,MAAM,CAChC4E,iBACAF,oBAMF7F,EAAa1J,cAAYiL,KAAKvB,EAAY2E,EAAc,mBACxD1E,EAAuBD,IA+mBjBgJ,IAVJ,SAcE,cAACC,EAAA,EAAD,QAcJrD,kBACAe,gBAEAuC,YAAa,CAEXjH,SAAU,SAAUC,EAAV,GAA4C,IAAnBC,EAAkB,EAAlBA,eAKjC,OAFAlC,EAAyBkC,EADzBnC,EAAakC,KKr+B0DiH,GAAvED,GAAR,GAAQA,YAAa1B,GAArB,GAAqBA,YAA6BT,IAAlD,GAAkC6B,eAAlC,GAAkD7B,WAClD,IADA,GAA6DJ,cFgF9C,WAEb,IAAMvR,EAAM,8BAIR4K,EAAa,KACbC,EAAyB,KAEzBmJ,EAAc,GACZC,EAAY,GAElBD,EAAYpT,SAAQ,SAAAsT,GAClBD,EAAUC,GAAc,KACxB5R,IAAMC,IAAN,UAEKvC,EAFL,YAEYkU,EAFZ,QAGE,CACEC,aAAc,cACdC,mBAAoB,SAAUC,OAC7B7R,MAAK,SAACC,GACP,IAAM6R,EAASC,KAAK,IAAIC,WAAW/R,EAASG,MAAM6R,QAAO,SAAC7R,EAAM8R,GAAP,OAAgB9R,EAAO+R,OAAOC,aAAaF,KAAO,KAC3GT,EAAUC,GAAc,QAAUzR,EAASoS,QAAQ,gBAAkB,WAAaP,QAMxF,IAAIQ,EAAW,MA4Bf,SAASC,EAAT,GAAsD,IAAD,IAApCC,sBAAoC,SAAThU,EAAS,kBAC7CmC,EAAQoD,cACd,EAA8BtF,mBAAS,GAAvC,mBAAOwH,EAAP,KAAgBwM,EAAhB,KAEQC,EAA8ClU,EAA9CkU,eAAgBC,EAA8BnU,EAA9BmU,eAAgBrG,EAAc9N,EAAd8N,UACxC,EAA0IxF,KAAhGa,GAA1C,EAAQP,gBAAR,EAAyBI,gBAAzB,EAA0CG,kBAA0EQ,GAApH,EAA4DnB,kBAA5D,EAA+Ec,iBAA/E,EAAiGI,kBAAjG,EAAoHC,kBAQpH,OAJAzH,qBAAU,WACR+R,EAAW,KACV,IAID,cAAC/M,GAAA,EAAD,CACEkN,UAAW,EAEXC,gBAAgB,QAAQC,+BAA+B,OACvD7O,MAAO,CAELqL,MAAO,cACPrI,SAAU,WACVpB,UAAWlF,EAAMwF,QAAQ,GAEzBgB,KAAM,MACN4L,OAAQ,IACRnF,QAAS,OAEToF,cAAe,SACf/M,QAASA,EACTW,UAAU,SAAD,OAAWX,EAAX,KACTF,mBAAoB,oBACpBC,mBAAoB,QAlBxB,SAwBGwL,EAAYlR,KAAI,SAAUoR,EAAYnL,GAErC,OAEE,cAAC0M,GAAA,EAAD,CAEEC,QAAS,CAAErR,KAAM8F,EAAkBvF,MAAO+F,GAC1ClE,MAAO,CACLC,gBAAkB1F,EAAM8T,SAAWd,EAAYxO,SAAWuD,GACrBiM,EAAjC7R,EAAMO,QAAQmB,iBAAqE1B,EAAMO,QAAQ4O,OAAOqD,mBAE5GC,OAAQ,UACR9D,MAAO,eAGT+D,OAAQ,cAAC5M,GAAA,EAAD,CAAQ6M,IAAI,UAAU5M,IAAK+K,EAAUC,KAE7C6B,YAAa,WACXC,EAAchB,EAAiB,KAAOd,EAAaA,EAAYgB,EAAgBC,EAAgBrG,IAGjGlK,MAAO,cAACqR,GAAA,EAAD,CAAYjN,QAAQ,QAApB,SAA8BkL,KAhBhCnL,QAuLjB,SAASiN,EAAc9B,EAAYgB,EAAgBC,EAAgBrG,GAGjE,IAAMjI,EAAOqN,EAAa,IACpB3E,EAAe3E,EAAWiB,oBAC1BZ,EAAYL,EAAWG,eAGvBmL,EAAkBf,EACpB5F,EAAapB,UAAUgH,GAAgBgB,UAAUC,OAAOjN,QAAQ,KAAM,IACtE,GAEJ,EAA+E8B,EAAUC,UAAzF,mBAAOC,EAAP,KAAkBC,EAAlB,KAAgCC,EAAhC,KAA0CC,EAA1C,KAAuDU,EAAvD,KACA,GADA,KAEI,CAAEA,EAAyBX,EAAZF,EAAuBa,EAA4BV,EAAfF,EAA4BY,EAAab,EAAYE,EAAUW,EAAaZ,EAAeE,IAD3IoC,EAAP,KAAuBC,EAAvB,KAII7B,EAAeb,EAAUc,MAAM,CACjCZ,UAAWuC,EACXtC,aAAcuC,EACdtC,SAAUqC,EACVpC,YAAaqC,EAAoBuI,EAAgB1Q,OACjDwG,YAAY,EACZC,UAAU,IAKRP,EAAaC,WAASC,YACxB2D,EACAzD,EACAjF,GAGFiF,EAAelB,EAAWG,eAAegB,MAAM,CAE7CZ,UAAWuC,EACXtC,aAAcuC,EAAoB9G,EAAKrB,OACvC6F,SAAUqC,EACVpC,YAAaqC,EAAoB9G,EAAKrB,OACtCwG,YAAY,EACZC,UAAU,IAGZrB,EAAa1J,cAAYiL,KAAKvB,EAAYc,EAAY,qBACtDd,EAAa1J,cAAYkL,gBAAgBxB,EAAYkB,GAGrDjB,EAAuBD,GA8KzB,SAASyL,IAEP,GAAIrC,EAAYxO,QAAU,EAAK,OAAO,EAEtC,IAAI8Q,GAAS,EACP/G,EAAe3E,EAAWiB,oBAuBhC,OAtBA0D,EAAazB,mBAAmBlN,SAAQ,SAAUmN,GAoBhD,GAlBgBA,EAAMwI,mBACd3V,SAAQ,SAAUC,EAAMkI,GAE9B,IAAMyN,EAAS3V,EAAKsN,YACpB,GAAIqI,EAAQ,CACV,MAAwDjH,EAAapB,UAAUqI,GAAQL,UAA/EM,EAAR,EAAQA,YAAavB,EAArB,EAAqBA,eAAgBC,EAArC,EAAqCA,eACrC,GAAIsB,EAAa,CAEf,GAAoB,mBAAhBA,EACF,OAAOH,EAAS,CAACtC,EAAYc,EAAWd,EAAYxO,QAAS,GAAI,GAAIgR,GAElE,GAAIC,EAAYC,QAAQ,oBAAsB,EACjD,OAAOJ,EAAS,CAACtC,EAAYc,EAAWd,EAAYxO,QAAS0P,EAAgBC,EAAgBqB,QAMjGF,EAAU,OAAOA,KAEhBA,EA6DT,MAAO,CAELK,cAAe,CAGbC,kBAHa,SAGKC,EAAO/J,EAAagK,EAHzB,GAG6D,IAAnB/J,EAAkB,EAAlBA,eAErD,EAA+EnC,EAAWG,eAAeG,UAAzG,mBAAOC,EAAP,KAAkBC,EAAlB,KAAgCC,EAAhC,KAA0CC,EAA1C,KAAuDU,EAAvD,KACA,GADA,KAEI,CAAEA,EAAyBX,EAAZF,EAAuBa,EAA4BV,EAAfF,EAA4BY,EAAab,EAAYE,EAAUW,EAAaZ,EAAeE,IAD3HqC,EAAvB,KAA0DoJ,EAA1D,KAMA,GAAIV,KAAgBhG,aAAc2G,YAAY,CAE5CnM,EAAyBkC,EAEzB,IAAIjB,GAHJlB,EAAakC,GAGiB/B,eAC1BW,EAAad,EAAWiB,oBA2B5B,OAzBAC,EAAeA,EAAaC,MAAM,CAChCC,YAAY,EACZC,UAAU,IAIZP,EAAaC,WAASC,YACpBF,EACAI,EACA+K,GAGF/K,EAAeA,EAAaC,MAAM,CAChCX,aAAcuC,EAAmC,EAAfkJ,EAAMrR,OACxC8F,YAAayL,EAAmC,EAAfF,EAAMrR,OACvCwG,YAAY,EACZC,UAAU,IAIZrB,EAAa1J,cAAYiL,KAAKvB,EAAYc,EAAY,qBAGtDqB,EAFAnC,EAAa1J,cAAYkL,gBAAgBxB,EAAYkB,IAI9C,YAKXmL,aAjDa,SAiDAjQ,EAAGkQ,EAjDH,GAiDkC,IAAnBnK,EAAkB,EAAlBA,eAE1B,OAAIsJ,KACFL,EAAa,WAAb,cAAiBK,MACV,YAGPtJ,EAAeV,YAAU8K,kBAAkBD,IACpC,YAgCXE,aAzFa,SAyFApQ,EAzFA,GAyF+C,EAA1CqQ,eAA0C,EAA1BtK,eAA0B,kBAE1D,OAAmB,KAAd/F,EAAEsQ,SAAmBjB,KACxBvB,GAAsB,EACf,cAGe,KAAd9N,EAAEsQ,SAAmBjB,KAC7BvB,GAAsB,EACf,mBAFJ,GAYPyC,iBA5Ga,SA4GIC,EAAS1K,EAAagK,EA5G1B,GA4G6D,EAAlB/J,eAEtD,MAAgB,eAAZyK,GACF3M,EAAuBD,GAChB,WAUF,eAITiC,SAAU,SAAUC,EAAV,GAA4C,IAAnBC,EAAkB,EAAlBA,eAIjC,OAHAnC,EAAakC,EACbjC,EAAyBkC,EACzBnC,EAnYN,WAEE,MAA+EA,EAAWG,eAAeG,UAAzG,mBAAOC,EAAP,KAAkBC,EAAlB,KAAgCC,EAAhC,KAA0CC,EAA1C,KAAuDU,EAAvD,KAAmEyL,EAAnE,KACA,EACI,CAAEzL,EAAyBX,EAAZF,EAAuBa,EAA4BV,EAAfF,EAA4BY,EAAab,EAAYE,EAAUW,EAAaZ,EAAeE,GADxGoM,EAA1C,KAA0DX,EAA1D,KAEMvI,EAAO,kCAGPX,EAAejD,EAAWG,eAC5Be,EAAelB,EAAWG,eAC1BW,EAAad,EAAWiB,oBAuJ5B,OArJAjB,EAAWiB,oBAAoBiC,mBAAmBlN,SAAQ,SAAUmN,GAElE,IAwBIQ,EAxBJ,EAAyCR,EAAM7C,UAA/C,mBAAO8C,EAAP,KAAmBC,EAAnB,UAGQrN,SAAQ,SAAUC,EAAMkI,GAC9B,IAAMmF,EAAgBrN,EAAKsN,YACvBD,GACiBxC,EAAWyC,UAAUD,GAAeE,UAExCsI,QAAQ,YAAc,IAEnC5K,EAAeA,EAAaC,MAAM,CAChCZ,UAAW6C,EACX5C,aAAcrC,EACdsC,SAAU2C,EACV1C,YAAavC,EAAQ,EACrBiD,YAAY,EACZC,UAAU,IAEZP,EAAaC,WAAS0C,YAAY3C,EAAYI,EAAc,UAOlE,IA3ByE,iBA6BvE,IAAM8C,EAAQL,EAASxF,MACjB6G,EAAMrB,EAASxF,MAAQwF,EAAS,GAAG/I,OACnCmS,EAAe/H,EAAMhB,EACrBgJ,EAAiBb,EAAoBnI,EAGrCiJ,EAAoC,IAAjBF,KAA0BF,GAAczJ,IAAa0J,GAAuC,IAAnBE,GAE5FE,EAAmBH,EAAe,GAAMF,GAAazJ,IAAa0J,GAAuC,IAAnBE,EACtFG,EAAsBJ,EAAe,GAAMF,GAAazJ,IAAa0J,GAAuC,IAAnBE,GAA0BA,EAAiB,GAAOA,GAAkBD,EAE7JK,EAAkBL,EAAe,KAASF,GAAczJ,IAAa0J,GAAoBE,GAAkB,GAAOA,EAAiBD,GAGzI,GATyC,IAAjBA,GAAuBF,GAAazJ,IAAa0J,GAAuC,IAAnBE,EASzE,CAElB,IAAI9I,GADJpD,EAAaA,EAAWqD,aAAa,iBAAkB,UAAW,CAAE0H,YAAa,oBACtDxH,0BAC3BnD,EAAeA,EAAaC,MAAM,CAChCZ,UAAW6C,EACX3C,SAAU2C,EACV5C,aAAcwD,EACdtD,YAAasE,EACb5D,YAAY,EACZC,UAAU,IAGZP,EAAaC,WAAS0C,YAAY3C,EAAYI,EAAcgD,QAGzD,GAAI+I,EAAiB,CAExB,IAAI/I,GADJpD,EAAaA,EAAWqD,aAAa,kBAAmB,UAAW,CAAE0H,YAAa,qBACvDxH,0BAC3BnD,EAAeA,EAAaC,MAAM,CAChCZ,UAAW6C,EACX3C,SAAU2C,EACV5C,aAAcwD,EACdtD,YAAasE,EACb5D,YAAY,EACZC,UAAU,IAGZP,EAAaC,WAAS0C,YAAY3C,EAAYI,EAAcgD,QAGrDgJ,EAEPG,EAAU,mBAGHF,EAEPE,EAAU,sBAGHD,GACPC,EAAU,kBAKZ,SAASA,EAAUC,GAGjB,IAAIhD,GADJxJ,EAAaA,EAAWqD,aAAX,UAA2BmJ,EAA3B,SAA2C,UAAW,CAAEzB,YAAY,GAAD,OAAKyB,EAAL,YAChDjJ,0BAChCnD,EAAeA,EAAaC,MAAM,CAChCZ,UAAW6C,EACX3C,SAAU2C,EACV5C,aAAcwD,EACdtD,YAAasD,EAAQ,EACrB5C,YAAY,EACZC,UAAU,IAMZ,IAAIkJ,GADJzJ,GAFAA,EAAaC,WAAS0C,YAAY3C,EAAYI,EAAcoJ,IAEpCnG,aAAX,UAA2BmJ,EAA3B,SAA2C,UAAW,CAAEzB,YAAY,GAAD,OAAKyB,EAAL,YAChDjJ,0BAChCnD,EAAeA,EAAaC,MAAM,CAChCZ,UAAW6C,EACX3C,SAAU2C,EACV5C,aAAcwD,EAAQ,EACtBtD,YAAasE,EACb5D,YAAY,EACZC,UAAU,IAiBZP,GAXAA,GAHAA,EAAaC,WAAS0C,YAAY3C,EAAYI,EAAcqJ,IAGpCgD,gBACtBjD,EACA,CACEA,iBAAgBC,iBAChBiB,OAAQnI,EAAUmK,UAAUxJ,EAAOgB,GAAKzG,QAAQ,KAAM,IAEtDkP,OAAO,GAAD,OAAKrY,EAAL,YAAYiO,EAAUmK,UAAUxJ,EAAOgB,GAAKzG,QAAQ,KAAM,IAA1D,YAKcgP,gBACtBhD,EACA,CACED,iBAAgBC,iBAChBiB,OAAQnI,EAAUmK,UAAUxJ,EAAOgB,GAAKzG,QAAQ,KAAM,IAEtDkP,OAAO,GAAD,OAAKrY,EAAL,YAAYiO,EAAUmK,UAAUxJ,EAAOgB,GAAKzG,QAAQ,KAAM,IAA1D,aA5G+B,QAArCoF,EAAWC,EAAKG,KAAKV,KAAuB,OAwHtDrD,EAAa1J,cAAYiL,KAAKvB,EAAYc,EAAY,gBACtDd,EAAa1J,cAAYkL,gBAAgBxB,EAAYiD,GAmOpCyK,IAKfnJ,WAAY,CACV,CACEC,SA7cR,SAAyBC,EAAcC,EAAUC,GAE/CF,EAAaG,kBACX,SAAUC,GACR,IAAMX,EAAYW,EAAUtB,YAC5B,OAAqB,OAAdW,GAAsBS,EAAapB,UAAUW,GAAWV,UAAUsI,QAAQ,YAAc,IAEjGpH,IAucII,UA1lBR,SAAiB1O,GAEf,IAAQuO,EAAsFvO,EAAtFuO,aAAcT,EAAwE9N,EAAxE8N,UAA2DxJ,GAAatE,EAA7DgN,SAA6DhN,EAAnD2O,UAAmD3O,EAAxC4N,MAAwC5N,EAAjC4O,IAAiC5O,EAA5B6O,cAA4B7O,EAAbsE,UACjF,EAAwEiK,EAAapB,UAAUW,GAAWqH,UAAlGjB,EAAR,EAAQA,eAAgBC,EAAxB,EAAwBA,eAAgBiB,EAAxC,EAAwCA,OAAgBK,GAAxD,EAAgD4B,OAAhD,EAAwD5B,aAExD,GADclQ,cAC4H+C,MAAlIM,EAAR,EAAQA,gBAAiBI,EAAzB,EAAyBA,gBAAiBG,EAA1C,EAA0CA,iBAAkBX,EAA5D,EAA4DA,kBAAmBc,EAA/E,EAA+EA,iBAAqCK,GAApH,EAAiGD,kBAAjG,EAAoHC,kBAEpH,MAAqB,mBAAhB8L,EAED,uBAAMhQ,MAAO,CACXgD,SAAU,YADZ,UAME,cAACgM,GAAA,EAAD,CACEhP,MAAO,CAAE2J,QAAS,gBAClBsF,QAAS,CAAErR,KAAMuF,EAAiBiM,OAAQrM,EAAmB5E,MAAO0F,GACpEuL,OAAQ,cAAC5M,GAAA,EAAD,CAAQ6M,IAAI,UAAUrP,MAAO,CAAEgC,QAAS,MAChD7D,MAAO,cAACqR,GAAA,EAAD,CAAYjN,QAAQ,QAAQvC,MAAO,CAAE6J,SAAU,yBAA/C,SAA4EhL,OAEnF+K,YAAY,cAAC0E,EAAD,CAAOD,SAAUA,EAAUI,eAAgBA,EAAgBC,eAAgBA,EAAgBrG,UAAWA,OAIjG,oBAAhB2H,EAGL,sBAAMhQ,MAAO,CACXgD,SAAU,WACVQ,oBAAqB,QACrBC,uBAAwB,SAH1B,SAKG5E,IAMkB,yBAAhBmR,EAEL,uBAAMhQ,MAAO,CACXgD,SAAU,YADZ,UAKE,cAACgM,GAAA,EAAD,CACEC,QAAS,CAAErR,KAAMuF,EAAiBiM,OAAQrM,EAAmB5E,MAAO0F,GACpEuL,OAAQ,cAAC5M,GAAA,EAAD,CAAQ6M,IAAI,UAAUrP,MAAO,CAAEgC,QAAS,MAChD7D,MAAO,cAACqR,GAAA,EAAD,CAAYjN,QAAQ,QAAQvC,MAAO,CAAE6J,SAAU,yBAA/C,SAA4EhL,OAEnF+K,YAAY,cAAC0E,EAAD,CAAOD,SAAUA,EAAUI,eAAgBA,EAAgBC,eAAgBA,EAAgBrG,UAAWA,OAMjG,yBAAhB2H,EAGL,cAAChB,GAAA,EAAD,CACEC,QAAS,CAAErR,KAAM2F,EAAiBpF,MAAO+F,GACzC4N,KAAK,SACL3T,MAAO,cAACqR,GAAA,EAAD,CAAYjN,QAAQ,QAApB,SAA8B1D,MAUlB,4BAAhBmR,EAUL,aALA,CAKChB,GAAA,EAAD,CAEEC,QAAS,CAAErR,KAAMuF,EAAiBiM,OAAQrM,EAAmB5E,MAAO0F,GACpEuL,OAAQ,cAAC5M,GAAA,EAAD,CAAQ6M,IAAI,UAAUrP,MAAO,CAAEgC,QAAS,MAChD7D,MAAO,cAACqR,GAAA,EAAD,CAAYjN,QAAQ,QAAQvC,MAAO,CAAE6J,SAAU,yBAA/C,SAA4EhL,MAQhE,4BAAhBmR,EAGL,cAAChB,GAAA,EAAD,CACEC,QAAS,CAAErR,KAAM2F,EAAiBpF,MAAO+F,GACzC/F,MAAO,cAACqR,GAAA,EAAD,CAAYjN,QAAQ,QAApB,SAA8B1D,MAQlB,wBAAhBmR,EAEA,6BAIgB,wBAAhBA,EAIA,mCAIL,cAAChB,GAAA,EAAD,CACEC,QAAS,CAAErR,KAAM8F,EAAkBvF,MAAO+F,GAC1CkL,OAAQ,cAAC5M,GAAA,EAAD,CAAQ6M,IAAI,UAAU5M,IAAK+K,EAAUmC,IAAV,UAAsBpW,EAAtB,YAA6BoW,EAA7B,UAGnCxR,MAAO,cAACqR,GAAA,EAAD,CAAYjN,QAAQ,QAApB,SAA8B1D,aAbtC,MA8eLkT,cA3MF,YAA6E,IAApDC,EAAmD,EAAnDA,iBAAkBC,EAAiC,EAAjCA,oBAAwB1X,EAAS,kBAEpEmC,EAAQoD,cAEd,OACE,mCACE,cAACC,EAAA,EAAD,2BAAYxF,GAAZ,IAEEyF,MAAO,CAELC,gBAAiB+R,EAAmBtV,EAAMO,QAAQC,QAAQgD,KAAO,GAGjElD,MAA8B,UAAvBN,EAAMO,QAAQG,KACjB4U,EACEtV,EAAMO,QAAQC,QAAQiD,aACtBzD,EAAMO,QAAQC,QAAQgD,KACxB8R,EACEtV,EAAMO,QAAQC,QAAQiD,aACtBzD,EAAMO,QAAQmD,KAAKC,WAI3BC,QAAS,WAEP2R,GAAoB,SAAA7V,GAAG,OAAKA,MAnBhC,SAuBE,cAAC8V,GAAA,EAAD,UAgLNC,aAxKF,YAA4E,IAApDH,EAAmD,EAAnDA,iBAGtB,OAHyE,EAAjCC,oBAAiC,kBAIvE,cAACxQ,GAAA,EAAD,CACEzB,MAAO,CACLgD,SAAU,YAFd,SAUGgP,GAAoB,cAAC1D,EAAD,CAAOC,gBAAgB,QE1pBI6D,IAAhDlC,GAAR,GAAQA,cAAe6B,GAAvB,GAAuBA,cAAeI,GAAtC,GAAsCA,aAC9BE,GC/BO,WAGb,IAAIlO,EAAa,KAgLjB,MAAO,CAELkO,WAAY,CACVjM,SADU,SACDC,EADC,GACiC,IAAnBC,EAAkB,EAAlBA,eAItB,OAHAnC,EAAakC,EACYC,EACzBnC,EAnIN,WAEE,MAA+EA,EAAWG,eAAeG,UAAzG,mBAAOC,EAAP,KAAkBC,EAAlB,KAAgCC,EAAhC,KAA0CC,EAA1C,KAAuDU,EAAvD,KAAmEyL,EAAnE,KACA,EACI,CAAEzL,EAAyBX,EAAZF,EAAuBa,EAA4BV,EAAfF,EAA4BY,EAAab,EAAYE,EAAUW,EAAaZ,EAAeE,GADxGoM,EAA1C,KAA0DX,EAA1D,KAIMlJ,EAAejD,EAAWG,eAC5BW,EAAad,EAAWiB,oBACxBC,EAAelB,EAAWG,eAyG9B,OArGAH,EAAWiB,oBAAoBiC,mBAAmBlN,SAAQ,SAAUmN,GAClE,IAyCIQ,EAzCEP,EAAWD,EAAMmD,SAEjBjD,GADYF,EAAMK,UACNL,EAAMgL,WAGlBvK,EAAO,sFAqCb,IAnCgBT,EAAMwI,mBACd3V,SAAQ,SAAUC,EAAMkI,GAE9B,GAAIlI,EAAKsN,YAAa,CACpB,IAAM6K,EAAatN,EAAWyC,UAAUtN,EAAKsN,aAAaC,UAEtC,WAAf4K,GAA4C,YAAfA,IAChClN,EAAelB,EAAWG,eAAegB,MAAM,CAC7CZ,UAAW6C,EACX5C,aAAcrC,EACdsC,SAAU2C,EACV1C,YAAavC,EAAQ,EACrBiD,YAAY,EACZC,UAAU,IAEZP,EAAaC,WAAS0C,YAAY3C,EAAYI,EAAc,OAG5DjL,EAAKoY,YACUpY,EAAKoY,WAAW/N,UACpBgO,SAAS,eACpBpN,EAAelB,EAAWG,eAAegB,MAAM,CAC7CZ,UAAW6C,EACX5C,aAAcrC,EACdsC,SAAU2C,EACV1C,YAAavC,EAAQ,EACrBiD,YAAY,EACZC,UAAU,QAQ2B,QAArCsC,EAAWC,EAAKG,KAAKV,KAAsB,CAEjD,IAAMW,EAAQL,EAASxF,MACjB6G,EAAMrB,EAASxF,MAAQwF,EAAS,GAAG/I,OACnCmS,EAAe/H,EAAMhB,EACrBgJ,EAAiBb,EAAoBnI,EACrCuK,EAAclL,EAAUmK,UAAUxJ,EAAOgB,GACzCwJ,EAAW,IAAM7K,EAAS,GAK1B8K,GAAa5B,GAAczJ,IAAa0J,GAAoBE,GAAkB,GAAOA,EAAiBD,EAAe,EAK3H,GANeF,GAAazJ,IAAa0J,GAAoBE,EAAiB,GAAOA,GAAkBD,EAM3F,CAEV,IAAM7I,GADNpD,EAAaA,EAAWqD,aAAa,SAAU,UAAW,CAAEuK,SAAU,SAAUH,cAAaC,cAChEnK,0BAC7BnD,EAAelB,EAAWG,eAAegB,MAAM,CAC7CZ,UAAW6C,EACX5C,aAAcwD,EAAM,EACpBvD,SAAU2C,EACV1C,YAAasE,EACb5D,YAAY,EACZC,UAAU,IAEZP,EAAaC,WAAS0C,YAAY3C,EAAYI,EAAcgD,QAEzD,GAAIuK,EAAS,CAEhB,IAAMvK,GADNpD,EAAaA,EAAWqD,aAAa,UAAW,UAAW,CAAEuK,SAAU,UAAWH,cAAaC,cAClEnK,0BAC7BnD,EAAelB,EAAWG,eAAegB,MAAM,CAC7CZ,UAAW6C,EACX5C,aAAcwD,EAAM,EACpBvD,SAAU2C,EACV1C,YAAasE,EACb5D,YAAY,EACZC,UAAU,IAEZP,EAAaC,WAAS0C,YAAY3C,EAAYI,EAAcgD,QAelElE,EAAa1J,cAAYiL,KAAKvB,EAAYc,EAAY,mBACtDd,EAAa1J,cAAYkL,gBAAgBxB,EAAYiD,GAkBpC0L,IAIfpK,WAAY,CACV,CACEC,SAzJR,SAAsBC,EAAcC,EAAUC,GAE5CF,EAAaG,kBACX,SAAUC,GACR,IAAMX,EAAYW,EAAUtB,YAC5B,OACgB,OAAdW,IACkD,WAAhDS,EAAapB,UAAUW,GAAWV,WACc,YAAhDmB,EAAapB,UAAUW,GAAWV,aAIxCkB,IA8III,UA1LR,SAAuB1O,GAEPuF,cAAd,IACQgJ,EAA4EvO,EAA5EuO,aAAcT,EAA8D9N,EAA9D8N,UACtB,GADoF9N,EAAnDgN,SAAmDhN,EAAzC2O,UAAyC3O,EAA9B4N,MAA8B5N,EAAvB4O,IAAuB5O,EAAlB6O,cACtBN,EAAapB,UAAUW,GAAWqH,WAAtEmD,EAAR,EAAQA,SAER,OAFA,EAAkBH,YAAlB,EAA+BC,SAEd,WAAbE,GASkB,YAAbA,EAHL,aAJA,CAICE,GAAA,EAAD,UAAOxY,EAAMsE,gBAGZ,ODUcmU,GAAfX,WACR,GD1Be,WAEb,IAAIlO,EAAa,KACbC,EAAyB,KA2C7B,SAAS6O,EAAWrT,GAA2B,IAAnBsT,IAAkB,yDACxCpK,EAAe3E,EAAWiB,oBAC1BZ,EAAYL,EAAWG,eAGrBmI,GAFkB3D,EAAamB,qBACdnB,EAAaqB,oBACjB3F,EAAUuG,aACzBT,EAAqBxB,EAAazB,mBAChC8L,EAAerK,EAAa8B,eAAe6B,GAI3CE,GAHcwG,EAAaxL,UAGrB7I,MA0BZ,OAzBAwL,EACE4I,EAAS,CACJ,IAAIrG,eAAa,CAAEF,MAAKvP,KAAM,WAAYgD,KAAM,MAD5C,mBACuDkK,IADvD,sBAEDA,GAFC,CAEmB,IAAIuC,eAAa,CAAEF,MAAKvP,KAAM,WAAYgD,KAAM,OAE9E0I,EAAenO,eAAakQ,qBAAqBP,GAGjD9F,EAAYA,EAAUc,MAAM,CAC1BZ,UAAWiI,EACX/H,SAAU+H,EACVhI,aAAc,EACdE,YAAa,EACbU,YAAY,EACZC,UAAU,IAIZrB,EAAa1J,cAAYC,kBAAkBoO,GAE3C3E,EAAa1J,cAAYkL,gBAAgBxB,EAAYK,GACrDJ,EAAuBD,GACvBwG,YAAW,WACT/K,EAAOhE,QAAQ4E,UACd,GACI2D,EAKT,SAASiP,EAAYxT,GAA8B,IAAtByT,EAAqB,uDAAf,cAE7BvK,EAAe3E,EAAWiB,oBAC1BZ,EAAYL,EAAWG,eAErBmI,EAAajI,EAAUuG,YAIvBoI,GAFmBrK,EAAazB,mBAEjByB,EAAa8B,eAAe6B,IAE3C6G,EAAcH,EAAaxL,UAEb,aAAhB2L,GAA8C,gBAAhBA,GAAiD,eAAhBA,IAEnExK,EAAe5D,WAASqO,aAAazK,EAActE,EAA2B,aAAhB8O,EAA6BD,EAAMC,IAAgBD,EAAM,WAAaA,GAEpIlP,EAAa1J,cAAYiL,KAAKvB,EAAY2E,EAAc,qBACxD3E,EAAa1J,cAAYkL,gBAAgBxB,EAAYK,GAErDJ,EAAuBD,GACvBwG,YAAW,WACT/K,EAAOhE,QAAQ4E,UACd,IAoLL,MAAO,CAELgT,iBArJF,YAAiD,IAArB5T,EAAoB,EAApBA,OAAWrF,EAAS,kBAExCmC,EAAQoD,cACd,OAEE,cAACC,EAAA,EAAD,2BAAYxF,GAAZ,IAEEyF,MAAO,CAELhD,MAA8B,UAAvBN,EAAMO,QAAQG,KACjBV,EAAMO,QAAQC,QAAQgD,KACtBxD,EAAMO,QAAQmD,KAAKC,WAEzBC,QAAS,YAvJf,SAAqBV,GAEnB,IAAIkJ,EAAe3E,EAAWiB,oBAGxBqH,EAFUtI,EAAWG,eAEEyG,YAEzBT,EAAqBxB,EAAazB,mBAIhCiM,EAFexK,EAAa8B,eAAe6B,GAEhB9E,UAEjC,GAAqB,aAAhB2L,GAAgD,gBAAhBA,GAAmD,eAAhBA,GAAkD,eAAhBA,EAEtGhJ,EAAmBvL,QAAU,GAC/BoF,EAAa1J,cAAYiQ,cACzBC,YAAW,WACTvG,EAAuBD,GACvBvE,EAAOhE,QAAQ4E,UACd,KAML8J,EAAqBA,EAAmBC,QAAO,SAACnQ,GAC9C,OAAOA,EAAKuS,MAAQF,KAGtB3D,EAAenO,eAAakQ,qBAAqBP,GACjDnG,EAAa1J,cAAYC,kBAAkBoO,GAG3C1E,EAAuBD,IAsHjBsP,CAAY7T,IAThB,SAcE,cAAC8T,GAAA,EAAD,QAmIJC,iBA7HF,YAAiD,IAArB/T,EAAoB,EAApBA,OAAWrF,EAAS,kBAExCmC,EAAQoD,cACd,OAAO,cAACC,EAAA,EAAD,2BAAYxF,GAAZ,IAELyF,MAAO,CACLhD,MAA8B,UAAvBN,EAAMO,QAAQG,KACjBV,EAAMO,QAAQC,QAAQgD,KACtBxD,EAAMO,QAAQmD,KAAKC,WAEzBC,QAAS,WACP2S,EAAWrT,IARR,SAYL,cAACgU,GAAA,EAAD,CAAyB5T,MAAO,CAAE2C,UAAW,wBA+G/CkR,oBA3GF,YAAoD,IAArBjU,EAAoB,EAApBA,OAAWrF,EAAS,kBAE3CmC,EAAQoD,cACd,OAAO,cAACC,EAAA,EAAD,2BAAYxF,GAAZ,IAELyF,MAAO,CACLhD,MAA8B,UAAvBN,EAAMO,QAAQG,KACjBV,EAAMO,QAAQC,QAAQgD,KACtBxD,EAAMO,QAAQmD,KAAKC,WAEzBC,QAAS,WACP2S,EAAWrT,GAAQ,IARhB,SAYL,cAACgU,GAAA,EAAD,QA6FFE,kBAzFF,YAA6E,IAAhDlU,EAA+C,EAA/CA,OAAQmU,EAAuC,EAAvCA,WAA8BxZ,GAAS,EAA3ByZ,cAA2B,mBAGpEtX,EAAQoD,cACd,OAAO,cAACC,EAAA,EAAD,2BAAYxF,GAAZ,IAELyF,MAAO,CACLC,gBAAiB8T,EAAarX,EAAMO,QAAQC,QAAQgD,KAAO,GAC3DlD,MAA8B,UAAvBN,EAAMO,QAAQG,KACjB2W,EACErX,EAAMO,QAAQC,QAAQiD,aACtBzD,EAAMO,QAAQC,QAAQgD,KACxB6T,EACErX,EAAMO,QAAQC,QAAQiD,aACtBzD,EAAMO,QAAQmD,KAAKC,WAE3BC,QAAS,WACP8S,EAAYxT,EAAQ,gBAbjB,SAiBL,cAACqU,EAAA,EAAD,QAqEFC,iBAjEF,YAA0E,IAA9CtU,EAA6C,EAA7CA,OAAQuU,EAAqC,EAArCA,UAA4B5Z,GAAS,EAA1B6Z,aAA0B,mBAGjE1X,EAAQoD,cACd,OAAO,cAACC,EAAA,EAAD,2BAAYxF,GAAZ,IAELyF,MAAO,CACLC,gBAAiBkU,EAAYzX,EAAMO,QAAQC,QAAQgD,KAAO,GAC1DlD,MAA8B,UAAvBN,EAAMO,QAAQG,KACjB+W,EACEzX,EAAMO,QAAQC,QAAQiD,aACtBzD,EAAMO,QAAQC,QAAQgD,KACxBiU,EACEzX,EAAMO,QAAQC,QAAQiD,aACtBzD,EAAMO,QAAQmD,KAAKC,WAE3BC,QAAS,WACP8S,EAAYxT,EAAQ,eAbjB,SAiBL,cAACyU,GAAA,EAAD,QA6CFC,mBAzCF,YAA+C,IAAlB1U,EAAiB,EAAjBA,OAAUrF,EAAO,kBAEtCmC,EAAQoD,cACd,OAAO,cAACC,EAAA,EAAD,2BAAYxF,GAAZ,IACLyF,MAAO,CACLhD,MAA8B,UAAvBN,EAAMO,QAAQG,KACjBV,EAAMO,QAAQC,QAAQgD,KACtBxD,EAAMO,QAAQmD,KAAKC,WAEzBC,QAAS,YAvJb,SAAsBV,GAEpB,IAAIkJ,EAAe3E,EAAWiB,oBAC1BZ,EAAYL,EAAWG,eAErBmI,EAAajI,EAAUuG,YAEJjC,EAAazB,mBAEjByB,EAAa8B,eAAe6B,GAEhB9E,UAGjCmB,EAAe5D,WAASqO,aAAazK,EAActE,EAAW,cAE9DL,EAAa1J,cAAYiL,KAAKvB,EAAY2E,EAAc,qBACxD3E,EAAa1J,cAAYkL,gBAAgBxB,EAAYK,GAErDJ,EAAuBD,GACvBwG,YAAW,WACT/K,EAAOhE,QAAQ4E,UACd,GAkIC+T,CAAa3U,IAPV,SAUL,cAAC4U,GAAA,EAAD,QA6BFC,eAvBF,YAGE,OAHiC,oBAI/B,4CAqBFC,iBAAkB,CAChBtO,SAAU,SAAUC,EAAV,GAA4C,IAAnBC,EAAkB,EAAlBA,eAIjC,OAFAlC,EAAyBkC,EADzBnC,EAAakC,KCrRuGsO,GAApHD,GAAR,GAAQA,iBAAkBlB,GAA1B,GAA0BA,iBAAkBG,GAA5C,GAA4CA,iBAAkBE,GAA9D,GAA8DA,oBAAqBC,GAAnF,GAAmFA,kBAAmBI,GAAtG,GAAsGA,iBACtG,GE5Be,WAEb,IAAI/P,EAAa,KACbC,EAAyB,KAqJ7B,MAAO,CAGLkQ,mBApHF,YAA6F,EAA/D1U,OAAgE,IAAxDgV,EAAuD,EAAvDA,mBAAoBC,EAAmC,EAAnCA,sBAA0Bta,EAAS,kBAErFmC,EAAQoD,cACd,OAAO,cAACC,EAAA,EAAD,2BAAYxF,GAAZ,IAELyF,MAAO,CAELC,gBAAiB2U,EAAqBlY,EAAMO,QAAQC,QAAQgD,KAAO,GAGnElD,MAA8B,UAAvBN,EAAMO,QAAQG,KACjBwX,EACElY,EAAMO,QAAQC,QAAQiD,aACtBzD,EAAMO,QAAQC,QAAQgD,KACxB0U,EACElY,EAAMO,QAAQC,QAAQiD,aACtBzD,EAAMO,QAAQmD,KAAKC,WAQ3BC,QAAS,WAGPuU,GAAsB,SAAAzY,GAAG,OAAKA,MAxB3B,SA2BL,cAACoY,GAAA,EAAD,QAuFFC,eAjFF,YAAqI,IAA3G7U,EAA0G,EAA1GA,OAAQgV,EAAkG,EAAlGA,mBAE1BlY,GAF4H,EAA9EoY,aAA8E,EAAhEC,gBAAgE,EAA/CC,eAA+C,EAA/BC,kBAA+B,kBAEpHnV,eAId,OACE,cAACoV,GAAA,EAAD,CACElV,MAAO,CACL0B,SAAU,OACVC,SAAU,OAEVC,UAAWgT,EAAqB,OAAS,EAEzC/S,UAAW+S,EAAqB,OAAS,EAEzC9S,mBAAoB,6BACpBC,mBAAoB,OACpBC,QAAS4S,EAAqB,EAAI,EAElC3S,aAAcvF,EAAMwF,QAAQ,GAE5ByH,QAAS,OACTwL,eAAgB,iBAhBpB,SAoBGzY,EAAMI,mBAAmBT,KAAI,SAAC+Y,EAAK9S,GAClC,OACE,cAACvC,EAAA,EAAD,CAEEC,MAAO,CACLjD,gBAAiBqY,EAAIrY,gBACrB2M,eAAgB,UAChB2B,MAAO,OACP/H,OAAQ,QAEVhD,QAAS,YA1GrB,SAAsBV,EAAQyV,EAAQC,GAEpC,IAAIxM,EAAe3E,EAAWiB,oBAC1BZ,EAAYL,EAAWG,eAErBmI,EAAajI,EAAUuG,YAEJjC,EAAazB,mBAEjByB,EAAa8B,eAAe6B,GAEhB9E,UAKjCmB,EAAe5D,WAASqO,aAAazK,EAActE,EAA0C,cAC7FsE,EAAe5D,WAASqQ,aAAazM,EAActE,EAAW,CAAC4Q,IAAIC,EAAOC,cAC1EnR,EAAa1J,cAAYiL,KAAKvB,EAAY2E,EAAc,qBACxD3E,EAAa1J,cAAYkL,gBAAgBxB,EAAYK,GAErDJ,EAAuBD,GACvBwG,YAAW,WACT/K,EAAOhE,QAAQ4E,UACd,GAoFS+T,CAAa3U,EAASwV,EAAIrY,gBAAiBqY,EAAIpY,OAAO,WATnDsF,SAqDfkT,gBAAiB,CAEfC,aAAa,SAAUnO,KAMvBlB,SAAU,SAAUC,EAAV,GAA4C,IAAnBC,EAAkB,EAAlBA,eAGjC,OADAlC,EAAyBkC,EADzBnC,EAAakC,KF3I2CqP,GAAxDF,GAAR,GAAQA,gBAAiBlB,GAAzB,GAAyBA,mBAAoBG,GAA7C,GAA6CA,eAKhC5R,GAAYC,cAAW,SAAApG,GAGlC,IAAMiZ,EAAM,GAWZ,OATAjZ,EAAMI,mBAAmB3C,SAAQ,SAACyb,EAAStT,GACzCqT,EAAI,MAAQrT,GAASsT,KAIvB3Z,QAAQC,IAAIyZ,GAIL,2BACFA,GADL,IAEEE,eAAgB,YAAwD,EAArD9a,QAAqD,EAA5CnB,qBAE1B,MAAO,CAELkc,YAAa,MAAO9R,YAAa,OACjC+R,YALoE,EAAtBC,gBAKftZ,EAAMO,QAAQC,QAAQgD,KAAOxD,EAAMO,QAAQmD,KAAKC,UAM/E4V,UAAW,YACXC,WAAY,WACZC,UAAW,aAUfC,iBAAkB,WAChB,MAAO,CAELtS,YAAapH,EAAMwF,QAAQ,GAC3B6B,aAAcrH,EAAMwF,QAAQ,KAGhCmU,cAAe,WACb,MAAO,CACLC,OAAQ,EACRC,QAAS,EAETlL,MAAO,OACP/H,OAAQ,EACRgI,cAAe,WAGnBkL,eAAgB,WACd,MAAO,CAGL1S,YAAapH,EAAMwF,QAAQ,GAC3B6B,aAAcrH,EAAMwF,QAAQ,GAC5BhE,UAAW,WAIfuY,cAAe,WACb,MAAO,CACL3S,YAAapH,EAAMwF,QAAQ,GAC3B6B,aAAcrH,EAAMwF,QAAQ,GAC5BhE,UAAW,QAQfwY,cAAe,WAGb,MAAO,CACL1T,SAAU,WACV2G,QAAS,OACT1J,gBAAiB,QAEjBqD,OAAQ,EACRgI,cAAe,SACfqL,WAAY,SACZxB,eAAgB,SAEhBxT,SAAU,OAUV+H,eAAgB,UAIhB,UAAW,CACTxL,UAAW,SACX8E,SAAU,WACVC,IAAK,MACLN,UAAW,sBAajBiU,WAAY,SAAArc,GAEV,MAAO,CACLsc,WAAY,mDAEZ,UAAW,CAAEA,WAAY,2DAU3BC,GAAe,CACnBC,UAAW,GAUXC,OAAQ,IAqCK,SAASC,KAEtB,MASIC,qBAAW1d,GATPuB,EAAR,EAAQA,QAASC,EAAjB,EAAiBA,WAAYpB,EAA7B,EAA6BA,qBAC3BiB,EADF,EACEA,cACAC,EAFF,EAEEA,iBACA4D,EAHF,EAGEA,UAAWC,EAHb,EAGaA,UAAWJ,EAHxB,EAGwBA,WACtBtD,EAJF,EAIEA,OAAQC,EAJV,EAIUA,UACCE,GALX,EAKED,QALF,EAKWC,YACGE,GANd,EAMED,WANF,EAMcC,eAIRoB,EAAQoD,cAId,EAAgCtF,oBAAS,GAAzC,mBAAOkF,EAAP,KAAiBC,EAAjB,KACA,EAAoCnF,oBAAS,GAA7C,mBAAOmG,EAAP,KAAmBC,EAAnB,KACA,EAA0CpG,oBAAS,GAAnD,mBAAOuG,EAAP,KAAsBC,EAAtB,KACA,EAAkCxG,oBAAS,GAA3C,mBAAOgM,EAAP,KAAkBC,EAAlB,KACA,EAAkCjM,oBAAS,GAA3C,mBAAOoM,EAAP,KAAkBC,EAAlB,KAGA,EAA4CrM,oBAAS,GAArD,mBAAO2G,EAAP,KAAuBC,EAAvB,KACA,EAAgD5G,oBAAS,GAAzD,oBAAOwX,GAAP,MAAyBC,GAAzB,MACA,GAAoDzX,oBAAS,GAA7D,qBAAOoa,GAAP,MAA2BC,GAA3B,MAEA,GAAoCra,oBAAS,GAA7C,qBAAOuZ,GAAP,MAAmBC,GAAnB,MACA,GAAkCxZ,oBAAS,GAA3C,qBAAO2Z,GAAP,MAAkBC,GAAlB,MAGA,GAA8C5Z,oBAAS,GAAvD,qBAAOwb,GAAP,MAAwBmB,GAAxB,MAIMvX,GAASpE,mBACf,GAAkIqH,GAAU,CAAE9H,UAASib,mBAAiBpc,yBAAhKic,GAAR,GAAQA,eAA4BO,IAApC,GAAwBQ,WAAxB,GAAoCR,kBAAkBC,GAAtD,GAAsDA,cAAeG,GAArE,GAAqEA,eAAgBC,GAArF,GAAqFA,cAAeC,GAApG,GAAoGA,cAAkBU,GAAtH,mBAKA,GAAsC5c,mBAASC,cAAYC,kBAAkB2c,yBAAeP,MAA5F,qBAAOzQ,GAAP,MAAoBC,GAApB,MAUA,SAASgR,GAAUzc,GAAkC,IAAnB0c,EAAkB,uDAAT,QAGnCC,EAAUC,aACd5c,EAAcuK,oBACd,CACEsS,gBAAiB,MAEjBC,aAAc,CACZ1R,MAAO,CAAEjG,MAAO,CAAE1C,SAAUoB,EAAUH,KAEtC2H,MAAO,CAAElG,MAAO,CAAE1C,SAAUqB,EAAUJ,MAMxCkX,aAAc,SAAUnO,GACtB,IAAMlK,EAAOkK,EAAMK,UAGnB,MAAa,aAATvK,EACK,CACLwa,WAAY,GAIZ5X,MAAO,CACL8D,YAAa,MACbC,aAAc,QAIP,gBAAT3G,EACK,CACLwa,WAAY,CACVrO,UAAWiN,KAIJ,eAATpZ,EACK,CACLwa,WAAY,CACVrO,UAAWkN,KAQJ,eAATrZ,EAEK,CACLwa,WAAY,CAEVC,WAAY,OACZC,UAAWxQ,EAAMoI,UAAUqI,OAAO3C,IAClC4C,UAAW1Q,EAAMoI,UAAUqI,OAAOzC,iBAPxC,GAiBF2C,eAAgB,CACdC,WAAY,SAAU5Q,GACPA,EAAMgL,UACNhL,EAAMoI,UAAU1K,WAChBsC,EAAMK,UAInB,MAAO,sBAAe4P,EAAf,MAA4BY,OAAO7Q,EAAMgL,WAAa,cASjE8F,cAAe,SAAUC,GACvB,MAAkCA,EAAOrT,WAAjC5H,EAAR,EAAQA,KAAMjB,EAAd,EAAcA,KAAd,EAAoBmc,UACpB,GAAa,oBAATlb,EACF,MAAO,CACLwY,QAAS,mBAGb,GAAa,wBAATxY,EAEF,MAAO,CAELwY,QAAS,sBACTgC,WAAY,CACVhG,OAAQzV,EAAKyV,OACbjC,OAAQxT,EAAKwT,QAEf3P,MAAO,IAGX,GAAa,wBAAT5C,EAEF,MAAO,CAELwY,QAAS,sBACTgC,WAAY,CACVhG,OAAQzV,EAAKyV,OACbjC,OAAQxT,EAAKwT,SAMnB,GAAa,UAATvS,EAGF,OAFAnB,QAAQC,IAAIC,EAAK5C,KAEV,CACLqc,QAAS,QACTgC,WAAY,CACVhG,OAAQzV,EAAK5C,IACbgP,OAAQpM,EAAKoM,SAOnB,GAAa,YAATnL,EAAoB,CAEsBjB,EAApC0W,SAAoC1W,EAA1BuW,YAA0BvW,EAAbwW,SAC/B,MAAO,CACLiD,QAAS,UACTgC,WAAW,eACNzb,QASf,OAAOqb,EAIT,OA9JA/a,qBAAU,WACRkO,YAAW,WACT/K,GAAOhE,QAAQ4E,QACf/F,cAAY8d,eAAelS,MAC1B,KACF,IA2JD,eAACmS,GAAA,EAAD,CAAWC,gBAAgB,EAA3B,UAOE,eAACvD,GAAA,EAAD,CAAKlV,MAAO,CACViC,aAAc,MAEd0H,QAAS,OAAQgN,WAAY,SAAUxB,eAAgB,aAAcuD,UAAU9O,WAAW,QAE1F+O,IAAKjc,EAAMwF,QAAQ,IALrB,UAQE,cAACT,GAAA,EAAD,CAEEzB,MAAK,2BAEC4J,aAAa2G,aAAc,CAAEvS,YAAatB,EAAMwF,QAAQ,KAFzD,IAGHyH,QAAS,OAAQgN,WAAY,SAAUxB,eAAgB,aAAcuD,SAAU,OAC/EC,IAAKjc,EAAMwF,QAAQ,GACnBmJ,MAAO,gBAPX,SASE,eAACuN,GAAA,EAAD,CAAarW,QAAQ,OAAOvC,MAAO,GAAnC,UAEE,cAAC,GAAD,CAAYJ,OAAQA,GAAQF,SAAUA,EAAUC,YAAaA,IAC7D,cAAC,GAAD,CAAcC,OAAQA,GAAQe,WAAYA,EAAYC,cAAeA,IACrE,cAAC,GAAD,CAAiBhB,OAAQA,GAAQmB,cAAeA,EAAeC,iBAAkBA,IAEjF,cAAC,GAAD,CAAapB,OAAQA,GAAQ4G,UAAWA,EAAWC,aAAcA,IACjE,cAAC,GAAD,CAAa7G,OAAQA,GAAQgH,UAAWA,EAAWC,aAAcA,SAMrE,cAACpF,GAAA,EAAD,CACEzB,MAAO,CAEL2J,QAAS,OAAQgN,WAAY,SAAUxB,eAAgB,aAAcuD,SAAU,OAC/EC,IAAKjc,EAAMwF,QAAQ,GACnBmJ,MAAO,eALX,SAOE,eAACuN,GAAA,EAAD,CAAarW,QAAQ,OAAOvC,MAAO,GAAnC,WAEI4J,YAAY,cAAC,GAAD,CAAa5M,MAAM,UAAUM,SAAS,QAAQ6D,eAAgBA,EAAgBC,kBAAmBA,IAE/G,cAAC,GAAD,CAAepE,MAAM,UAAUM,SAAS,QAAQ0U,iBAAkBA,GAAkBC,oBAAqBA,KAEzG,cAAC,GAAD,CAAajV,MAAM,UAAUM,SAAS,QAAQrC,OAAQA,EAAQC,UAAWA,EAAW0E,OAAQA,UAIhG,cAAC6B,GAAA,EAAD,CACEzB,MAAO,CAEL2J,QAAS,OAAQgN,WAAY,SAAUxB,eAAgB,aAAcuD,SAAU,OAC/EC,IAAKjc,EAAMwF,QAAQ,GACnBmJ,MAAO,eALX,SAOE,eAACuN,GAAA,EAAD,CAAarW,QAAQ,OAAOvC,MAAO,GAAnC,UACE,cAAC,GAAD,CAAkBJ,OAAQA,KAC1B,cAAC,GAAD,CAAkBA,OAAQA,KAC1B,cAAC,GAAD,CAAqBA,OAAQA,KAC7B,cAAC,GAAD,CAAmBA,OAAQA,GAAQmU,WAAYA,GAAYC,cAAeA,KAC1E,cAAC,GAAD,CAAkBpU,OAAQA,GAAQuU,UAAWA,GAAWC,aAAcA,KACtE,cAAC,GAAD,CAAoBxU,OAAQA,GAAQ5C,MAAM,UAAUM,SAAS,QAAQsX,mBAAoBA,GAAoBC,sBAAuBA,KAEpI,cAAC9U,EAAA,EAAD,CAEEO,QAAS,WACPtF,GAAW,SAAAoB,GAAG,OAAKA,KACnBwD,GAAOhE,QAAQ4E,SAEjBR,MAAO,CACLhD,MAA8B,SAAvBN,EAAMO,QAAQG,KAEjBV,EAAMO,QAAQmD,KAAKC,UACnB3D,EAAMO,QAAQC,QAAQgD,MAV9B,SAcGnF,EACG,cAAC8d,GAAA,EAAD,IACA,cAACC,GAAA,EAAD,cASZ,cAACrX,GAAA,EAAD,CAEEkN,UAAWqH,GAAkB,EAAI,EAEjC/G,QAAS,CAAErR,KAAMiY,IACjB7V,MAAO,GAOPM,QAAS,WAEP,IAAIyY,EAAete,cAAYue,mBAAmB3S,IAElDC,GAAe7L,cAAYwe,eAAeF,EAAc1S,GAAY/B,iBACpE6S,IAAmB,IAjBvB,SAqBE,cAAC,IAAD,CACE7N,IAAK,SAAUsM,GAAWhW,GAAOhE,QAAUga,GAC3CvP,YAAaA,GAGbD,SAAU,SAAUqK,EAAV,GAAkC,oBAAC,IAG3C,EAAkDA,EAAS1L,wBAAwBC,WAA3EkU,EAAR,EAAQA,KAAMC,EAAd,EAAcA,OAAQC,EAAtB,EAAsBA,UAAWnT,EAAjC,EAAiCA,MAAOC,EAAxC,EAAwCA,MAClC1B,EAAYiM,EAASnM,eACrBwE,EAAe2H,EAASrL,oBACxBqH,EAAajI,EAAU6U,cAEvB/F,EADexK,EAAa8B,eAAe6B,GAChB9E,UAEjCqM,GAA8B,gBAAhBV,GACdc,GAA6B,eAAhBd,GAGb6D,GAAmB3S,EAAUgB,UAE7B7F,EAAY2Z,QAAQJ,IACpBtY,EAAc0Y,QAAQH,IACtBnY,EAAiBsY,QAAQF,IACzB3S,EAAa6S,QAAQrT,IACrBY,EAAayS,QAAQpT,IAErBpL,EAAiB2V,GACjBnK,GAAemK,IAIjB8I,QACE,CAEEpT,GACAkH,GACAlG,GACA+I,GACAmC,GACAqC,GACAc,IAOJgE,yBAAyB,EAEzBC,eACEC,IAAUC,IAAI,IAOhBC,cAAe,SAAU5Z,EAAOsH,GAE9B,IAAMuS,EAAa7Z,EAAMgF,WAEzB,GAAI6U,EAAW5T,OAAS4T,EAAW3T,WAG9B,IAAIoT,QAAQO,EAAW5T,OAC1B,MAAO,CAEL3I,SAAUoB,EAAUH,IAGnB,GAAI+a,QAAQO,EAAW3T,OAC1B,MAAO,CAEL5I,SAAUqB,EAAUJ,IAGnB,GAAI+a,QAAQO,EAAWC,QAE1B,MAAO,CACLnQ,QAAS,OACTwL,eAAgB,YAQtB4E,eACEL,IAAUC,IAAI,IAchBlE,aAAc,SAAUnO,GACtB,IAAMlK,EAAOkK,EAAMK,UACbvH,EAAOkH,EAAMgL,UAMnB,GAAa,aAATlV,EACF,OAAOgZ,GAET,GAAc,WAAThZ,GAAgC,mBAATgD,EAC1B,OAAOiW,GAET,GAAa,gBAATjZ,EACF,OAAOoZ,GAET,GAAa,eAATpZ,EACF,OAAOqZ,GAET,GAAa,eAATrZ,EAAuB,CACzBnB,QAAQC,IAAIkb,IACZ,IAAM/B,EAAS/N,EAAMoI,UAAUqI,OAAO3C,IAChC9S,EAAQ5F,EAAMI,mBAAmBmO,WAAU,SAAA7Q,GAC/C,OAAOA,EAAK2C,kBAAoBsY,KAGlC,OAAOqB,GAAgB,IAAMU,GAAQ,MAAQ9U,KAIjD0X,gBAAiB,SAAU1S,GAEzB,IAAMlH,EAAOkH,EAAMgL,UAEblV,GADOkK,EAAMoI,UAAU1K,WAChBsC,EAAMK,WAEnB,MAAe,WAATvK,GAAgC,mBAATgD,GAAyC,eAAThD,EAEpD,CACL6L,UAAW,SAAa1O,GAAS,OAAO,cAAC,GAAD,2BAAeA,GAAf,IAAsBU,OAAQA,EAAQC,UAAWA,EAAW0E,OAAQA,OAC5Gqa,UAAU,GAKL,MAIXnJ,iBAAkB,SAAUC,EAAS1K,EAAagK,EAAhC,GAAmE,EAAlBO,eAEjD,SAAZG,GACFpR,GAAY,SAAAvD,GAAG,OAAKA,KAEpBkK,GAAeV,YAAUkL,iBAAiBzK,EAAa0K,KAEpC,WAAZA,GACPnQ,GAAc,SAAAxE,GAAG,OAAKA,KAEtBkK,GAAeV,YAAUkL,iBAAiBzK,EAAa0K,KAEpC,cAAZA,IACP/P,GAAiB,SAAA5E,GAAG,OAAKA,KAEzBkK,GAAeV,YAAUkL,iBAAiBzK,EAAa0K,UAO/D,cAAChR,EAAA,EAAD,CAAQwC,QAAQ,YAAYvF,MAAM,UAAU8O,UAAU,EAEpD9L,MAAO,CAAE2J,QAAS,QAAS0B,MAAO,OAAQzJ,UAAWlF,EAAMwF,QAAQ,IACnE5B,QAAS,SAAUC,GAEjBX,GAAOhE,QAAQ4E,QAGf,IAAM+W,EAASrJ,OAAO7O,KAAKC,MAAsB,IAAhBD,KAAKE,WAAuB,IAAMtE,EAAO8D,OAc1E,GAXAlD,IAAMqe,KAAN,UAAc3gB,EAAd,YAA6B,CAC3B4gB,UAAW,MACX7d,QAASgb,GAAUzc,EAAe0c,GAClCA,WACCxb,MAAK,SAACC,GAGPC,QAAQC,IAAIF,EAASG,SAInBlB,EAAO8D,OAAS,EAAG,CAErB,IAAM5C,EAAO,IAAIie,SACXzE,EAAM,CAAEwE,UAAW,MAAOE,QAAS,IACzCpf,EAAOd,SAAQ,SAACmgB,EAAKhY,GACnB,IAAMiY,EAAQhD,EAAS,IAAMjV,EAC7BnG,EAAKqe,OAAO,OAAQF,GACpB3E,EAAI0E,QAAQ3U,KAAK6U,GACjBD,EAAIC,MAAQA,EACZte,QAAQC,IAAIqe,MAIdpe,EAAKqe,OAAO,MAAOC,KAAKC,UAAU/E,IAElC9Z,IAAMqe,KAAN,UAAc3gB,EAAd,0BAA2C4C,EAAM,CAC/CiS,QAAS,CAAE,eAAgB,yBAO/BhT,GAAW,SAAAgB,GAAS,MAAM,CAAEkb,GAAUzc,EAAe,UAAjC,mBAA8CuB,OAClEd,GAAc,SAAAc,GAAS,MAAM,CAAEnB,GAAR,mBAAmBmB,QA9C9C,kBAmDA,cAAC,GAAD,CACEwD,OAAQA,GACRgV,mBAAoBA,MAIpBhL,YAAY,cAAC,GAAD,CAAYzI,eAAgBA,IAE1C,cAAC,GAAD,CAAc6Q,iBAAkBA,Q,kNG9uBvB,SAAS2I,GAAT,GAA4B,EAAT3a,MAAU,IAAD,EAEzC,EAIIkX,qBAAW1d,GAHb2B,GADF,EAAQN,cAAR,EAAuBC,iBAAvB,EAAyC4D,UAAzC,EAAoDC,UAApD,EAA+DJ,WAA/D,EAA2EtD,OAA3E,EAAmFC,UAAnF,EACEC,SACAE,GAFF,EACWD,WADX,EAEEC,YACAI,GAHF,EAEcH,cAFd,EAGEG,eAGIiB,EAAQoD,cACd,EAAwG+C,GAAU,IAA1GgT,EAAR,EAAQA,eACR,GADA,EAAwBe,WAAxB,EAAoCR,iBAApC,EAAsDC,cAAtD,EAAqEG,eAArE,EAAqFC,cACqDmE,MAAhGlX,GAA1C,EAAQP,gBAAR,EAAyBI,gBAAzB,EAA0CG,kBAA0EQ,GAApH,EAA4DnB,kBAA5D,EAA+Ec,iBAA/E,EAAiGI,kBAAjG,EAAoHC,kBAGpH,SAAS2W,EAAOrD,EAASpM,EAAQ0P,GAsF/B,OApFaC,KAAgBvD,EAAS,CAIpC7U,UAAW,SAASqY,EAAYC,EAAM3Y,GAIpC,GAAkB,WAAd2Y,EAAK9O,KACP,OAAQ2O,GAAU,cAACI,GAAD,CAAoBjgB,OAAQmQ,EAAQiP,QAASY,EAAKE,QAAQC,IAA7C9Y,GAEjC,GAAkB,UAAd2Y,EAAK9O,KAGP,OACE,cAACqD,GAAA,EAAD,CAAYjN,QAAQ,QAElBvC,MAAO,CACLwJ,iBAAkB,YAClBC,mBAAoB,gBACpBC,eAAgB,UAChBC,QAAS,eACTzL,UAAW,QACXlB,MAAO,gBACPD,gBAAiBke,EAAKE,QAAQvJ,OAC9BjP,WAAWiH,WAAW,cACtB7L,WAAwC,IAA5BrB,EAAMW,WAAWC,SAC7BU,YAAyC,IAA5BtB,EAAMW,WAAWC,UAZlC,SAcE2d,EAAKE,QAAQ5S,QAbRjG,GAgBX,GAAkB,wBAAd2Y,EAAK9O,KACP,OAAQ,wBAAW7J,GAErB,GAAkB,wBAAd2Y,EAAK9O,KAAgC,CAEvC,IAAMkP,EAAM,GAIZ,OAHAJ,EAAKpc,SAAS1E,SAAQ,SAAAyb,GACpByF,EAAI3V,KAAK4V,gCAAqB1F,OAG9B,cAAC5G,GAAA,EAAD,CAAMC,QAAS,CAAErR,KAAM8F,EAAkBvF,MAAO+F,GAE9CkL,OAAQ,cAAE5M,GAAA,EAAF,CAAS6M,IAAK,KAAM5M,IAAKwY,EAAKE,QAAQvJ,OAAOlP,QAAQ,OAAQ,IAAIA,QAAQ,IAAK,MAEtFvE,MACE,cAACqR,GAAA,EAAD,CAAYjN,QAAQ,QAApB,SACG8Y,EAAIhf,KAAI,SAACuZ,EAAStT,GACjB,OAAO,+BAAmBsT,GAARtT,SANnBA,GAcX,GAAIH,OAAOC,KAAK6Y,EAAKE,SAAW,IAAI1I,SAAS,cAAe,CAE1D,IAAM4I,EAAM,GACNE,EAAO,GACPzD,EAAYmD,EAAKE,QAAQrD,UACzBE,EAAYiD,EAAKE,QAAQnD,UAM/B,OALAiD,EAAKpc,SAAS1E,SAAQ,SAAAC,GAEpBihB,EAAI3V,KAAmB,QAAdtL,EAAKgD,KAAiBhD,EAAOA,EAAK+B,MAC3Cof,EAAK7V,KAAK4V,gCAAqBlhB,OAG/B,cAACohB,GAAD,CAAcH,IAAKA,EAAKL,YAAaA,EAAa1Y,MAAOA,EAAOiZ,KAAMA,EAAMzD,UAAWA,EAAWE,UAAWA,EAAW8C,OAAQA,GAAazb,KAAKE,UAGtJ,GAAkB,YAAd0b,EAAK9O,KAAoB,CAE3B,IAAMkP,EAAM,GAIZ,OAHAJ,EAAKpc,SAAS1E,SAAQ,SAAAyb,GACpByF,EAAI3V,KAAK4V,gCAAqB1F,OAEzB,+BAAkB,cAAC6F,GAAD,CAASZ,OAAQA,EAAQI,KAAMA,EAAM7P,OAAQA,EAAQ9I,MAAOA,KAAnEA,OAS1B,IAAMoZ,GAAoB,mBACvBhf,EAAMhD,YAAYiiB,OAAO9hB,GAAK,GADP,cAEvB6C,EAAMhD,YAAYiiB,OAAO7hB,GAAK,GAFP,cAGvB4C,EAAMhD,YAAYiiB,OAAO5hB,GAAK,GAHP,cAIvB2C,EAAMhD,YAAYiiB,OAAO3hB,GAAK,GAJP,cAKvB0C,EAAMhD,YAAYiiB,OAAO1hB,GAAK,GALP,GAQ1B,EAA+B2hB,aAAU,CAEvCC,UAAW,GACXC,aAAa,EACbC,eAAe,IAJTzS,EAAR,EAAQA,IAAKwR,EAAb,EAAaA,OAAb,EAAqBkB,MAiBrB,OAVAvf,qBAAU,WACRkO,YAAW,WACLmQ,GACFrf,EAAcN,EAAQ4D,UAEvB,OAGF,CAAC5D,EAAS2f,IAGX,mCAEE,eAACtC,GAAA,EAAD,CAAWC,gBAAgB,EAA3B,UAEE,cAAC,KAAD,CACEwD,eAAgBP,EAChBnS,UAAU,kBACV2S,gBAAgB,yBAHlB,SAMG/gB,EAAQkB,KAAI,SAAUjC,EAAMkI,GAM3B,OAcE,aAbA,CAaC6Z,GAAD,CAAchhB,QAASA,EAASE,WAAYA,EAAYiH,MAAOA,EAAOuT,eAAgBA,EAAgBgF,OAAQA,SAQpH,qBAAK7a,MAAO,CAAEsW,OAAQ,OAAQrW,gBAAiB,OAAQoL,MAAO,OAAQ/H,OAAQ,OAAOtB,QAAQ,GAAKsH,IAAKA,EAAvG,SAA6GwR,EAAS,UAU9H,SAASqB,GAAT,GAA+E,IAAvDhhB,EAAsD,EAAtDA,QAASE,EAA6C,EAA7CA,WAAYiH,EAAiC,EAAjCA,MAAOuT,EAA0B,EAA1BA,eAAgBgF,EAAU,EAAVA,OAElE,EAA+Be,aAAU,CAEvCC,UAAW,EACXC,aAAa,EACbC,eAAe,IAJTzS,EAAR,EAAQA,IAAKwR,EAAb,EAAaA,OAAb,EAAqBkB,MAQrB,OACE,cAACva,GAAA,EAAD,CAAOwN,QAAS,CAAErR,KAAMiY,GAAkBlH,UAAW,EAAGrF,IAAKA,EAC3DtJ,MAAO,CAAE2B,SAAU,SAAU4U,QAAS,MAAOL,WAAY,UAD3D,SAIG2E,EAAO1f,EAAQmH,GAAQjH,EAAWiH,GAAQwY,IAHgCxY,GAcjF,SAAS4Y,GAAT,GAAgD,IAA9BjgB,EAA6B,EAA7BA,OAAQof,EAAqB,EAArBA,QAGlB3d,GAHuC,kBAG/BoD,eACRqL,EAAqB,UAAZkP,EAAsBpf,EAAO8D,OAASqd,OAAO/B,EAAQgC,MAAM,KAAK,IACzEjR,EAASnQ,EAIf,EAAoCT,mBAAS,GAA7C,mBAAO8hB,EAAP,KAAmBC,EAAnB,KACA,EAA4B/hB,oBAAS,GAArC,mBAAOgiB,EAAP,KAAeC,EAAf,KAEA,GAAe,IAAXtR,EAAc,CAEhB,IAAMuR,EAAqB,UAAZrC,EACX,CAACjP,EAAO,GAAGM,UACX,CAAC,GAAD,OAAInS,EAAJ,oCAAmC8gB,EAAnC,OAGJ,OAIE,qBAAKra,MAAO,CAEVgD,SAAU,WACVqI,MAAO,OACP/H,OAAQ,EACRgI,cAAe,SAEf9B,iBAAkB,YAClBgC,oBAAqB,SACrBC,oBAAqB,SACrB/B,eAAgB,QAChB3M,gBAA6B,UAAZsd,EAAsB,OAASjP,EAAO,GAAGM,SAAW,IAApD,cAAiEnS,EAAjE,oCAAgG8gB,EAAhG,OAEjBpa,gBAAiBvD,EAAMO,QAAQsO,QAC/B5J,SAAU,UAETrB,QAAS,WAEVmc,GAAU,IAlBZ,SAsBGD,GAAU,cAAC,KAAD,CACTG,QAASD,EAAOJ,GAChBM,QAASF,GAAQJ,EAAa,GAAKI,EAAO3d,QAC1C8d,QAASH,GAAQJ,EAAaI,EAAO3d,OAAS,GAAK2d,EAAO3d,QAC1D+d,eAAgB,kBAAML,GAAU,IAChCM,kBAAmB,kBACjBR,GACE,SAAAngB,GAAG,OAAKA,EAAMsgB,EAAO3d,OAAS,GAAK2d,EAAO3d,WAG9Cie,kBAAmB,kBACjBT,GACE,SAAAngB,GAAG,OAAKA,EAAMsgB,EAAO3d,OAAS,GAAK2d,EAAO3d,eAUjD,GAAe,IAAXoM,EAAc,CAErB,IAAMuR,EAAqB,UAAZrC,EACX,CAACjP,EAAO,GAAGM,SAAUN,EAAO,GAAGM,UAC/B,CAAC,GAAD,OAAInS,EAAJ,oCAAmC8gB,EAAnC,gBAAmD9gB,EAAnD,oCAAkF8gB,EAAlF,OAGJ,OAIE,sBAAKra,MAAO,CACVgD,SAAU,WACVqI,MAAO,OACP/H,OAAQ,EACRgI,cAAe,SACfE,oBAAqB,SACrBC,oBAAqB,SACrBxL,gBAAiBvD,EAAMO,QAAQsO,QAC/B5J,SAAU,UARZ,UAcE,qBAAK3B,MAAK,aACRgD,SAAU,WACVqI,MAAO,MACP/H,OAAQ,OAERrD,gBAAiB,OACjBiD,KAAM,KACND,IAAK,KACLuG,iBAAkB,YAClB7H,SAAU,SACV6J,oBAAqB,SACrBC,oBAAqB,SACrB/B,eAAgB,QAEhB3M,gBAA6B,UAAZsd,EAAsB,OAASjP,EAAO,GAAGM,SAAW,IAApD,cAAiEnS,EAAjE,oCAAgG8gB,EAAhG,OACjB1X,UAAW,oCAfH,kBAgBS,SAEjBrC,QAAS,WACPic,EAAc,GACdE,GAAU,MAKd,qBAAKzc,MAAK,aACRgD,SAAU,WACVqI,MAAO,MACP/H,OAAQ,OAERrD,gBAAiB,QACjBiD,KAAM,MACND,IAAK,KACLuG,iBAAkB,YAClB7H,SAAU,SACV6J,oBAAqB,SACrBC,oBAAqB,SACrB/B,eAAgB,QAEhB3M,gBAA6B,UAAZsd,EAAsB,OAASjP,EAAO,GAAGM,SAAW,IAApD,cAAiEnS,EAAjE,oCAAgG8gB,EAAhG,OAEjB1X,UAAW,mCAhBH,kBAiBS,SAEjBrC,QAAS,WAEPic,EAAc,GACdE,GAAU,MAKbD,GAAU,cAAC,KAAD,CACTG,QAASD,EAAOJ,GAChBM,QAASF,GAAQJ,EAAa,GAAKI,EAAO3d,QAC1C8d,QAASH,GAAQJ,EAAaI,EAAO3d,OAAS,GAAK2d,EAAO3d,QAC1D+d,eAAgB,kBAAML,GAAU,IAChCM,kBAAmB,kBACjBR,GACE,SAAAngB,GAAG,OAAKA,EAAMsgB,EAAO3d,OAAS,GAAK2d,EAAO3d,WAG9Cie,kBAAmB,kBACjBT,GACE,SAAAngB,GAAG,OAAKA,EAAMsgB,EAAO3d,OAAS,GAAK2d,EAAO3d,gBAUjD,GAAe,IAAXoM,EAAc,CAErB,IAAMuR,EAAqB,UAAZrC,EACX,CAACjP,EAAO,GAAGM,SAAUN,EAAO,GAAGM,SAAUN,EAAO,GAAGM,UACnD,CAAC,GAAD,OAAInS,EAAJ,oCAAmC8gB,EAAnC,gBAAmD9gB,EAAnD,oCAAkF8gB,EAAlF,gBAAkG9gB,EAAlG,oCAAiI8gB,EAAjI,OAEJ,OAIE,sBAAKra,MAAO,CACVgD,SAAU,WACVqI,MAAO,OACP/H,OAAQ,EACRgI,cAAe,SACfE,oBAAqB,SACrBC,oBAAqB,SACrBxL,gBAAiBvD,EAAMO,QAAQsO,QAC/B5J,SAAU,UARZ,UAaE,qBAAK3B,MAAK,aACRgD,SAAU,WACVqI,MAAO,MACP/H,OAAQ,OAERrD,gBAAiB,OACjBiD,KAAM,KACND,IAAK,KACLuG,iBAAkB,YAClB7H,SAAU,SACV6J,oBAAqB,SACrBC,oBAAqB,SACrB/B,eAAgB,QAEhB3M,gBAA6B,UAAZsd,EAAsB,OAASjP,EAAO,GAAGM,SAAW,IAApD,cAAiEnS,EAAjE,oCAAgG8gB,EAAhG,OAEjB1X,UAAW,oCAhBH,kBAiBS,SAEjBrC,QAAS,WAEPic,EAAc,GACdE,GAAU,MAId,qBAAKzc,MAAO,CACVgD,SAAU,WACVqI,MAAO,MACP/H,OAAQ,MACRrD,gBAAiB,QACjBiD,KAAM,MACND,IAAK,KACLuG,iBAAkB,YAClB7H,SAAU,SACV6J,oBAAqB,SACrBC,oBAAqB,SACrB/B,eAAgB,QAEhB3M,gBAA6B,UAAZsd,EAAsB,OAASjP,EAAO,GAAGM,SAAW,IAApD,cAAiEnS,EAAjE,oCAAgG8gB,EAAhG,OACjB1X,UAAW,oCAGVrC,QACD,WAEEic,EAAc,GACdE,GAAU,MAGd,qBAAKzc,MAAO,CACVgD,SAAU,WACVqI,MAAO,MACP/H,OAAQ,MACRrD,gBAAiB,QACjBiD,KAAM,MACND,IAAK,MACLuG,iBAAkB,YAClB7H,SAAU,SACV6J,oBAAqB,SACrBC,oBAAqB,SACrB/B,eAAgB,QAEhB3M,gBAA6B,UAAZsd,EAAsB,OAASjP,EAAO,GAAGM,SAAW,IAApD,cAAiEnS,EAAjE,oCAAgG8gB,EAAhG,OACjB1X,UAAW,mCAEVrC,QACD,WAEEic,EAAc,GACdE,GAAU,MAGbD,GAAU,cAAC,KAAD,CACTG,QAASD,EAAOJ,GAChBM,QAASF,GAAQJ,EAAa,GAAKI,EAAO3d,QAC1C8d,QAASH,GAAQJ,EAAaI,EAAO3d,OAAS,GAAK2d,EAAO3d,QAC1D+d,eAAgB,kBAAML,GAAU,IAChCM,kBAAmB,kBACjBR,GACE,SAAAngB,GAAG,OAAKA,EAAMsgB,EAAO3d,OAAS,GAAK2d,EAAO3d,WAG9Cie,kBAAmB,kBACjBT,GACE,SAAAngB,GAAG,OAAKA,EAAMsgB,EAAO3d,OAAS,GAAK2d,EAAO3d,gBAgBpD,IAAM2d,EAAqB,UAAZrC,EACX,CAACjP,EAAO,GAAGM,SAAUN,EAAO,GAAGM,SAAUN,EAAO,GAAGM,SAAUN,EAAO,GAAGM,UACvE,CAAC,GAAD,OAAInS,EAAJ,oCAAmC8gB,EAAnC,gBAAmD9gB,EAAnD,oCAAkF8gB,EAAlF,gBAAkG9gB,EAAlG,oCAAiI8gB,EAAjI,gBAAiJ9gB,EAAjJ,oCAAgL8gB,EAAhL,OAGJ,OAGE,sBAAKra,MAAO,CACVgD,SAAU,WACVqI,MAAO,OACP/H,OAAQ,EACRgI,cAAe,SACfE,oBAAqB,SACrBC,oBAAqB,SACrBxL,gBAAiBvD,EAAMO,QAAQsO,QAC/B5J,SAAU,UARZ,UAaE,qBAAK3B,MAAO,CACVgD,SAAU,WACVqI,MAAO,MACP/H,OAAQ,MACRrD,gBAAiB,QACjBgD,IAAK,KACLC,KAAM,KACNsG,iBAAkB,YAClB7H,SAAU,SACV6J,oBAAqB,SACrBC,oBAAqB,SACrB/B,eAAgB,QAEhB3M,gBAA6B,UAAZsd,EAAsB,OAASjP,EAAO,GAAGM,SAAW,IAApD,cAAiEnS,EAAjE,oCAAgG8gB,EAAhG,OAEjB1X,UAAW,qCAEVrC,QAAS,WAEVic,EAAc,GACdE,GAAU,MAGZ,qBAAKzc,MAAO,CACVgD,SAAU,WACVqI,MAAO,MACP/H,OAAQ,MACRrD,gBAAiB,QACjBgD,IAAK,KACLC,KAAM,MACNsG,iBAAkB,YAClB7H,SAAU,SACV6J,oBAAqB,SACrBC,oBAAqB,SACrB/B,eAAgB,QAEhB3M,gBAA6B,UAAZsd,EAAsB,OAASjP,EAAO,GAAGM,SAAW,IAApD,cAAiEnS,EAAjE,oCAAgG8gB,EAAhG,OACjB1X,UAAW,oCAEVrC,QAAS,WAEVic,EAAc,GACdE,GAAU,MAGZ,qBAAKzc,MAAO,CACVgD,SAAU,WACVqI,MAAO,MACP/H,OAAQ,MACRrD,gBAAiB,QACjBgD,IAAK,MACLC,KAAM,KACNsG,iBAAkB,YAClB7H,SAAU,SACV6J,oBAAqB,SACrBC,oBAAqB,SACrB/B,eAAgB,QAEhB3M,gBAA6B,UAAZsd,EAAsB,OAASjP,EAAO,GAAGM,SAAW,IAApD,cAAiEnS,EAAjE,oCAAgG8gB,EAAhG,OACjB1X,UAAW,oCAEXrC,QACE,WAEEic,EAAc,GACdE,GAAU,MAIhB,qBAAKzc,MAAO,CACVgD,SAAU,WACVqI,MAAO,MACP/H,OAAQ,MACRrD,gBAAiB,QACjBgD,IAAK,MACLC,KAAM,MACNsG,iBAAkB,YAClB7H,SAAU,SACV6J,oBAAqB,SACrBC,oBAAqB,SACrB/B,eAAgB,QAEhB3M,gBAA6B,UAAZsd,EAAsB,OAASjP,EAAO,GAAGM,SAAW,IAApD,cAAiEnS,EAAjE,oCAAgG8gB,EAAhG,OACjB1X,UAAW,mCAEVrC,QACD,WAEEic,EAAc,GACdE,GAAU,MAEbD,GAAU,cAAC,KAAD,CACTG,QAASD,EAAOJ,GAChBM,QAASF,GAAQJ,EAAa,GAAKI,EAAO3d,QAC1C8d,QAASH,GAAQJ,EAAaI,EAAO3d,OAAS,GAAK2d,EAAO3d,QAC1D+d,eAAgB,kBAAML,GAAU,IAChCM,kBAAmB,kBACjBR,GACE,SAAAngB,GAAG,OAAKA,EAAMsgB,EAAO3d,OAAS,GAAK2d,EAAO3d,WAG9Cie,kBAAmB,kBACjBT,GACE,SAAAngB,GAAG,OAAKA,EAAMsgB,EAAO3d,OAAS,GAAK2d,EAAO3d,gBAyBxD,SAAS0c,GAAT,GAA4D,EAAzCZ,OAA0C,IAAlCI,EAAiC,EAAjCA,KAAM3Y,EAA2B,EAA3BA,MAEzB5F,GAFoD,EAApB0O,OAAoB,kBAE5CtL,eACRmd,EAAOhC,EAAKE,QAAQ+B,SACpBC,EAAUlC,EAAKE,QAAQiC,YAI7B,EAA8B5iB,mBAASyiB,EAAKI,OAAO,IAAnD,mBAAO/gB,EAAP,KAAgBghB,EAAhB,KAEMjC,EAAM,GAKZ,OAJAJ,EAAKpc,SAAS1E,SAAQ,SAACyb,EAAStT,GAC9B+Y,EAAI3V,KAAK4V,gCAAqB1F,OAI9B,sBACE2H,OAAO,SAEPvd,MAAO,CACLhD,MAAON,EAAMO,QAAQC,QAAQgD,KAC7BiP,OAAQ,WAEV7O,QAAS,SAAUC,GACjBA,EAAEid,kBACFF,EACE,cAACvK,GAAA,EAAD,CAAM0K,KAAMN,EAASI,OAAO,SAASG,IAAI,WAAzC,SACGrC,EAAIhf,KAAI,SAACuZ,EAAStT,GAEjB,OAAOsT,SAbjB,SAoBE,+BAAmBtZ,GAARgG,KASjB,SAASkZ,GAAT,GAAwG,IAAhF1D,EAA+E,EAA/EA,UAAWE,EAAoE,EAApEA,UAAWgD,EAAyD,EAAzDA,YAAmB1Y,GAAsC,EAA5C2Y,KAA4C,EAAtC3Y,OAAO+Y,EAA+B,EAA/BA,IAAKE,EAA0B,EAA1BA,KAAMT,EAAoB,EAApBA,OAEjF,GAFqG,kBAEjEtgB,oBAAS,IAA7C,mBAAOmjB,EAAP,KAAmBC,EAAnB,KAEA,OACE,cAAC,KAAD,CAEExX,SAAU,SAAUyX,GAClBD,EAAcC,IAIhB7d,MAAK,2BAIA8a,GAAU,CAAE/d,gBAAiB+a,IAJ7B,IAKH9a,MAAOgb,EAKPtO,eAAgB,QAChB1G,SAAU,WAEV/C,gBAAiB,QAEjBqD,OAAQ,EAERgI,cAAe,SACf3B,QAAS,OACTgN,WAAYgH,EAAa,aAAe,SACxCxI,eAAgB,SAChBxT,SAAU,SA5Bd,SAiCE,qBAAK3B,MAAK,qCACR9B,UAAW,SACX8E,SAAU2a,EAAa,QAAU,aAC7BA,GAAc,CAAE1a,IAAK,SACrB0a,GAAc,CAAEhb,UAAW,qBAJvB,IAOR4T,QAAS,MACTL,WAAY,aARd,SAWGmF,EAAIhf,KAAI,SAACjC,EAAMkI,GAEd,MAAkB,SAAdlI,EAAK+R,MACP/R,EAAKyE,SAAWzE,EAAKyE,SAAS0L,QAAO,SAAAnQ,GACnC,MAAqB,OAAdA,EAAK+R,QAEPmP,gCAAqBlhB,IAIZ,QAAdA,EAAKgD,KAAyB,+BAAmBhD,GAARkI,GACtB,SAAdlI,EAAK+R,KACLoP,EAAKjZ,GAGL,+BAAoB0Y,EAAY5gB,EAAMkI,IAA3BA,SArDnBA,GC7pBIwb,OArDf,WAqBE,OAnB0B5G,qBAAW1d,GAA7BiC,cAqBN,qCACE,cAACsiB,EAAA,EAAD,IAGA,cAACC,EAAA,EAAD,CAAMC,WAAS,EACbC,UAAU,MACV/I,eAAe,eACfwB,WAAW,aACXzU,QAAS,EAJX,SAME,cAAC8b,EAAA,EAAD,CAAM5jB,MAAI,EAACP,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,EAAGC,GAAI,EAA9C,SAEE,cAACgd,GAAD,QASJ,cAAC0D,GAAD,QChDSwD,GAZS,SAAAC,GAClBA,GAAeA,aAAuBC,UACxC,8BAAqBtiB,MAAK,YAAkD,IAA/CuiB,EAA8C,EAA9CA,OAAQC,EAAsC,EAAtCA,OAAQC,EAA8B,EAA9BA,OAAQC,EAAsB,EAAtBA,OAAQC,EAAc,EAAdA,QAC3DJ,EAAOF,GACPG,EAAOH,GACPI,EAAOJ,GACPK,EAAOL,GACPM,EAAQN,OCEdO,IAASC,OACP,cAAC,IAAMC,WAAP,UACE,cAACvkB,EAAD,UACE,cAAC,GAAD,QAGJwkB,SAASC,eAAe,SAI1BZ,O","file":"static/js/main.71d33d97.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/logo.6ce24c58.svg\";","let url=\"\"\r\n\r\nif(process.env.NODE_ENV === \"development\"){\r\n\r\n   // url=\"http://localhost/api\"\r\n    url=\"http://192.168.0.100/api\"\r\n}\r\nelse{\r\n    url=\"/api\"\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nexport default url;","import React, { createContext, useEffect, useState, useReducer, useRef, useMemo, useCallback, useLayoutEffect } from 'react';\r\n\r\nimport { createTheme, ThemeProvider, responsiveFontSizes, } from \"@material-ui/core\";\r\nimport useMediaQuery from '@material-ui/core/useMediaQuery';\r\nimport primaryColor from '@material-ui/core/colors/indigo';\r\n\r\nimport { EditorState, ContentState, ContentBlock, CharacterMetadata, SelectionState, convertToRaw, convertFromRaw, RichUtils, Modifier, convertFromHTML, AtomicBlockUtils } from 'draft-js';\r\n\r\n\r\nimport { makeStyles, styled, useTheme, } from '@material-ui/core/styles';\r\nimport createBreakpoints from '@material-ui/core/styles/createBreakpoints';\r\nimport {\r\n  isMobile,\r\n  isFirefox,\r\n  isChrome,\r\n  browserName,\r\n  engineName,\r\n} from \"react-device-detect\";\r\n\r\nimport axios from 'axios';\r\nimport url from './config';\r\n\r\nimport yellow from '@material-ui/core/colors/yellow';\r\nexport const Context = createContext();\r\nconst breakpoints = createBreakpoints({})\r\n\r\nfunction breakpointsAttribute(...args) {\r\n\r\n  let xs = {}\r\n  let sm = {}\r\n  let md = {}\r\n  let lg = {}\r\n  let xl = {}\r\n\r\n  args.forEach(item => {\r\n    xs = { ...xs, [item[0]]: item[1] }\r\n    sm = { ...sm, [item[0]]: item[2] || item[1] }\r\n    md = { ...md, [item[0]]: item[3] || item[2] || item[1] }\r\n    lg = { ...lg, [item[0]]: item[4] || item[3] || item[2] || item[1] }\r\n    xl = { ...xl, [item[0]]: item[5] || item[4] || item[3] || item[2] || item[1] }\r\n  })\r\n\r\n\r\n  return {\r\n    [breakpoints.only('xs')]: { ...xs },\r\n    [breakpoints.only('sm')]: { ...sm },\r\n    [breakpoints.only('md')]: { ...md },\r\n    [breakpoints.only('lg')]: { ...lg },\r\n    [breakpoints.only('xl')]: { ...xl },\r\n  }\r\n}\r\n\r\n\r\n\r\nexport default function ContextProvider(props) {\r\n\r\n\r\n  const [editorContent, setEditorContent] = useState(\r\n    EditorState.createWithContent(ContentState.createFromText(''))\r\n  );\r\n\r\n  const [isLight, setIsLight] = useState(true)\r\n  const [picArr, setPicArr] = useState([])\r\n\r\n  const [postArr, setPostArr] = useState([])\r\n  const [postPicArr, setPostPicArr] = useState([])\r\n\r\n  const postCount = useRef(0)\r\n\r\n\r\n  const getSinglePost = useCallback(function (num) {\r\n\r\n    if (num < postCount.current || num===0){\r\n      axios.get(`${url}/article/singlepost/${num}`).then(response => {\r\n\r\n        console.log(response.data)\r\n\r\n        setPostArr(pre => { return [...pre, ...response.data.map(item => item.content),] })\r\n        setPostPicArr(pre => [...pre, \"\"])\r\n      })\r\n    }\r\n  })\r\n\r\n  // const [backImageArr, setBackImageArr] = useState(\r\n  //   [\r\n  //     \"url(https://mernchen.herokuapp.com/api/picture/download/60b7028076fa440017fb5779)\",\r\n  //     \"url(https://mernchen.herokuapp.com/api/picture/download/60b6f77fae1acf0017a96c4b)\",\r\n  //     \"url(https://mernchen.herokuapp.com/api/picture/download/60b701a9dc07780017dcfd38)\",\r\n  //   ])\r\n\r\n  // const [backImageIndex, setBackImageIndex] = useState(0)\r\n\r\n\r\n  const sizeArr = [\"1.5rem\", \"1.5rem\", \"1.5rem\", \"1.5rem\", \"1.5rem\"]\r\n  const iconSizeArr = [\"2rem\", \"2rem\", \"2rem\", \"2rem\", \"2rem\"]\r\n  //const iconSizeArr = [\"1.5rem\", \"1.5rem\", \"1.5rem\", \"1.5rem\", \"1.5rem\"]\r\n\r\n  useEffect(function () {\r\n    axios.get(`${url}/article/count`).then(response => {\r\n      postCount.current = response.data\r\n    })\r\n    //   axios.get(`${url}/article/singlepost/0`).then(response => {\r\n\r\n    //     console.log(response.data)\r\n\r\n    //     setPostArr(response.data.map(item => item.content))\r\n    //     setPostPicArr(new Array(response.data.length))\r\n    //   })\r\n    //   //picture/downloadpicture/905137_Capture-_887.PNG\r\n\r\n    //   // axios.get(`${url}/picture/downloadpicture`).then(response => {\r\n\r\n    //   //   console.log(response.data)\r\n    //   //   setPostArr(response.data.map(item => item.content))\r\n    //   // })\r\n\r\n  }, [])\r\n\r\n\r\n\r\n  const theme = useMemo(function () {\r\n\r\n    let muiTheme = createTheme({\r\n\r\n      backgourndImageArr: [\r\n        // { backgroundImage: \"url(https://picsum.photos/800/450)\",color:\"orange\"},\r\n        // { backgroundImage: \"url(https://picsum.photos/960/540)\",color:\"red\"},\r\n        // { backgroundImage: \"url(https://picsum.photos/880/490)\",color:\"yellow\"},\r\n        // { backgroundImage: \"url(https://picsum.photos/1024/576)\",color:\"pink\"},\r\n\r\n        // { backgroundImage: \"url(https://cors-anywhere.herokuapp.com/https://photo.weibo.com/7354287965/wbphotos/large/mid/4643997090057849/pid/0081HQfPly1gr50t2i2uaj31040kc0up)\"}\r\n\r\n        //\"url(https://picsum.photos/800/450)\"\r\n\r\n        { backgroundImage: \"url(https://mernchen.herokuapp.com/api/picture/download/60b7028076fa440017fb5779)\", color: \"darkgray\" },\r\n        { backgroundImage: \"url(https://mernchen.herokuapp.com/api/picture/download/60b6f77fae1acf0017a96c4b)\", color: \"orange\" },\r\n        { backgroundImage: \"url(https://mernchen.herokuapp.com/api/picture/download/60b701a9dc07780017dcfd38)\", color: \"white\" },\r\n        { backgroundImage: \"url(https://picsum.photos/1024/576)\", color: \"white\" },\r\n      ],\r\n      palette: {\r\n        primary: primaryColor,\r\n        type: isLight ? 'light' : \"dark\",\r\n        // mentionBackColor: isLight ? \"#b7e1fc\" : muiTheme.palette.primary.light,\r\n      },\r\n      typography: {\r\n        fontSize: 14,\r\n        button: { textTransform: 'none' },\r\n        body2: breakpointsAttribute([\"fontSize\", ...sizeArr])\r\n      },\r\n\r\n      overrides: {\r\n\r\n        MuiAvatar: {\r\n          root: {\r\n            ...breakpointsAttribute([\"width\", ...iconSizeArr], [\"height\", ...iconSizeArr]),\r\n          }\r\n        },\r\n\r\n        MuiSvgIcon: {\r\n          root: {\r\n            ...breakpointsAttribute([\"fontSize\", ...iconSizeArr]),\r\n          }\r\n        },\r\n        MuiChip: {\r\n          root: {\r\n            \"& .MuiChip-avatar\": {\r\n              color: \"#616161\",\r\n              marginLeft: \"5px\",\r\n              marginRight: \"-6px\",\r\n              objectFit: \"cover\",\r\n              textAlign: \"center\",\r\n\r\n              ...breakpointsAttribute([\"width\", ...sizeArr], [\"height\", ...sizeArr])\r\n            },\r\n          },\r\n          label: {\r\n            \"& > .MuiTypography-root.MuiTypography-body2\": {\r\n              ...breakpointsAttribute([\"fontSize\", \"1.2rem\", \"1.2rem\"]),\r\n            }\r\n          }\r\n        },\r\n      },\r\n    })\r\n    muiTheme.palette.mentionBackColor = isLight ? \"#b7e1fc\" : muiTheme.palette.primary.light;\r\n    return muiTheme\r\n  }, [isLight])\r\n\r\n\r\n  const xs = useMediaQuery(theme.breakpoints.only('xs'));\r\n  const sm = useMediaQuery(theme.breakpoints.only('sm'));\r\n  const md = useMediaQuery(theme.breakpoints.only('md'));\r\n  const lg = useMediaQuery(theme.breakpoints.only('lg'));\r\n  const xl = useMediaQuery(theme.breakpoints.only('xl'));\r\n\r\n  const deviceSize = xs ? \"xs\" : sm ? \"sm\" : md ? \"md\" : lg ? \"lg\" : \"xl\"\r\n  const lgSizeObj = { xs: \"2.5rem\", sm: \"2.5rem\", md: \"2.5rem\", lg: \"2.5rem\", xl: \"2.5rem\" }\r\n  const smSizeObj = { xs: \"1rem\", sm: \"1rem\", md: \"1rem\", lg: \"1rem\", xl: \"1rem\" }\r\n\r\n  //const [picArr, setPicArr] = useState([])\r\n\r\n\r\n  // theme.typography.body2 = {\r\n  //   ...breakpointsFontSize([\"fontSize\", \"2.5rem\", \"1.5rem\"])\r\n  // };\r\n  //theme = responsiveFontSizes(theme);\r\n\r\n  // console.log(theme)\r\n\r\n\r\n  return (\r\n    <Context.Provider value={{\r\n      isLight, setIsLight, theme, breakpointsAttribute, editorContent,\r\n      setEditorContent, lgSizeObj, smSizeObj, deviceSize,\r\n      picArr, setPicArr,\r\n      postArr, setPostArr,\r\n      postPicArr, setPostPicArr,\r\n      getSinglePost,\r\n      // backImageArr, setBackImageArr,\r\n      // backImageIndex, setBackImageIndex,\r\n\r\n    }}>\r\n      <ThemeProvider theme={theme}>\r\n        {props.children}\r\n      </ThemeProvider>\r\n    </Context.Provider>\r\n  )\r\n\r\n\r\n}","import React, { useState, useRef, useEffect } from 'react';\r\n\r\nimport Immutable from 'immutable'\r\nimport axios from \"axios\"\r\n\r\nimport { Typography, Button, ButtonGroup, Container, Grid } from \"@material-ui/core\";\r\nimport { CropOriginal, Image, Brightness4, Brightness5, FormatBold, FormatItalic, AddPhotoAlternateOutlined } from \"@material-ui/icons\";\r\nimport { makeStyles, styled, useTheme } from '@material-ui/core/styles';\r\n\r\nimport {\r\n  EditorState, ContentBlock,\r\n  CharacterMetadata, SelectionState, convertToRaw,\r\n  convertFromRaw, RichUtils, Modifier, convertFromHTML,\r\n  AtomicBlockUtils, ContentState\r\n}\r\n  from 'draft-js';\r\nimport {\r\n  isMobile,\r\n  isFirefox,\r\n  isChrome,\r\n  browserName,\r\n  engineName,\r\n} from \"react-device-detect\";\r\n\r\n\r\n\r\nexport default function createImagePlugin() {\r\n  let externalES = null;\r\n  let externalSetEditorState = null;\r\n\r\n\r\n\r\n  function insertImageBlock0(url, id, imgdata) {\r\n\r\n\r\n\r\n    // const contentState = externalES.getCurrentContent();\r\n    // const contentStateWithEntity = contentState.createEntity(\"imageBlock\", 'IMMUTABLE', { url, id, imgdata });\r\n\r\n    // const entityKey = contentStateWithEntity.getLastCreatedEntityKey();\r\n\r\n\r\n    // externalES = EditorState.set(\r\n    //   externalES,\r\n    //   { currentContent: contentStateWithEntity },\r\n    // );\r\n    externalES = AtomicBlockUtils.insertAtomicBlock(externalES, null, 'imageBlockText')\r\n    externalSetEditorState(externalES)\r\n\r\n  }\r\n\r\n\r\n  function insertImageBlock1(url, id = \"\", imgdata = \"\") {\r\n\r\n    //   if ((picArr.length===0) && hasImageBlock()) {\r\n    //  //   alert(\"aaa\")\r\n    //     removeImageBlog()\r\n    //   }\r\n\r\n\r\n    const selection = externalES.getSelection();\r\n\r\n    let contentState = externalES.getCurrentContent();\r\n\r\n\r\n\r\n    const currentBlock = contentState.getBlockForKey(selection.getEndKey());\r\n    const blockMap = contentState.getBlockMap()\r\n\r\n\r\n\r\n    const blocksBefore = blockMap.toSeq().takeUntil(function (v) { return v === currentBlock })\r\n    const blocksAfter = blockMap.toSeq().skipUntil(function (v) { return v === currentBlock }).rest()\r\n\r\n\r\n    const newBlockKey = id + genKey()\r\n\r\n    const newBlockKey2 = id + genKey()\r\n\r\n\r\n\r\n\r\n    let newBlocks =\r\n      [\r\n        [currentBlock.getKey(), currentBlock],\r\n        [newBlockKey, new ContentBlock({\r\n          key: newBlockKey,\r\n          type: \"imageBlock\",\r\n          text: '',\r\n          data: Immutable.fromJS({ imgUrl: url, imgId: id, imgData: imgdata }),\r\n        })],\r\n        [newBlockKey2, new ContentBlock({\r\n          key: newBlockKey2,\r\n          type: \"unstyled\",\r\n          text: '',\r\n\r\n        })],\r\n      ];\r\n\r\n\r\n    const newBlockMap = blocksBefore.concat(newBlocks, blocksAfter).toOrderedMap()\r\n    contentState = contentState.merge({\r\n      blockMap: newBlockMap,\r\n\r\n      selectionBefore: selection,//.merge({ hasFocus: true,}),\r\n      selectionAfter: selection.merge({\r\n        anchorKey: newBlockKey2,\r\n        anchorOffset: 0,\r\n        focusKey: newBlockKey2,\r\n        focusOffset: 0,\r\n        isBackward: false,\r\n        hasFocus: true,\r\n      }),\r\n    })\r\n\r\n\r\n    externalES = EditorState.push(externalES, contentState, 'insert-fragment');\r\n    externalSetEditorState(externalES)\r\n\r\n\r\n  };\r\n\r\n  function insertImageBlock(editor) {\r\n\r\n\r\n    let contentState = externalES.getCurrentContent();\r\n    const selection = externalES.getSelection()\r\n\r\n    const currentKey = selection.getEndKey()\r\n    const currentBlock = contentState.getBlockForKey(selection.getEndKey());\r\n\r\n\r\n    let newContentBlockArr = contentState.getBlocksAsArray()\r\n    const selectionBefore = contentState.getSelectionBefore()\r\n    const selectionAfter = contentState.getSelectionAfter()\r\n\r\n    let currentIndex = newContentBlockArr.findIndex(item => { return item.key === currentKey })\r\n    currentIndex = currentIndex >= 0 ? currentIndex : newContentBlockArr.length - 1\r\n    console.log(currentIndex)\r\n\r\n    newContentBlockArr.splice(currentIndex + 1, 0,\r\n      new ContentBlock({\r\n        key: genKey(),\r\n        type: \"imageBlock\",\r\n        text: '',\r\n      })\r\n    )\r\n\r\n    contentState = ContentState.createFromBlockArray(newContentBlockArr)\r\n    contentState = contentState.merge({\r\n      selectionAfter, //newBlockMap,\r\n      selectionBefore,\r\n    })\r\n\r\n\r\n    // externalES = EditorState.createWithContent(contentState)\r\n    externalES = EditorState.push(externalES, contentState, 'insert-fragment');\r\n    externalSetEditorState(externalES)\r\n  }\r\n\r\n\r\n\r\n\r\n  function removeImageBlog0() {\r\n\r\n    const selection = externalES.getSelection();\r\n    let contentState = externalES.getCurrentContent();\r\n    const blockMap = contentState.getBlockMap();\r\n\r\n    const imageBlog = contentState.getBlocksAsArray().find(item => { return item.type === \"imageBlock\" || item.type === \"atomic\" })\r\n    const blockNum = contentState.getBlocksAsArray().length\r\n\r\n\r\n    if (Boolean(imageBlog) && (blockNum === 1)) {\r\n      let externalES_ = EditorState.createEmpty()\r\n      contentState = externalES_.getCurrentContent()\r\n      externalES = EditorState.push(externalES_, contentState, 'insert-fragment');\r\n      setTimeout(() => {\r\n        externalSetEditorState(externalES_)\r\n      }, 0);\r\n      return null\r\n    }\r\n\r\n    if (imageBlog) {\r\n      const atomicBlock = imageBlog\r\n\r\n      contentState = Modifier.removeRange(\r\n        contentState,\r\n        new SelectionState({\r\n          anchorKey: atomicBlock.getKey(),\r\n          anchorOffset: 0,\r\n          focusKey: atomicBlock.getKey(),\r\n          focusOffset: atomicBlock.getLength(),\r\n        }),\r\n        'backward',\r\n      );\r\n\r\n      const blockMap = contentState.getBlockMap().delete(atomicBlock.getKey());\r\n      contentState = contentState.merge({\r\n        blockMap,\r\n        // selectionAfter: selection,\r\n      });\r\n\r\n\r\n      externalES = EditorState.push(externalES, contentState, 'remove-range');\r\n      externalSetEditorState(externalES)\r\n\r\n    }\r\n\r\n\r\n  }\r\n\r\n  function removeImageBlog1() {\r\n\r\n    const selection = externalES.getSelection();\r\n    let contentState = externalES.getCurrentContent();\r\n    const blockMap = contentState.getBlockMap();\r\n\r\n    const imageBlog = contentState.getBlocksAsArray().find(item => { return item.type === \"imageBlock\" || item.type === \"atomic\" })\r\n    const blockNum = contentState.getBlocksAsArray().length\r\n\r\n\r\n    if (Boolean(imageBlog) && (blockNum === 1)) {\r\n      let externalES_ = EditorState.createEmpty()\r\n      contentState = externalES_.getCurrentContent()\r\n      externalES = EditorState.push(externalES_, contentState, 'insert-fragment');\r\n      setTimeout(() => {\r\n        externalSetEditorState(externalES_)\r\n      }, 0);\r\n      return null\r\n    }\r\n\r\n    else if (imageBlog) {\r\n\r\n      const imageBlogKey = imageBlog.getKey()\r\n      const blocksBefore = blockMap.toSeq().takeUntil(function (v) { return v.getKey() === imageBlogKey })\r\n      const blocksAfter = blockMap.toSeq().skipUntil(function (v) { return v.getKey() === imageBlogKey }).rest()\r\n\r\n      // console.log(imageBlogKey, blocksBefore.count(), blocksAfter.count())\r\n\r\n\r\n      //  console.log(blocksBefore.toOrderedMap().toArray().pop().getText())\r\n\r\n      const newBlockMap = Boolean(blocksBefore)\r\n        ? Boolean(blocksAfter) ? blocksBefore.concat(blocksAfter).toOrderedMap() : blocksBefore.toOrderedMap()\r\n        : Boolean(blocksAfter) ? blocksAfter.toOrderedMap() : null\r\n\r\n      const key = (blocksBefore && blocksBefore.toOrderedMap().toArray().pop().getKey())\r\n        || (blocksAfter && blocksAfter.toOrderedMap().toArray().pop().getKey())\r\n\r\n      const key1 = (blocksBefore && blocksBefore.toOrderedMap().toArray().pop().getKey())\r\n      const key2 = (blocksAfter && blocksAfter.toOrderedMap().toArray().pop().getKey())\r\n      console.log(key1, key2)\r\n\r\n\r\n\r\n      //  const key =\"1111\"\r\n      contentState = contentState.merge({\r\n        blockMap: newBlockMap,\r\n\r\n        // selectionBefore: SelectionState.createEmpty().merge({\r\n        //   anchorKey: key,\r\n        //   focusKey: key,\r\n        //   anchorOffset: 0,\r\n        //   focusOffset: 0,\r\n        //   isBackward: false,\r\n        //   hasFocus: false,\r\n        // }),\r\n        // selectionBefore: SelectionState.createEmpty().merge({\r\n        //   anchorKey: key,\r\n        //   focusKey: key,\r\n        //   anchorOffset: 0,\r\n        //   focusOffset: 0,\r\n        //   isBackward: false,\r\n        //   hasFocus: false,\r\n        // }),\r\n\r\n\r\n\r\n      })\r\n      externalES = EditorState.push(externalES, contentState, 'insert-fragment');\r\n      //   setTimeout(() => {\r\n      externalSetEditorState(externalES)\r\n      //   }, 0)\r\n\r\n      return externalES\r\n    }\r\n\r\n\r\n  }\r\n\r\n  function removeImageBlog() {\r\n\r\n    let contentState = externalES.getCurrentContent();\r\n    const selectionBefore = contentState.getSelectionBefore()\r\n    const selectionAfter = contentState.getSelectionAfter()\r\n\r\n\r\n    let imageBlog = contentState.getBlocksAsArray().find(item => { return item.type === \"imageBlock\" || item.type === \"atomic\" })\r\n\r\n\r\n    let newContentBlockArr = contentState.getBlocksAsArray().filter(function (item) {\r\n\r\n\r\n      return !((item.type === \"imageBlock\" || item.type === \"atomic\"))\r\n\r\n    })\r\n\r\n\r\n    const imageBLogKey = imageBlog && imageBlog.getKey()\r\n\r\n    if (!imageBLogKey) { return }\r\n    if ((imageBLogKey) && (contentState.getBlocksAsArray().length <= 1)) {\r\n      externalES = EditorState.createEmpty()\r\n      setTimeout(() => {\r\n        externalSetEditorState(externalES)\r\n      }, 0);\r\n      return null\r\n    }\r\n\r\n    imageBlog = contentState.getBlockForKey(imageBLogKey);\r\n    contentState = ContentState.createFromBlockArray(newContentBlockArr)\r\n    contentState = contentState.merge({\r\n      selectionAfter, //newBlockMap,\r\n      selectionBefore,\r\n    })\r\n\r\n\r\n    externalES = EditorState.createWithContent(contentState)\r\n\r\n    //externalES = EditorState.push(externalES, contentState, 'insert-fragment');\r\n    externalSetEditorState(externalES)\r\n\r\n  }\r\n\r\n\r\n  function hasImageBlock() {\r\n    const selection = externalES.getSelection();\r\n\r\n    let contentState = externalES.getCurrentContent();\r\n    const currentBlock = contentState.getBlockForKey(selection.getEndKey());\r\n    const blockMap = contentState.getBlockMap()\r\n    return blockMap.toArray().findIndex((item) => {\r\n\r\n      const result = (item.type === \"atomic\" && item.text === \"imageBlockText\") || item.type === \"imageBlock\"\r\n      return result\r\n    }) >= 0\r\n\r\n\r\n  }\r\n\r\n  function topImage(editor) {\r\n\r\n\r\n    const selection = externalES.getSelection();\r\n\r\n\r\n    let contentState = externalES.getCurrentContent();\r\n    const selectionBefore = contentState.getSelectionBefore()\r\n    const selectionAfter = contentState.getSelectionAfter()\r\n\r\n\r\n    let imageBlog = contentState.getBlocksAsArray().find(item => { return item.type === \"imageBlock\" || item.type === \"atomic\" })\r\n\r\n\r\n    let newContentBlockArr = contentState.getBlocksAsArray().sort(function (itemA, itemB) {\r\n      if (itemA.type === \"imageBlock\" || itemA.type === \"atomic\") {\r\n        return -1\r\n      }\r\n      else {\r\n        return 0\r\n      }\r\n    })\r\n\r\n\r\n    const imageBLogKey = imageBlog && imageBlog.getKey()\r\n\r\n    if (!imageBLogKey) { return }\r\n\r\n    imageBlog = contentState.getBlockForKey(imageBLogKey);\r\n\r\n    console.log(contentState.getBlocksAsArray().length)\r\n\r\n    contentState = ContentState.createFromBlockArray(newContentBlockArr)\r\n    contentState = contentState.merge({\r\n      selectionAfter, //newBlockMap,\r\n      selectionBefore,\r\n    })\r\n\r\n\r\n    // externalES = EditorState.createWithContent(contentState)\r\n\r\n    externalES = EditorState.push(externalES, contentState, 'insert-fragment');\r\n    externalSetEditorState(externalES)\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  }\r\n\r\n\r\n  function ImageBlog({ block, editor, contentState, picArr, setPicArr, ...props }) {\r\n    //   const text = block.getText()\r\n    //   let { imgArr, imgUrl } = block.getData().toObject()\r\n    //  const type = block.getType()\r\n    const theme = useTheme()\r\n\r\n    const picNum = picArr.length\r\n    const imgArr = picArr\r\n\r\n\r\n    if (picNum === 0) {\r\n\r\n      //  setTimeout(() => {\r\n      //    removeImageBlog()\r\n      //  }, 0);\r\n\r\n      return (\r\n        <div style={{\r\n          // display:\"none\",\r\n          position: \"relative\",\r\n          width: \"100%\",\r\n          height: 0,\r\n          paddingBottom: \"56.25%\",\r\n\r\n          // backgroundRepeat: \"no-repeat\",\r\n          // backgroundPositionX: \"center\",\r\n          // backgroundPositionY: \"center\",\r\n          // backgroundSize: \"cover\",\r\n          // backgroundImage: \"url(\" + imgArr[0] + \")\",\r\n\r\n          backgroundColor: theme.palette.divider,   //\"skyblue\",\r\n          overflow: \"hidden\",\r\n\r\n        }}\r\n\r\n        >\r\n          <button\r\n            onClick={function () {\r\n              //  alert(\"xx\")\r\n              //removeImageBlog()\r\n              //setPicArr([])\r\n\r\n            }}\r\n          >delete</button>\r\n          {/* <AddPhotoAlternateOutlined style={{ transform: \"translateX(59%)\" }} /> */}\r\n          {/* <ImageButton color=\"primary\" fontSize=\"small\" picArr={picArr} setPicArr={setPicArr} editor={editor} /> */}\r\n        </div>\r\n\r\n\r\n      )\r\n    }\r\n    else if (picNum === 1) {\r\n      return <div style={{\r\n\r\n        position: \"relative\",\r\n        width: \"100%\",\r\n        height: 0,\r\n        paddingBottom: \"56.25%\",\r\n\r\n        backgroundRepeat: \"no-repeat\",\r\n        backgroundPositionX: \"center\",\r\n        backgroundPositionY: \"center\",\r\n        backgroundSize: \"cover\",\r\n        backgroundImage: \"url(\" + imgArr[0].localUrl + \")\",\r\n\r\n        backgroundColor: theme.palette.divider,   //\"skyblue\",\r\n        overflow: \"hidden\"\r\n      }}\r\n\r\n        onClick={function () {\r\n\r\n          setPicArr(pre => {\r\n            setTimeout(() => { removeImageBlog() }, 0);\r\n            return []\r\n          })\r\n\r\n        }}\r\n\r\n      />\r\n\r\n    }\r\n    else if (picNum === 2) {\r\n      return (\r\n        <div style={{\r\n          position: \"relative\",\r\n          width: \"100%\",\r\n          height: 0,\r\n          paddingBottom: \"56.25%\",\r\n          backgroundPositionX: \"center\",\r\n          backgroundPositionY: \"center\",\r\n          backgroundColor: theme.palette.divider,   //\"skyblue\",\r\n          overflow: \"hidden\",\r\n\r\n\r\n        }}>\r\n\r\n\r\n          <div style={{\r\n            position: \"absolute\",\r\n            width: \"50%\",\r\n            height: \"100%\",\r\n            //  paddingBottom: \"25%\",//  \"112.5%\", \r\n            backgroundColor: \"pink\",\r\n            left: \"0%\",\r\n            top: \"0%\",\r\n            backgroundRepeat: \"no-repeat\",\r\n            overflow: \"hidden\",\r\n            backgroundPositionX: \"center\",\r\n            backgroundPositionY: \"center\",\r\n            backgroundSize: \"cover\",\r\n            backgroundImage: \"url(\" + imgArr[0].localUrl + \")\",\r\n            transform: \"translateX(-1px) translateY(0px)\",\r\n            backgroundColor: \"wheat\",\r\n          }}\r\n            onClick={function () {\r\n              setPicArr(pre => [pre[1]])\r\n            }}\r\n\r\n          />\r\n          <div style={{\r\n            position: \"absolute\",\r\n            width: \"50%\",\r\n            height: \"100%\",\r\n            //  paddingBottom: \"25%\",//  \"112.5%\", \r\n            backgroundColor: \"wheat\",\r\n            left: \"50%\",\r\n            top: \"0%\",\r\n            backgroundRepeat: \"no-repeat\",\r\n            overflow: \"hidden\",\r\n            backgroundPositionX: \"center\",\r\n            backgroundPositionY: \"center\",\r\n            backgroundSize: \"cover\",\r\n            backgroundImage: \"url(\" + imgArr[1].localUrl + \")\",\r\n            transform: \"translateX(1px) translateY(0px)\",\r\n            backgroundColor: \"wheat\",\r\n          }}\r\n            onClick={function () {\r\n              setPicArr(pre => [pre[0]])\r\n            }}\r\n          />\r\n\r\n        </div>\r\n      )\r\n    }\r\n\r\n\r\n    else if (picNum === 3) {\r\n      return (\r\n        <div style={{\r\n          position: \"relative\",\r\n          width: \"100%\",\r\n          height: 0,\r\n          paddingBottom: \"56.25%\",\r\n          backgroundPositionX: \"center\",\r\n          backgroundPositionY: \"center\",\r\n          backgroundColor: theme.palette.divider,   //\"skyblue\",\r\n          overflow: \"hidden\"\r\n        }}>\r\n\r\n\r\n          <div style={{\r\n            position: \"absolute\",\r\n            width: \"50%\",\r\n            height: \"100%\",\r\n            //  paddingBottom: \"25%\",//  \"112.5%\", \r\n            backgroundColor: \"pink\",\r\n            left: \"0%\",\r\n            top: \"0%\",\r\n            backgroundRepeat: \"no-repeat\",\r\n            overflow: \"hidden\",\r\n            backgroundPositionX: \"center\",\r\n            backgroundPositionY: \"center\",\r\n            backgroundSize: \"cover\",\r\n            backgroundImage: \"url(\" + imgArr[0].localUrl + \")\",\r\n            transform: \"translateX(-1px) translateY(0px)\",\r\n            backgroundColor: \"wheat\",\r\n          }}\r\n            onClick={function () {\r\n              setPicArr(pre => [pre[1], pre[2]])\r\n            }}\r\n\r\n          />\r\n          <div style={{\r\n            position: \"absolute\",\r\n            width: \"50%\",\r\n            height: \"50%\",\r\n            backgroundColor: \"wheat\",\r\n            left: \"50%\",\r\n            top: \"0%\",\r\n            backgroundRepeat: \"no-repeat\",\r\n            overflow: \"hidden\",\r\n            backgroundPositionX: \"center\",\r\n            backgroundPositionY: \"center\",\r\n            backgroundSize: \"cover\",\r\n            backgroundImage: \"url(\" + imgArr[1].localUrl + \")\",\r\n            transform: \"translateX(1px) translateY(-1px)\",\r\n\r\n\r\n          }} onClick={\r\n            function () {\r\n              setPicArr(pre => [pre[0], pre[2]])\r\n            }} />\r\n\r\n          <div style={{\r\n            position: \"absolute\",\r\n            width: \"50%\",\r\n            height: \"50%\",\r\n            backgroundColor: \"wheat\",\r\n            left: \"50%\",\r\n            top: \"50%\",\r\n            backgroundRepeat: \"no-repeat\",\r\n            overflow: \"hidden\",\r\n            backgroundPositionX: \"center\",\r\n            backgroundPositionY: \"center\",\r\n            backgroundSize: \"cover\",\r\n            backgroundImage: \"url(\" + imgArr[2].localUrl + \")\",\r\n            transform: \"translateX(1px) translateY(1px)\",\r\n\r\n          }} onClick={\r\n            function () {\r\n              setPicArr(pre => [pre[0], pre[1]])\r\n            }} />\r\n\r\n        </div>\r\n      )\r\n    }\r\n\r\n\r\n    else {\r\n      return (\r\n        <div style={{\r\n          position: \"relative\",\r\n          width: \"100%\",\r\n          height: 0,\r\n          paddingBottom: \"56.25%\",\r\n          backgroundPositionX: \"center\",\r\n          backgroundPositionY: \"center\",\r\n          backgroundColor: theme.palette.divider,   //\"skyblue\",\r\n          overflow: \"hidden\"\r\n        }}>\r\n\r\n\r\n          <div style={{\r\n            position: \"absolute\",\r\n            width: \"50%\",\r\n            height: \"50%\",\r\n            backgroundColor: \"wheat\",\r\n            top: \"0%\",\r\n            left: \"0%\",\r\n            backgroundRepeat: \"no-repeat\",\r\n            overflow: \"hidden\",\r\n            backgroundPositionX: \"center\",\r\n            backgroundPositionY: \"center\",\r\n            backgroundSize: \"cover\",\r\n            backgroundImage: \"url(\" + imgArr[0].localUrl + \")\",\r\n            transform: \"translateX(-1px) translateY(-1px)\",\r\n\r\n          }} onClick={function () {\r\n            setPicArr(pre => [pre[1], pre[2], pre[3]])\r\n          }} />\r\n\r\n          <div style={{\r\n            position: \"absolute\",\r\n            width: \"50%\",\r\n            height: \"50%\",\r\n            backgroundColor: \"wheat\",\r\n            top: \"0%\",\r\n            left: \"50%\",\r\n            backgroundRepeat: \"no-repeat\",\r\n            overflow: \"hidden\",\r\n            backgroundPositionX: \"center\",\r\n            backgroundPositionY: \"center\",\r\n            backgroundSize: \"cover\",\r\n            backgroundImage: \"url(\" + imgArr[1].localUrl + \")\",\r\n            transform: \"translateX(1px) translateY(-1px)\",\r\n\r\n          }} onClick={function () {\r\n            setPicArr(pre => [pre[0], pre[2], pre[3]])\r\n          }} />\r\n\r\n          <div style={{\r\n            position: \"absolute\",\r\n            width: \"50%\",\r\n            height: \"50%\",\r\n            backgroundColor: \"wheat\",\r\n            top: \"50%\",\r\n            left: \"0%\",\r\n            backgroundRepeat: \"no-repeat\",\r\n            overflow: \"hidden\",\r\n            backgroundPositionX: \"center\",\r\n            backgroundPositionY: \"center\",\r\n            backgroundSize: \"cover\",\r\n            backgroundImage: \"url(\" + imgArr[2].localUrl + \")\",\r\n            transform: \"translateX(-1px) translateY(1px)\",\r\n          }}\r\n            onClick={\r\n              function () {\r\n                setPicArr(pre => [pre[0], pre[1], pre[3]])\r\n              }}\r\n          />\r\n\r\n          <div style={{\r\n            position: \"absolute\",\r\n            width: \"50%\",\r\n            height: \"50%\",\r\n            backgroundColor: \"wheat\",\r\n            top: \"50%\",\r\n            left: \"50%\",\r\n            backgroundRepeat: \"no-repeat\",\r\n            overflow: \"hidden\",\r\n            backgroundPositionX: \"center\",\r\n            backgroundPositionY: \"center\",\r\n            backgroundSize: \"cover\",\r\n            backgroundImage: \"url(\" + imgArr[3].localUrl + \")\",\r\n            transform: \"translateX(1px) translateY(1px)\",\r\n\r\n          }} onClick={\r\n            function () {\r\n              setPicArr(pre => [pre[1], pre[2], pre[3]])\r\n            }} />\r\n\r\n\r\n        </div>\r\n\r\n\r\n\r\n\r\n\r\n      )\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    return (\r\n      <div style={{\r\n        position: \"relative\",\r\n        width: \"100%\",\r\n        height: 0,\r\n        paddingBottom: \"56.25%\",\r\n\r\n        backgroundColor: theme.palette.divider,   //\"skyblue\",\r\n        overflow: \"hidden\"\r\n      }}>\r\n\r\n        <div style={{\r\n          position: \"absolute\",\r\n          width: \"50%\",\r\n          height: \"100%\",\r\n          // paddingBottom: \"112.5%\",\r\n          backgroundColor: \"pink\",\r\n\r\n          backgroundRepeat: \"no-repeat\",\r\n          backgroundPositionX: \"center\",\r\n          backgroundPositionY: \"center\",\r\n          backgroundSize: \"cover\",\r\n          backgroundImage: \"url(\" + imgArr[0] + \")\",\r\n          transform: \"translateX(-1px)\",\r\n        }} />\r\n\r\n\r\n\r\n\r\n        <div style={{\r\n          position: \"absolute\",\r\n          width: \"50%\",\r\n          height: \"50%\",\r\n          //  paddingBottom: \"25%\",//  \"112.5%\", \r\n          backgroundColor: \"wheat\",\r\n          left: \"50%\",\r\n          top: \"0%\",\r\n          backgroundRepeat: \"no-repeat\",\r\n          overflow: \"hidden\",\r\n          backgroundPositionX: \"center\",\r\n          backgroundPositionY: \"center\",\r\n          backgroundSize: \"cover\",\r\n          backgroundImage: \"url(\" + imgArr[1] + \")\",\r\n          transform: \"translateX(1px) translateY(-1px)\",\r\n          backgroundColor: \"wheat\",\r\n        }} />\r\n\r\n\r\n        <div style={{\r\n          position: \"absolute\",\r\n          width: \"50%\",\r\n          height: \"50%\",\r\n          //  paddingBottom: \"25%\",//  \"112.5%\", \r\n          backgroundColor: \"wheat\",\r\n          left: \"50%\",\r\n          top: \"50%\",\r\n          backgroundRepeat: \"no-repeat\",\r\n          overflow: \"hidden\",\r\n          backgroundPositionX: \"center\",\r\n          backgroundPositionY: \"center\",\r\n          backgroundSize: \"cover\",\r\n          backgroundImage: \"url(\" + imgArr[2] + \")\",\r\n          transform: \"translateX(1px) translateY(1px)\",\r\n          backgroundColor: \"wheat\",\r\n        }} />\r\n\r\n\r\n      </div>\r\n    )\r\n\r\n\r\n\r\n\r\n\r\n    return (\r\n      <>\r\n\r\n        <Grid container\r\n          direction=\"row\"\r\n          justify=\"space-around\"\r\n          alignItems=\"flex-start\"\r\n          spacing={0}\r\n\r\n          style={{\r\n            backgroundColor: \"skyblue\",\r\n            overflow: \"hidden\",\r\n            //  minHeight: \"20vh\",\r\n            //  maxHeight: \"40vh\",\r\n            // height:\"30vh\",\r\n          }}\r\n        >\r\n\r\n          {imgArr.map((item, index) => {\r\n\r\n            let col = 12\r\n            const picNum = imgArr.length\r\n            const picIndex = index + 1\r\n\r\n            //  if (picNum===1) \r\n\r\n            return <Grid item xs={12} sm={12} md={4} lg={4} xl={4} key={index}\r\n              style={{\r\n                overflow: \"hidden\",\r\n                margin: 0, padding: 0, backgroundColor: index % 2 === 1 ? \"pink\" : \"wheat\",\r\n\r\n              }}\r\n            >\r\n              {isChrome\r\n                ? <img src={item} style={{ width: \"100%\", display: \"block\", aspectRatio: \"16 / 9\", objectFit: \"cover\" }} />\r\n                : <div src={item}\r\n                  style={{\r\n\r\n                    position: \"relative\",\r\n                    width: \"100%\",\r\n                    paddingBottom: \"56.25%\",\r\n                    height: 0,\r\n                    //   height:\"100%\",\r\n                    // overflow: \"visible\",\r\n                    // aspectRatio: \"16 / 9\",\r\n                    display: \"block\",\r\n\r\n                    // objectFit: \"cover\",\r\n                    //  objectFit:\"contain\",\r\n                    backgroundColor: index % 2 === 1 ? \"pink\" : \"wheat\",\r\n                  }}\r\n                >\r\n                  <img src={item} style={{ position: \"absolute\", display: \"block\", top: 0, left: 0, width: \"100%\", objectFit: \"cover\" }} />\r\n\r\n\r\n\r\n\r\n                </div>}\r\n            </Grid>\r\n\r\n          })}\r\n\r\n        </Grid>\r\n\r\n\r\n\r\n\r\n\r\n\r\n        {/* {imgUrl && <img src={imgUrl}\r\n          style={{\r\n            maxWidth: \"100%\",\r\n            display: \"block\",\r\n            marginLeft: \"auto\",\r\n            marginRight: \"auto\"\r\n          }}\r\n        />} */}\r\n\r\n\r\n      </>\r\n    )\r\n\r\n    return (\r\n      <Grid container\r\n        direction=\"row\"\r\n        justify=\"space-around\"\r\n        alignItems=\"flex-start\"\r\n        spacing={0}>\r\n        <Grid item xs={12} sm={12} md={10} lg={8} xl={8} >\r\n\r\n        </Grid>\r\n      </Grid>\r\n    )\r\n  }\r\n\r\n\r\n  function ImageButton({ children, picArr, setPicArr, editor, ...props }) {\r\n\r\n\r\n    const inputRef = useRef()\r\n    const theme = useTheme()\r\n\r\n\r\n    return (\r\n      <>\r\n\r\n        <Button\r\n          {...props}\r\n\r\n          style={{\r\n            color: theme.palette.type === \"dark\"\r\n\r\n              ? picArr.length >= 4 && hasImageBlock() ? theme.palette.action.disabled : theme.palette.text.secondary\r\n              : picArr.length >= 4 && hasImageBlock() ? theme.palette.action.disabled : theme.palette.primary.main\r\n\r\n          }}\r\n          disabled={picArr.length >= 4 && hasImageBlock()}\r\n          onClick={function (e) {\r\n            //insertImageBlock(\"https://picsum.photos/332\")\r\n\r\n            //   if ((picArr.length===0) && hasImageBlock()) {\r\n            //  //   alert(\"aaa\")\r\n            //     removeImageBlog()\r\n            //   }\r\n\r\n            // if (picArr.length > 0 && !hasImageBlock()) {\r\n            //   insertImageBlock(\"\")\r\n            // }\r\n            // else {\r\n            inputRef.current.click()\r\n            //}\r\n\r\n\r\n\r\n          }}\r\n        >\r\n          <AddPhotoAlternateOutlined />\r\n          {/* {children} */}\r\n        </Button>\r\n\r\n        <input ref={inputRef} type=\"file\" style={{ display: \"none\" }}\r\n          onClick={function (e) { e.currentTarget.value = null; }}\r\n          onChange={function (e) {\r\n            if (e.currentTarget.files[0].name.trim().match(/\\.(gif|jpe?g|tiff|png|webp|bmp)$/i)) {\r\n\r\n\r\n              //  if (picArr.length >= 4) { return };\r\n              const file = e.currentTarget.files[0]\r\n              file.localUrl = URL.createObjectURL(e.currentTarget.files[0])\r\n              //     const obj = URL.createObjectURL(e.currentTarget.files[0])\r\n              console.log(e.currentTarget.files[0])\r\n              setPicArr(pre => {\r\n\r\n                // pre.push(obj);\r\n                return [...pre, file]\r\n              })\r\n\r\n\r\n\r\n\r\n              if (!hasImageBlock()) { insertImageBlock(URL.createObjectURL(e.currentTarget.files[0])) }\r\n              else {\r\n\r\n                editor.current.focus()\r\n\r\n\r\n\r\n\r\n              }\r\n            }\r\n          }}\r\n\r\n\r\n\r\n        />\r\n      </>\r\n    )\r\n\r\n\r\n  }\r\n\r\n  function TopImageButton({ editor, ...props }) {\r\n\r\n    const theme = useTheme()\r\n    return (\r\n\r\n      <Button {...props}\r\n\r\n        style={{\r\n\r\n          color: theme.palette.type === \"light\"\r\n            ? theme.palette.primary.main\r\n            : theme.palette.text.secondary\r\n        }}\r\n        onClick={function () {\r\n          //      deleteBlock(editor)\r\n          topImage(editor)\r\n        }}\r\n\r\n      >\r\n        <Image />\r\n      </Button>\r\n\r\n    )\r\n  }\r\n\r\n\r\n\r\n  return {\r\n\r\n    ImageBlog,\r\n\r\n    ImageButton,\r\n    TopImageButton,\r\n    removeImageBlog,\r\n    hasImageBlock,\r\n\r\n    imagePlugin: {\r\n\r\n      onChange: function (editorState, { setEditorState }) {\r\n\r\n        externalES = editorState\r\n        externalSetEditorState = setEditorState\r\n\r\n        return externalES\r\n      },\r\n    },\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n\r\nfunction genKey(length = 4) {\r\n\r\n  var result = '';\r\n  var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n  var charactersLength = characters.length;\r\n  for (var i = 0; i < length; i++) {\r\n    result += characters.charAt(Math.floor(Math.random() * charactersLength));\r\n  }\r\n  return result;\r\n}","import React, { useState, useRef, useEffect } from 'react';\r\n\r\nimport Immutable from 'immutable'\r\nimport axios from \"axios\"\r\n\r\n\r\nimport { Typography, Button, ButtonGroup, Container, IconButton } from \"@material-ui/core\";\r\nimport { CropOriginal, Image, Brightness4, Brightness5, FormatBold, FormatItalic, FormatUnderlined, FormatSize, TextFieldsOutlined,FormatAlignCenter } from \"@material-ui/icons\";\r\nimport { makeStyles, styled, useTheme } from '@material-ui/core/styles';\r\n\r\n\r\nimport {\r\n  EditorState, ContentBlock,\r\n  CharacterMetadata, SelectionState, convertToRaw,\r\n  convertFromRaw, RichUtils, Modifier, convertFromHTML,\r\n  AtomicBlockUtils,\r\n\r\n}\r\n  from 'draft-js';\r\nimport { set } from 'immutable';\r\n\r\nexport default function createBoldPlugin() {\r\n  let externalES = null;\r\n  let externalSetEditorState = null;\r\n\r\n  function makeBold(styleType, setOn) {\r\n\r\n    const isCollapsed = externalES.getSelection().isCollapsed()\r\n\r\n    if (!isCollapsed) {\r\n\r\n      externalES = RichUtils.toggleInlineStyle(externalES, styleType)\r\n      let selection = externalES.getSelection()\r\n      const [anchorKey, anchorOffset, focusKey, focusOffset, isBackward, hasfocus] = selection.toArray()\r\n\r\n\r\n\r\n\r\n\r\n      // selection = selection.merge({\r\n\r\n      //   anchorKey: anchorKey,\r\n      //   anchorOffset: focusOffset,// + text.length,\r\n      //   focusKey: focusKey,\r\n      //   focusOffset: focusOffset,// + text.length,\r\n      //   isBackward: false,\r\n      //   hasFocus: true,\r\n      // })\r\n\r\n      // externalES = EditorState.push(externalES, externalES.getCurrentContent(), \"change-inline-style\");\r\n      // externalES = EditorState.acceptSelection(externalES, selection)\r\n\r\n\r\n\r\n      externalSetEditorState(externalES)\r\n\r\n    }\r\n\r\n    else {\r\n\r\n      const selection = externalES.getSelection()\r\n      const [anchorKey, anchorOffset, focusKey, focusOffset, isBackward, hasfocus] = selection.toArray()\r\n      const styleObj = externalES.getCurrentInlineStyle().toObject()\r\n\r\n\r\n      const text = \" \"\r\n      let newContent = Modifier.replaceText(\r\n        externalES.getCurrentContent(),\r\n        selection,\r\n        text,\r\n      )\r\n\r\n      let newSelection = selection.merge({\r\n\r\n        anchorKey: anchorKey,\r\n        anchorOffset: anchorOffset,// + text.length,\r\n        focusKey: focusKey,\r\n        focusOffset: focusOffset + text.length,\r\n        isBackward: false,\r\n        hasFocus: true,\r\n      })\r\n\r\n      Object.keys(styleObj).forEach(item => {\r\n        if (item === styleType) { return }\r\n        newContent = Modifier.applyInlineStyle(newContent, newSelection, styleObj[item])\r\n      })\r\n\r\n      newContent = Modifier.applyInlineStyle(newContent, newSelection, styleObj[styleType] ? [] : styleType)\r\n      externalES = EditorState.push(externalES, newContent, \"insert-characters\");\r\n      externalES = EditorState.acceptSelection(externalES, newSelection)\r\n\r\n      externalSetEditorState(externalES)\r\n\r\n      //   console.log(endKey, endOffset)\r\n      // console.log(Date.now(), \"===\")\r\n      // externalES = RichUtils.toggleInlineStyle(externalES, styleType)\r\n      // externalSetEditorState(externalES)\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function makeLarge(styleType = \"LARGE\") {\r\n\r\n    const isCollapsed = externalES.getSelection().isCollapsed()\r\n\r\n    if (!isCollapsed) {\r\n      let selection = externalES.getSelection()\r\n      const [anchorKey, anchorOffset, focusKey, focusOffset, isBackward, hasfocus] = selection.toArray()\r\n      const styleObj = externalES.getCurrentInlineStyle().toObject()\r\n      let newContent = externalES.getCurrentContent()\r\n\r\n      console.log(styleObj)\r\n      if (styleType === \"LARGE\") {\r\n        newContent = Modifier.removeInlineStyle(newContent, selection, \"SMALL\")\r\n        newContent = Modifier.removeInlineStyle(newContent, selection, \"LARGE\")\r\n        if (!styleObj.LARGE) {\r\n          newContent = Modifier.applyInlineStyle(newContent, selection, \"LARGE\")\r\n        }\r\n      }\r\n      else if (styleType === \"SMALL\") {\r\n        newContent = Modifier.removeInlineStyle(newContent, selection, \"SMALL\")\r\n        newContent = Modifier.removeInlineStyle(newContent, selection, \"LARGE\")\r\n        if (!styleObj.SMALL) {\r\n          newContent = Modifier.applyInlineStyle(newContent, selection, \"SMALL\")\r\n        }\r\n      }\r\n\r\n      //   if (Math.abs(focusOffset - anchorOffset) !== 1) {\r\n      // selection = selection.merge({\r\n\r\n      //   anchorKey: anchorKey,\r\n      //   anchorOffset: focusOffset,// + text.length,\r\n      //   focusKey: focusKey,\r\n      //   focusOffset: focusOffset,// + text.length,\r\n      //   isBackward: false,\r\n      //   hasFocus: true,\r\n      // })\r\n\r\n\r\n      // }\r\n\r\n      externalES = EditorState.push(externalES, newContent, \"change-inline-style\");\r\n      externalES = EditorState.acceptSelection(externalES, selection)\r\n      externalSetEditorState(externalES)\r\n\r\n\r\n\r\n    }\r\n\r\n    else if (isCollapsed) {\r\n      const selection = externalES.getSelection()\r\n      const [anchorKey, anchorOffset, focusKey, focusOffset, isBackward, hasfocus] = selection.toArray()\r\n      const styleObj = externalES.getCurrentInlineStyle().toObject()\r\n\r\n      const text = \" \"\r\n      let newContent = Modifier.insertText(\r\n        externalES.getCurrentContent(),\r\n        selection,\r\n        text,\r\n      )\r\n\r\n      let newSelection = selection.merge({\r\n\r\n        anchorKey: anchorKey,\r\n        anchorOffset: anchorOffset,// + text.length,\r\n        focusKey: focusKey,\r\n        focusOffset: focusOffset + text.length,\r\n        isBackward: false,\r\n        hasFocus: true,\r\n      })\r\n\r\n      Object.keys(styleObj).forEach(item => {\r\n        if (item === styleType || item === \"LARGE\" || item === \"SMALL\") {\r\n          return\r\n        }\r\n        newContent = Modifier.applyInlineStyle(newContent, newSelection, styleObj[item])\r\n      })\r\n\r\n      newContent = Modifier.applyInlineStyle(newContent, newSelection, styleObj[styleType] ? [] : styleType)\r\n      externalES = EditorState.push(externalES, newContent, \"insert-characters\");\r\n      externalES = EditorState.acceptSelection(externalES, newSelection)\r\n\r\n      externalSetEditorState(externalES)\r\n    }\r\n\r\n\r\n  }\r\n  function makeSmall() {\r\n    externalES.getSelection().isCollapsed()\r\n\r\n  }\r\n\r\n  function LargeButton({ editor, isLargeOn, setIsLargeOn, ...props }) {\r\n    const theme = useTheme()\r\n    return (\r\n      <Button {...props}\r\n        style={{\r\n          backgroundColor: isLargeOn ? theme.palette.primary.main : \"\",// theme.palette.background.default,\r\n          color: theme.palette.type === \"light\"\r\n            ? isLargeOn\r\n              ? theme.palette.primary.contrastText\r\n              : theme.palette.primary.main\r\n            : isLargeOn\r\n              ? theme.palette.primary.contrastText\r\n              : theme.palette.text.secondary\r\n        }}\r\n        onClick={function (e) {\r\n\r\n          editor.current.focus()\r\n          makeLarge(\"LARGE\", setIsLargeOn)\r\n        }}\r\n      >\r\n        <TextFieldsOutlined />\r\n      </Button>\r\n    )\r\n  }\r\n\r\n  function SmallButton({ editor, isSmallOn, setIsSmallOn, ...props }) {\r\n    const theme = useTheme()\r\n    return (\r\n      <Button {...props}\r\n        style={{\r\n          backgroundColor: isSmallOn ? theme.palette.primary.main : \"\",// theme.palette.background.default,\r\n          color: theme.palette.type === \"light\"\r\n            ? isSmallOn\r\n              ? theme.palette.primary.contrastText\r\n              : theme.palette.primary.main\r\n            : isSmallOn\r\n              ? theme.palette.primary.contrastText\r\n              : theme.palette.text.secondary\r\n        }}\r\n        onClick={function (e) {\r\n\r\n          editor.current.focus()\r\n          makeLarge(\"SMALL\", setIsSmallOn)\r\n        }}\r\n      >\r\n        <FormatSize />\r\n      </Button>\r\n    )\r\n  }\r\n\r\n  function CenterButton({ editor, isCenterOn, setIsCenterOn, ...props }) {\r\n\r\n    const theme = useTheme()\r\n    return <Button {...props}\r\n      style={{\r\n        backgroundColor: isCenterOn ? theme.palette.primary.main : \"\",// theme.palette.background.default,\r\n        color: theme.palette.type === \"light\"\r\n          ? isCenterOn\r\n            ? theme.palette.primary.contrastText\r\n            : theme.palette.primary.main\r\n          : isCenterOn\r\n            ? theme.palette.primary.contrastText\r\n            : theme.palette.text.secondary\r\n      }}\r\n      onClick={function (e) {\r\n\r\n        editor.current.focus()\r\n           makeBold(\"CENTER\", setIsCenterOn)\r\n      }}\r\n    >\r\n      <FormatAlignCenter />\r\n    </Button>\r\n\r\n\r\n  }\r\n\r\n  return {\r\n\r\n\r\n    boldPlugin: {\r\n\r\n      onChange: function (editorState, { setEditorState }) {\r\n        externalES = editorState\r\n        externalSetEditorState = setEditorState\r\n        return externalES\r\n\r\n      },\r\n\r\n    },\r\n\r\n\r\n    BoldButton: function (props) { return <BoldButton makeBold={makeBold}  {...props} /> },\r\n    ItalicButton: function (props) { return <ItalicButton makeBold={makeBold}  {...props} /> },\r\n    UnderlineButton: function (props) { return <UnderlineButton makeBold={makeBold}  {...props} /> },\r\n    LargeButton,\r\n    SmallButton,\r\n   // CenterButton,\r\n  }\r\n}\r\n\r\nfunction BoldButton({ children, makeBold,\r\n  isBoldOn, setIsBoldOn,\r\n\r\n  styleType, editor, ...props }) {\r\n\r\n  const theme = useTheme()\r\n\r\n\r\n  return (\r\n\r\n    <Button   {...props}\r\n\r\n      style={{\r\n\r\n        backgroundColor: isBoldOn ? theme.palette.primary.main : \"\",// theme.palette.background.default,\r\n\r\n\r\n        color: theme.palette.type === \"light\"\r\n          ? isBoldOn\r\n            ? theme.palette.primary.contrastText\r\n            : theme.palette.primary.main\r\n          : isBoldOn\r\n            ? theme.palette.primary.contrastText\r\n            : theme.palette.text.secondary\r\n\r\n      }}\r\n\r\n\r\n      onClick={function (e) {\r\n        //  setIsBoldOn(pre => !pre)\r\n\r\n        editor.current.focus()\r\n        // setIsBoldOn(pre => {\r\n\r\n        //   return !pre\r\n        // })\r\n        //  \r\n\r\n        makeBold(\"BOLD\", setIsBoldOn)\r\n\r\n      }}\r\n    >\r\n      <FormatBold />\r\n      {/* {children} */}\r\n    </Button>\r\n  )\r\n}\r\n\r\nfunction ItalicButton({ children, makeBold,\r\n\r\n  isItalicOn, setIsItalicOn,\r\n\r\n  styleType, editor, ...props }) {\r\n  const theme = useTheme()\r\n  return (\r\n    <Button   {...props}\r\n\r\n      style={{\r\n\r\n        backgroundColor: isItalicOn ? theme.palette.primary.main : \"\",//theme.palette.background.default,\r\n\r\n\r\n        color: theme.palette.type === \"light\"\r\n          ? isItalicOn\r\n            ? theme.palette.primary.contrastText\r\n            : theme.palette.primary.main\r\n          : isItalicOn\r\n            ? theme.palette.primary.contrastText\r\n            : theme.palette.text.secondary\r\n\r\n      }}\r\n\r\n\r\n      onClick={function (e) {\r\n        editor.current.focus()\r\n        //  setIsItalicOn(pre => !pre)\r\n\r\n        makeBold(\"ITALIC\", setIsItalicOn)\r\n\r\n      }}\r\n    >\r\n      <FormatItalic />\r\n      {/* {children} */}\r\n    </Button>\r\n\r\n  )\r\n}\r\n\r\nfunction UnderlineButton({ children, makeBold,\r\n\r\n  isUnderlineOn, setIsUnderlineOn,\r\n\r\n  styleType, editor, ...props }) {\r\n  const theme = useTheme()\r\n  return (\r\n    <Button   {...props}\r\n\r\n\r\n      style={{\r\n\r\n        backgroundColor: isUnderlineOn ? theme.palette.primary.main : \"\",// theme.palette.background.default,\r\n\r\n\r\n        color: theme.palette.type === \"light\"\r\n          ? isUnderlineOn\r\n            ? theme.palette.primary.contrastText\r\n            : theme.palette.primary.main\r\n          : isUnderlineOn\r\n            ? theme.palette.primary.contrastText\r\n            : theme.palette.text.secondary\r\n\r\n      }}\r\n\r\n\r\n      onClick={function (e) {\r\n        //    setIsUnderlineOn(pre => !pre)\r\n        editor.current.focus()\r\n        makeBold(\"UNDERLINE\", setIsUnderlineOn)\r\n\r\n      }}\r\n    >\r\n      < FormatUnderlined />\r\n      {/* {children} */}\r\n    </Button>\r\n\r\n  )\r\n\r\n\r\n\r\n}","import React, { useState, useRef, useEffect } from 'react';\r\n\r\nimport { EditorState, KeyBindingUtil, convertToRaw, convertFromRaw, RichUtils, Modifier, convertFromHTML, SelectionState, CharacterMetadata } from 'draft-js';\r\nimport Immutable from 'immutable'\r\n\r\nimport axios from \"axios\"\r\n\r\nimport { makeStyles, styled, useTheme } from '@material-ui/core/styles';\r\nimport { Typography, Button, ButtonGroup, Container, Paper, Avatar } from \"@material-ui/core\";\r\nimport { InsertEmoticon } from \"@material-ui/icons\";\r\nimport { height } from '@material-ui/system';\r\n\r\nimport {\r\n  isMobile,\r\n  isFirefox,\r\n  isChrome,\r\n  browserName,\r\n  engineName,\r\n} from \"react-device-detect\";\r\n\r\n\r\n\r\nexport default function createImagePlugin() {\r\n  const url = \"http://szwb1.herokuapp.com/api\"\r\n  let externalES = null;\r\n  let externalSetEditorState = null;\r\n\r\n  let emojiArr = [\r\n    '\\u2620',\r\n    '\\u2764',\r\n    '\\uD83D\\uDC69\\u200D\\u2764\\uFE0F\\u200D\\uD83D\\uDC8B\\u200D\\uD83D\\uDC69',\r\n    '\\uD83D\\uDC7F',\r\n    '\\uD83D\\uDC80',\r\n    '\\uD83D\\uDCA9',\r\n    '\\uD83D\\uDE01',\r\n    '\\uD83D\\uDE02',\r\n    '\\uD83D\\uDE03',\r\n    '\\uD83D\\uDE04',\r\n    '\\uD83D\\uDE05',\r\n    '\\uD83D\\uDE06',\r\n    '\\uD83D\\uDE07',\r\n    '\\uD83D\\uDE08',\r\n    '\\uD83D\\uDE09',\r\n    '\\uD83D\\uDE0A',\r\n    '\\uD83D\\uDE0B',\r\n    '\\uD83D\\uDE0C',\r\n    '\\uD83D\\uDE0D',\r\n    '\\uD83D\\uDE0E',\r\n    '\\uD83D\\uDE0F',\r\n    '\\uD83D\\uDE10',\r\n    '\\uD83D\\uDE12',\r\n    '\\uD83D\\uDE13',\r\n    '\\uD83D\\uDE14',\r\n    '\\uD83D\\uDE16',\r\n    '\\uD83D\\uDE18',\r\n    '\\uD83D\\uDE1A',\r\n    '\\uD83D\\uDE1C',\r\n    '\\uD83D\\uDE1D',\r\n    '\\uD83D\\uDE1E',\r\n    '\\uD83D\\uDE20',\r\n    '\\uD83D\\uDE21',\r\n    '\\uD83D\\uDE22',\r\n    '\\uD83D\\uDE23',\r\n    '\\uD83D\\uDE24',\r\n    '\\uD83D\\uDE25',\r\n    '\\uD83D\\uDE28',\r\n    '\\uD83D\\uDE29',\r\n    '\\uD83D\\uDE2A',\r\n    '\\uD83D\\uDE2B',\r\n    '\\uD83D\\uDE2D',\r\n    '\\uD83D\\uDE30',\r\n    '\\uD83D\\uDE31',\r\n    '\\uD83D\\uDE32',\r\n    '\\uD83D\\uDE33',\r\n    '\\uD83D\\uDE35',\r\n    '\\uD83D\\uDE36',\r\n    '\\uD83D\\uDE37',\r\n    '\\uD83D\\uDE47\\u200D\\u2640\\uFE0F',\r\n    '\\uD83E\\uDD24',\r\n    '\\uD83E\\uDD71'\r\n  ]\r\n  const emojiUrl = `url(${url}/emoji/downloademoji/`\r\n  let emoji = {}\r\n\r\n  emojiArr.forEach(icon => {\r\n\r\n    emoji[icon] = emojiUrl + icon + \".png\"\r\n  })\r\n\r\n\r\n  function insertEmoji(text) {\r\n\r\n    const [anchorKey, anchorOffset, focusKey, focusOffset, isBackward, hasfocus] = externalES.getSelection().toArray()\r\n    const [anchorStartKey, anchorStartOffset, anchorFocusKey, anchorFocusOffset, isAnchorBackward, isAnchorFocused]\r\n      = [!isBackward ? anchorKey : focusKey, !isBackward ? anchorOffset : focusOffset, isBackward ? anchorKey : focusKey, isBackward ? anchorOffset : focusOffset,]\r\n\r\n\r\n    let newContent = Modifier.replaceText(\r\n      externalES.getCurrentContent(),\r\n      externalES.getSelection(),\r\n      text,\r\n    )\r\n\r\n    let newSelection = externalES.getSelection().merge({\r\n\r\n      anchorKey: anchorStartKey,\r\n      anchorOffset: anchorStartOffset + text.length,\r\n      focusKey: anchorStartKey,\r\n      focusOffset: anchorStartOffset + text.length,\r\n      isBackward: false,\r\n      hasFocus: true,\r\n    })\r\n\r\n    externalES = EditorState.push(externalES, newContent, \"insert-characters\");\r\n    externalES = EditorState.acceptSelection(externalES, newSelection)\r\n\r\n    externalSetEditorState(externalES)\r\n  }\r\n\r\n  function taggingEmoji() {\r\n\r\n    const [anchorKey, anchorOffset, focusKey, focusOffset, isBackward, hasfocus] = externalES.getSelection().toArray()\r\n    const [anchorStartKey, anchorStartOffset, anchorFocusKey, anchorFocusOffset, isAnchorBackward, isAnchorFocused]\r\n      = [!isBackward ? anchorKey : focusKey, !isBackward ? anchorOffset : focusOffset, isBackward ? anchorKey : focusKey, isBackward ? anchorOffset : focusOffset,]\r\n\r\n\r\n    const oldSelection = externalES.getSelection();\r\n    let newContent = externalES.getCurrentContent();\r\n    let newSelection = externalES.getSelection();\r\n\r\n    externalES.getCurrentContent().getBlocksAsArray().forEach(function (block) {\r\n\r\n      const [blockKey, , blockText, metaArr] = block.toArray()\r\n\r\n      metaArr.forEach(function (item, index) {\r\n        const itemEntityKey = item.getEntity()\r\n        if (itemEntityKey) {\r\n          const entityType = newContent.getEntity(itemEntityKey).getType()\r\n          if (entityType === \"EMOJI\") {\r\n\r\n            newSelection = newSelection.merge({\r\n              anchorKey: blockKey,\r\n              anchorOffset: index,\r\n              focusKey: blockKey,\r\n              focusOffset: index + 1,\r\n              isBackward: false,\r\n              hasFocus: false,\r\n            })\r\n            newContent = Modifier.applyEntity(newContent, newSelection, null)\r\n          }\r\n        }\r\n      })\r\n\r\n\r\n      Object.keys(emoji).forEach(function (emojiKey) {\r\n\r\n        const regx = new RegExp(`${emojiKey}`, \"g\")\r\n        // const array = [...blockText.matchAll(regx)].map(a => a.index);\r\n        const array = []\r\n        let matchArr;\r\n        while ((matchArr = regx.exec(blockText)) !== null) {\r\n\r\n          const start = matchArr.index;\r\n          const end = matchArr.index + matchArr[0].length;\r\n\r\n          array.push(start)\r\n        }\r\n\r\n\r\n        array.forEach(function (offset) {\r\n\r\n          newContent = newContent.createEntity(\"EMOJI\", \"IMMUTABLE\", { url: emoji[emojiKey], symbol: emojiKey });\r\n          const entityKey = newContent.getLastCreatedEntityKey();\r\n\r\n          newSelection = newSelection.merge({\r\n            anchorKey: blockKey,\r\n            anchorOffset: offset,\r\n            focusKey: blockKey,\r\n            focusOffset: offset + emojiKey.length,\r\n            isBackward: false,\r\n            hasFocus: false,\r\n\r\n          })\r\n          newContent = Modifier.applyEntity(newContent, newSelection, entityKey)\r\n\r\n        })\r\n\r\n      })\r\n\r\n    })\r\n    externalES = EditorState.push(externalES, newContent, \"insert-characters\");\r\n    externalES = EditorState.acceptSelection(externalES, oldSelection);\r\n    return externalES\r\n  }\r\n\r\n  function emojiStrategy(contentBlock, callback, contentState) {\r\n\r\n\r\n    contentBlock.findEntityRanges(\r\n      function (character) {\r\n        const entityKey = character.getEntity();\r\n        return (\r\n          entityKey !== null &&\r\n          contentState.getEntity(entityKey).getType() === \"EMOJI\"\r\n\r\n        );\r\n      },\r\n      callback\r\n    );\r\n  };\r\n\r\n  function Emoji(props) {\r\n    const { contentState, entityKey, blockKey, offsetKey, start, end, decoratedText } = props;\r\n\r\n    // const { fontSize2 } = useContext(ThemeContext)\r\n    // const isComputer = !useMediaQuery({ query: '(hover: none)' });\r\n\r\n    const iconRef = useRef()\r\n    const theme = useTheme()\r\n\r\n\r\n    // return (\r\n\r\n    //   <Avatar src={emoji[decoratedText].replace(\"url(\", \"\").replace(\")\", \"\")}\r\n\r\n\r\n    //     style={{ transform: \"scale(1.2)\", display: \"inline\", borderRadius: 0 }} />\r\n\r\n    // )\r\n    return (\r\n      <>\r\n\r\n\r\n\r\n        <span\r\n\r\n          ref={iconRef}\r\n          className=\"emoji\"\r\n          style={{\r\n\r\n\r\n            backgroundRepeat: \"no-repeat\",\r\n\r\n            backgroundPosition: \"center center\",\r\n            backgroundSize: \"contain\",\r\n            display: \"inline-block\",\r\n\r\n            textAlign: \"right\",\r\n            marginLeft: theme.typography.fontSize * 0.12,\r\n            marginRight: theme.typography.fontSize * 0.12,\r\n            //   verticalAlign: \"middle\",\r\n            transform: isMobile ? \"scale(1.2)\" : \"scale(1.2)\",\r\n            backgroundImage: emoji[decoratedText],\r\n\r\n\r\n          }}\r\n        >\r\n          <span style={{\r\n            clipPath: \"circle(0% at 50% 50%)\",\r\n\r\n            //  clipPath: isFirefox ? null : \"circle(0% at 50% 50%)\",\r\n          }}>\r\n            {props.children}\r\n\r\n          </span>\r\n        </span>\r\n\r\n      </>\r\n\r\n    );\r\n\r\n\r\n  };\r\n\r\n\r\n  return {\r\n\r\n\r\n\r\n    emojiPlugin: {\r\n\r\n      onChange: function (editorState, { setEditorState }) {\r\n\r\n\r\n        externalES = editorState\r\n        externalSetEditorState = setEditorState\r\n        externalES = taggingEmoji()\r\n\r\n        return externalES\r\n      },\r\n      decorators: [\r\n        {\r\n          strategy: emojiStrategy,\r\n          component: Emoji\r\n        }\r\n      ],\r\n    },\r\n\r\n\r\n    EmojiButton: function (props) { return <EmojiButton {...props} /> },\r\n    EmojiPanel: function (props) { return <EmojiPanel emoji={emoji} insertEmoji={insertEmoji} {...props} /> },\r\n\r\n\r\n  }\r\n}\r\n\r\nfunction EmojiButton({ children, isEmojiPanelOn, setIsEmojiPanelOn, ...props }) {\r\n\r\n  const theme = useTheme()\r\n\r\n  return (\r\n    <>\r\n      <Button\r\n        {...props}\r\n\r\n        style={{\r\n\r\n          backgroundColor: isEmojiPanelOn ? theme.palette.primary.main : \"\",// theme.palette.background.default,\r\n\r\n\r\n          color: theme.palette.type === \"light\"\r\n            ? isEmojiPanelOn\r\n              ? theme.palette.primary.contrastText\r\n              : theme.palette.primary.main\r\n            : isEmojiPanelOn\r\n              ? theme.palette.primary.contrastText\r\n              : theme.palette.text.secondary\r\n\r\n\r\n        }}\r\n\r\n\r\n        onClick={function (e) {\r\n          setIsEmojiPanelOn(pre => !pre)\r\n        }}\r\n      >\r\n        <InsertEmoticon />\r\n        {/* {children} */}\r\n      </Button>\r\n\r\n    </>\r\n  )\r\n\r\n}\r\n\r\nfunction EmojiPanel({ children, emoji, insertEmoji, isEmojiPanelOn, ...props }) {\r\n\r\n  const theme = useTheme()\r\n\r\n  return (\r\n\r\n    <Paper\r\n\r\n      // className={emojiPanelClass}\r\n      style={{\r\n        maxWidth: \"100%\",\r\n        overflow: \"auto\",\r\n        // marginBottom: \"10px\",\r\n        marginTop: isEmojiPanelOn ? \"10px\" : 0,\r\n        //  height: isEmojiPanelOn ? \"auto\" : 0,\r\n        maxHeight: isEmojiPanelOn ? \"30vh\" : 0,\r\n\r\n        transitionProperty: \"height,max-height, opacity\",\r\n        transitionDuration: \"0.2s\",\r\n        opacity: isEmojiPanelOn ? 1 : 0,\r\n        // marginBottom: isEmojiPanelOn ? theme.spacing(2) : 0\r\n        marginBottom: theme.spacing(2),\r\n      }}>\r\n\r\n\r\n\r\n      {Object.keys(emoji).map(function (icon, index) {\r\n\r\n\r\n        return <Button variant=\"text\" key={icon} onClick={\r\n          function (e) {\r\n            // alert(\"dsd\")\r\n            insertEmoji(icon)\r\n          }\r\n        }>\r\n\r\n          <Avatar src={emoji[icon].replace(\"url(\", \"\").replace(\")\", \"\")} style={{ transform: \"scale(1.2)\", borderRadius: 0 }} />\r\n        </Button>\r\n\r\n\r\n        return <Button variant=\"text\" key={icon}\r\n\r\n          size=\"small\"\r\n          style={{\r\n            color: \"rgba(0,0,0,0)\",\r\n            backgroundImage: emoji[icon],\r\n            backgroundRepeat: \"no-repeat\",\r\n\r\n            backgroundPosition: \"center center\",\r\n            backgroundSize: \"contain\",\r\n            transform: \"scale(0.85)\",\r\n\r\n          }}\r\n          onClick={\r\n            function (e) {\r\n              // alert(\"dsd\")\r\n              insertEmoji(icon)\r\n            }\r\n          }\r\n\r\n        >\r\n          {icon}\r\n        </Button>\r\n      })}\r\n\r\n\r\n\r\n\r\n\r\n    </Paper>\r\n  )\r\n}","import { useState, useRef, useEffect, useContext, useCallback, createContext, useMemo } from 'react';\r\nimport { Context } from \"./ContextProvider\"\r\n\r\n\r\nimport { EditorState, ContentState, ContentBlock, CharacterMetadata, SelectionState, convertToRaw, convertFromRaw, RichUtils, Modifier, convertFromHTML, AtomicBlockUtils } from 'draft-js';\r\nimport Editor from \"draft-js-plugins-editor\";\r\nimport Immutable from 'immutable';\r\n\r\nimport { makeStyles, styled, useTheme, withStyles } from '@material-ui/core/styles';\r\nimport { Typography, Button, ButtonGroup, Container, Paper, Avatar, Box, Chip, Grow } from \"@material-ui/core\";\r\nimport { Image, AlternateEmailSharp } from \"@material-ui/icons\";\r\n\r\nimport {\r\n  isMobile,\r\n  isFirefox,\r\n  isChrome,\r\n  browserName,\r\n  engineName,\r\n} from \"react-device-detect\";\r\n\r\nimport axios from \"axios\";\r\n\r\n\r\n\r\n\r\nexport const useStyles = makeStyles(props => {\r\n  const theme = useTheme()\r\n\r\n  return {\r\n\r\n    mentionHeadAvatar: props => {\r\n      return {\r\n        position: \"absolute\",\r\n        top: \"50%\",\r\n        left: \"50%\",\r\n        //  width: theme.typography.fontSize + \"px\",\r\n        //  height: theme.typography.fontSize + \"px\",\r\n        transform: \"translate(-50%, -50%) scale(1)\",\r\n      }\r\n    },\r\n\r\n\r\n    mentionHeadRoot: props => {\r\n      return {\r\n        borderRadius: 999,\r\n        borderTopRightRadius: 0,\r\n        borderBottomRightRadius: 0,\r\n\r\n        position: \"relative\",\r\n\r\n        //width: theme.typography.fontSize,\r\n        height: \"100%\",\r\n\r\n        backgroundColor: theme.palette.mentionBackColor,// \"pink\",\r\n        position: \"relative\",\r\n        // boxShadow: \"10px 1px 4px -2px rgba(100,100,100,0.75)\",\r\n      }\r\n    },\r\n\r\n\r\n    mentionBodyRoot: props => {\r\n      return {\r\n        borderRadius: 999,\r\n        borderTopLeftRadius: 0,\r\n        borderBottomLeftRadius: 0,\r\n\r\n        height: \"100%\",\r\n\r\n        backgroundColor: theme.palette.mentionBackColor,//\"blue\",\r\n        // boxShadow: \"0px 1px 4px -2px rgba(100,100,100,0.75)\",\r\n      }\r\n    },\r\n    mentionBodyRoot2: props => {\r\n      return {\r\n        borderRadius: 999,\r\n        height: \"100%\",\r\n        backgroundColor: theme.palette.mentionBackColor,//\"blue\",\r\n        boxShadow: theme.shadows[2] //\"0px 1px 2px 1px rgba(160,160,160,0.75)\",\r\n      }\r\n    },\r\n\r\n\r\n\r\n    mentionHeadLabel: props => {\r\n      return {\r\n\r\n        //    fontSize: theme.typography.fontSize,\r\n        paddingLeft: 0,\r\n        paddingRight: 0,\r\n        borderStyle: \"none\",\r\n        //  color: \"rgba(200,0,0,0)\",\r\n        //   ...(!isMobile) && { color: \"rgba(200,0,0,0)\" },\r\n        //   clipPath: \"circle(0% at 50% 50%)\",\r\n        // '&:hover': { padding:0},\r\n      }\r\n    },\r\n\r\n    mentionHeadLabel2: props => {\r\n      return {\r\n\r\n        //    fontSize: theme.typography.fontSize,\r\n        paddingLeft: 0,\r\n        paddingRight: 0,\r\n        borderStyle: \"none\",\r\n        color: \"rgba(200,0,0,0)\",\r\n        // '&:hover': { padding:0},\r\n      }\r\n    },\r\n\r\n\r\n    mentionBodyLabel: props => {\r\n      return {\r\n        //    fontSize: theme.typography.fontSize,\r\n        borderStyle: \"none\",\r\n        // '&:hover': { padding:0},\r\n      }\r\n    },\r\n\r\n\r\n\r\n\r\n  }\r\n});\r\n\r\nexport default function createMentionPlugin() {\r\n  //  const url = \"http://szwb1.herokuapp.com/api\";\r\n  const url = \"https://api.multiavatar.com\"\r\n\r\n\r\n\r\n  let externalES = null;\r\n  let externalSetEditorState = null;\r\n  //let friendsList = [\"mmm\", \"\", \"nbwb\"];\r\n  let friendsList = [];\r\n  const friendObj = {}\r\n\r\n  friendsList.forEach(friendName => {\r\n    friendObj[friendName] = null\r\n    axios.get(\r\n      //`${url}/avatar/downloadavatar/${friendName}`,\r\n      `${url}/${friendName}.svg`,\r\n      {\r\n        responseType: 'arraybuffer',\r\n        onDownloadProgress: function (progressEvent) { }\r\n      }).then((response) => {\r\n        const base64 = btoa(new Uint8Array(response.data).reduce((data, byte) => data + String.fromCharCode(byte), ''));\r\n        friendObj[friendName] = \"data:\" + response.headers[\"content-type\"] + \";base64,\" + base64\r\n      })\r\n\r\n\r\n  })\r\n\r\n  let tabIndex = 99123;\r\n\r\n  function Panel0({ inMentionPanel = false, ...props }) {\r\n\r\n\r\n    return (\r\n      <div\r\n\r\n        contentEditable=\"false\" suppressContentEditableWarning=\"true\"\r\n        style={{ backgroundColor: \"pink\", position: \"absolute\", zIndex: 100, width: \"max-content\" }}\r\n\r\n      >\r\n        {friendsList.map(friendName => {\r\n          return (\r\n            <div onMouseDown={function () { alert(\"xxddssddss\") }}>\r\n              {friendName}\r\n            </div>\r\n          )\r\n        })}\r\n\r\n      </div>\r\n\r\n    )\r\n\r\n  }\r\n\r\n\r\n\r\n  function Panel({ inMentionPanel = false, ...props }) {\r\n    const theme = useTheme()\r\n    const [opacity, setOpacity] = useState(0)\r\n\r\n    const { mentionHeadKey, mentionBodyKey, entityKey } = props\r\n    const { mentionHeadRoot, mentionBodyRoot, mentionBodyRoot2, mentionHeadAvatar, mentionHeadLabel, mentionHeadLabel2, mentionBodyLabel, } = useStyles();\r\n\r\n\r\n\r\n    useEffect(function () {\r\n      setOpacity(1)\r\n    }, [])\r\n\r\n    return (\r\n\r\n      <Paper\r\n        elevation={2}\r\n\r\n        contentEditable=\"false\" suppressContentEditableWarning=\"true\"\r\n        style={{\r\n\r\n          width: \"max-content\",\r\n          position: \"absolute\",\r\n          marginTop: theme.spacing(0),\r\n          //  top:0,\r\n          left: \"0px\",\r\n          zIndex: 122,\r\n          display: \"flex\",\r\n\r\n          flexDirection: \"column\",\r\n          opacity: opacity,\r\n          transform: `scale(${opacity})`,\r\n          transitionProperty: \"opacity,transform\",\r\n          transitionDuration: \"0.2s\",\r\n\r\n\r\n        }}>\r\n\r\n\r\n        {friendsList.map(function (friendName, index) {\r\n\r\n          return (\r\n\r\n            <Chip\r\n              key={index}\r\n              classes={{ root: mentionBodyRoot2, label: mentionBodyLabel }}\r\n              style={{\r\n                backgroundColor: (props.tabIndex % friendsList.length === index)\r\n                  ? theme.palette.mentionBackColor : inMentionPanel ? theme.palette.mentionBackColor : theme.palette.action.disabledBackground,\r\n                // ...(props.tabIndex % friendsList.length === index)&&{ backgroundColor:theme.palette.mentionBackColor}\r\n                cursor: \"pointer\",\r\n                width: \"fit-content\"\r\n              }}\r\n\r\n              avatar={<Avatar alt=\"Natacha\" src={friendObj[friendName]} />}\r\n\r\n              onMouseDown={() => {\r\n                insertMention(inMentionPanel ? \" @\" + friendName : friendName, mentionHeadKey, mentionBodyKey, entityKey)\r\n              }}\r\n\r\n              label={<Typography variant=\"body2\" >{friendName}</Typography>}\r\n            />\r\n          )\r\n\r\n        })}\r\n\r\n\r\n\r\n\r\n      </Paper>\r\n\r\n    )\r\n  }\r\n\r\n\r\n  function Mention(props) {\r\n\r\n    const { contentState, entityKey, blockKey, offsetKey, start, end, decoratedText, children } = props;\r\n    const { mentionHeadKey, mentionBodyKey, person, imgurl, mentionType } = contentState.getEntity(entityKey).getData()\r\n    const theme = useTheme()\r\n    const { mentionHeadRoot, mentionBodyRoot, mentionBodyRoot2, mentionHeadAvatar, mentionHeadLabel, mentionHeadLabel2, mentionBodyLabel, } = useStyles();\r\n\r\n    if ((mentionType === \"shortMentionOn\")) {\r\n      return (\r\n        <span style={{\r\n          position: \"relative\",\r\n          // display: \"inline-block\",\r\n\r\n        }}>\r\n\r\n          <Chip\r\n            style={{ display: \"inline-block\" }}\r\n            classes={{ root: mentionHeadRoot, avatar: mentionHeadAvatar, label: mentionHeadLabel }}\r\n            avatar={<Avatar alt=\"Natacha\" style={{ opacity: 0.5, }} />}\r\n            label={<Typography variant=\"body2\" style={{ clipPath: \"circle(0% at 50% 50%)\", }}>{children}</Typography>}\r\n          />\r\n          {!isMobile && <Panel tabIndex={tabIndex} mentionHeadKey={mentionHeadKey} mentionBodyKey={mentionBodyKey} entityKey={entityKey} />}\r\n        </span>\r\n      )\r\n    }\r\n    else if (mentionType === \"shortMentionOff\") {\r\n\r\n      return (\r\n        <span style={{\r\n          position: \"relative\",\r\n          borderTopLeftRadius: \"999px\",\r\n          borderBottomLeftRadius: \"999px\",\r\n        }}>\r\n          {children}\r\n        </span>\r\n      )\r\n    }\r\n\r\n\r\n    else if (mentionType === \"longMentionOnAt_HEAD\") {\r\n      return (\r\n        <span style={{\r\n          position: \"relative\",\r\n          //   display: \"inline-block\",\r\n        }}>\r\n\r\n          <Chip\r\n            classes={{ root: mentionHeadRoot, avatar: mentionHeadAvatar, label: mentionHeadLabel }}\r\n            avatar={<Avatar alt=\"Natacha\" style={{ opacity: 0.5, }} />}\r\n            label={<Typography variant=\"body2\" style={{ clipPath: \"circle(0% at 50% 50%)\", }}>{children}</Typography>}\r\n          />\r\n          {!isMobile && <Panel tabIndex={tabIndex} mentionHeadKey={mentionHeadKey} mentionBodyKey={mentionBodyKey} entityKey={entityKey} />}\r\n        </span>\r\n\r\n      )\r\n    }\r\n\r\n    else if (mentionType === \"longMentionOnAt_BODY\") {\r\n      return (\r\n\r\n        <Chip\r\n          classes={{ root: mentionBodyRoot, label: mentionBodyLabel }}\r\n          size=\"medium\"\r\n          label={<Typography variant=\"body2\" >{children}</Typography>}\r\n        />\r\n\r\n\r\n      )\r\n    }\r\n\r\n\r\n    ///////////////////////\r\n    ///////////////////////\r\n    else if (mentionType === \"longMentionOnOther_HEAD\") {\r\n\r\n\r\n      return (\r\n\r\n        // <Chip\r\n        //   classes={{ root: mentionHeadRoot, avatar: mentionHeadAvatar, label: mentionHeadLabel }}\r\n        //   avatar={<Avatar alt=\"Natacha\" style={{}} />}\r\n        //   label={<Typography variant=\"body2\" >{children}</Typography>}\r\n        // />\r\n        <Chip\r\n\r\n          classes={{ root: mentionHeadRoot, avatar: mentionHeadAvatar, label: mentionHeadLabel }}\r\n          avatar={<Avatar alt=\"Natacha\" style={{ opacity: 0.5, }} />}\r\n          label={<Typography variant=\"body2\" style={{ clipPath: \"circle(0% at 50% 50%)\", }}>{children}</Typography>}\r\n\r\n        />\r\n\r\n\r\n\r\n      )\r\n    }\r\n    else if (mentionType === \"longMentionOnOther_BODY\") {\r\n      return (\r\n\r\n        <Chip\r\n          classes={{ root: mentionBodyRoot, label: mentionBodyLabel }}\r\n          label={<Typography variant=\"body2\" >{children}</Typography>}\r\n        />\r\n\r\n\r\n      )\r\n    }\r\n    ////////////////////////////////////////////////\r\n    ////////////////////////////////////////////////\r\n    else if (mentionType === \"longMentionOff_HEAD\") {\r\n\r\n      return <></>\r\n\r\n    }\r\n\r\n    else if (mentionType === \"longMentionOff_BODY\") {\r\n\r\n\r\n\r\n      return <>\r\n\r\n\r\n\r\n        <Chip\r\n          classes={{ root: mentionBodyRoot2, label: mentionBodyLabel }}\r\n          avatar={<Avatar alt=\"Natacha\" src={friendObj[person]||`${url}/${person}.svg`}\r\n\r\n          />}\r\n          label={<Typography variant=\"body2\" >{children}</Typography>}\r\n        />\r\n\r\n      </>\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n\r\n  }\r\n\r\n  function mentionStrategy(contentBlock, callback, contentState) {\r\n\r\n    contentBlock.findEntityRanges(\r\n      function (character) {\r\n        const entityKey = character.getEntity();\r\n        return entityKey !== null && contentState.getEntity(entityKey).getType().indexOf(\"Mention\") >= 0\r\n      },\r\n      callback\r\n    );\r\n  }\r\n\r\n\r\n  function insertMention(friendName, mentionHeadKey, mentionBodyKey, entityKey) {\r\n\r\n\r\n    const text = friendName + \" \"\r\n    const contentState = externalES.getCurrentContent();\r\n    const selection = externalES.getSelection();\r\n\r\n\r\n    const mentionBodyText = mentionBodyKey\r\n      ? contentState.getEntity(mentionBodyKey).getData().person.replace(\" @\", \"\")\r\n      : \"\"\r\n\r\n    const [anchorKey, anchorOffset, focusKey, focusOffset, isBackward, hasfocus] = selection.toArray()\r\n    const [anchorStartKey, anchorStartOffset, anchorFocusKey, anchorFocusOffset, isAnchorBackward, isAnchorFocused]\r\n      = [!isBackward ? anchorKey : focusKey, !isBackward ? anchorOffset : focusOffset, isBackward ? anchorKey : focusKey, isBackward ? anchorOffset : focusOffset,]\r\n\r\n\r\n    let newSelection = selection.merge({\r\n      anchorKey: anchorStartKey,\r\n      anchorOffset: anchorStartOffset,\r\n      focusKey: anchorStartKey,\r\n      focusOffset: anchorStartOffset + mentionBodyText.length,\r\n      isBackward: false,\r\n      hasFocus: true,\r\n\r\n    })\r\n\r\n\r\n    let newContent = Modifier.replaceText(\r\n      contentState,\r\n      newSelection,\r\n      text,\r\n    )\r\n\r\n    newSelection = externalES.getSelection().merge({\r\n\r\n      anchorKey: anchorStartKey,\r\n      anchorOffset: anchorStartOffset + text.length,\r\n      focusKey: anchorStartKey,\r\n      focusOffset: anchorStartOffset + text.length,\r\n      isBackward: false,\r\n      hasFocus: true,\r\n    })\r\n\r\n    externalES = EditorState.push(externalES, newContent, \"insert-characters\");\r\n    externalES = EditorState.acceptSelection(externalES, newSelection)\r\n\r\n\r\n    externalSetEditorState(externalES)\r\n\r\n\r\n  }\r\n\r\n\r\n\r\n  function taggingMention() {\r\n\r\n    const [anchorKey, anchorOffset, focusKey, focusOffset, isBackward, hasfocus] = externalES.getSelection().toArray()\r\n    const [anchorStartKey, anchorStartOffset, anchorFocusKey, anchorFocusOffset, isAnchorBackward, isAnchorFocused]\r\n      = [!isBackward ? anchorKey : focusKey, !isBackward ? anchorOffset : focusOffset, isBackward ? anchorKey : focusKey, isBackward ? anchorOffset : focusOffset,]\r\n    const regx = /\\s([@][\\w_\\[\\u4E00-\\u9FCA\\]]*)/g\r\n\r\n\r\n    const oldSelection = externalES.getSelection();\r\n    let newSelection = externalES.getSelection();\r\n    let newContent = externalES.getCurrentContent();\r\n\r\n    externalES.getCurrentContent().getBlocksAsArray().forEach(function (block) {\r\n\r\n      const [blockKey, , blockText, metaArr] = block.toArray()\r\n\r\n\r\n      metaArr.forEach(function (item, index) {\r\n        const itemEntityKey = item.getEntity()\r\n        if (itemEntityKey) {\r\n          const entityType = newContent.getEntity(itemEntityKey).getType()\r\n\r\n          if (entityType.indexOf(\"Mention\") >= 0) {\r\n\r\n            newSelection = newSelection.merge({\r\n              anchorKey: blockKey,\r\n              anchorOffset: index,\r\n              focusKey: blockKey,\r\n              focusOffset: index + 1,\r\n              isBackward: false,\r\n              hasFocus: false,\r\n            })\r\n            newContent = Modifier.applyEntity(newContent, newSelection, null)\r\n          }\r\n        }\r\n      })\r\n\r\n\r\n      let matchArr;\r\n      while ((matchArr = regx.exec(blockText)) !== null) {\r\n\r\n        const start = matchArr.index;\r\n        const end = matchArr.index + matchArr[0].length;\r\n        const contentLenth = end - start;\r\n        const contentFocusAt = anchorFocusOffset - start;\r\n\r\n        const shortMentionOn = (contentLenth === 2) && hasfocus && (blockKey === anchorFocusKey) && (contentFocusAt === 2)\r\n        const shortMentionOff = (contentLenth === 2) && ((!hasfocus) || (blockKey !== anchorFocusKey) || (contentFocusAt !== 2))\r\n\r\n        const longMentionOnAt = (contentLenth > 2) && hasfocus && (blockKey === anchorFocusKey) && (contentFocusAt === 2)\r\n        const longMentionOnOther = (contentLenth > 2) && hasfocus && (blockKey === anchorFocusKey) && (contentFocusAt !== 2) && (contentFocusAt > 0) && (contentFocusAt <= contentLenth)\r\n\r\n        const longMentionOff = (contentLenth > 2) && ((!hasfocus) || (blockKey !== anchorFocusKey) || (contentFocusAt <= 0) || (contentFocusAt > contentLenth))\r\n\r\n\r\n        if (shortMentionOn) {\r\n          newContent = newContent.createEntity(\"shortMentionOn\", \"MUTABLE\", { mentionType: \"shortMentionOn\" });\r\n          let entityKey = newContent.getLastCreatedEntityKey();\r\n          newSelection = newSelection.merge({\r\n            anchorKey: blockKey,\r\n            focusKey: blockKey,\r\n            anchorOffset: start,\r\n            focusOffset: end,\r\n            isBackward: false,\r\n            hasFocus: false,\r\n          })\r\n\r\n          newContent = Modifier.applyEntity(newContent, newSelection, entityKey)\r\n\r\n        }\r\n        else if (shortMentionOff) {\r\n          newContent = newContent.createEntity(\"shortMentionOff\", \"MUTABLE\", { mentionType: \"shortMentionOff\" });\r\n          let entityKey = newContent.getLastCreatedEntityKey();\r\n          newSelection = newSelection.merge({\r\n            anchorKey: blockKey,\r\n            focusKey: blockKey,\r\n            anchorOffset: start,\r\n            focusOffset: end,\r\n            isBackward: false,\r\n            hasFocus: false,\r\n          })\r\n\r\n          newContent = Modifier.applyEntity(newContent, newSelection, entityKey)\r\n\r\n        }\r\n        else if (longMentionOnAt) {\r\n\r\n          createTag(\"longMentionOnAt\")\r\n\r\n        }\r\n        else if (longMentionOnOther) {\r\n\r\n          createTag(\"longMentionOnOther\")\r\n\r\n        }\r\n        else if (longMentionOff) {\r\n          createTag(\"longMentionOff\")\r\n        }\r\n\r\n\r\n\r\n        function createTag(tagName) {\r\n\r\n          newContent = newContent.createEntity(`${tagName}_HEAD`, \"MUTABLE\", { mentionType: `${tagName}_HEAD` });\r\n          let mentionHeadKey = newContent.getLastCreatedEntityKey();\r\n          newSelection = newSelection.merge({\r\n            anchorKey: blockKey,\r\n            focusKey: blockKey,\r\n            anchorOffset: start,\r\n            focusOffset: start + 2,\r\n            isBackward: false,\r\n            hasFocus: false,\r\n          })\r\n\r\n          newContent = Modifier.applyEntity(newContent, newSelection, mentionHeadKey)\r\n\r\n          newContent = newContent.createEntity(`${tagName}_BODY`, \"MUTABLE\", { mentionType: `${tagName}_BODY` });\r\n          let mentionBodyKey = newContent.getLastCreatedEntityKey();\r\n          newSelection = newSelection.merge({\r\n            anchorKey: blockKey,\r\n            focusKey: blockKey,\r\n            anchorOffset: start + 2,\r\n            focusOffset: end,\r\n            isBackward: false,\r\n            hasFocus: false,\r\n          })\r\n\r\n          newContent = Modifier.applyEntity(newContent, newSelection, mentionBodyKey)\r\n\r\n\r\n          newContent = newContent.mergeEntityData(\r\n            mentionHeadKey,\r\n            {\r\n              mentionHeadKey, mentionBodyKey,\r\n              person: blockText.substring(start, end).replace(\" @\", \"\"),\r\n              //  imgurl: `url(${url}/avatar/downloadavatar/${blockText.substring(start, end).replace(\" @\", \"\")})`\r\n              imgurl: `${url}/${blockText.substring(start, end).replace(\" @\", \"\")}).svg`\r\n          \r\n            }\r\n          )\r\n\r\n          newContent = newContent.mergeEntityData(\r\n            mentionBodyKey,\r\n            {\r\n              mentionHeadKey, mentionBodyKey,\r\n              person: blockText.substring(start, end).replace(\" @\", \"\"),\r\n              //     imgurl: `url(${url}/avatar/downloadavatar/${blockText.substring(start, end).replace(\" @\", \"\")})`\r\n              imgurl: `${url}/${blockText.substring(start, end).replace(\" @\", \"\")}).svg`\r\n           \r\n            }\r\n          )\r\n        }\r\n\r\n\r\n\r\n      }\r\n    })\r\n\r\n\r\n    externalES = EditorState.push(externalES, newContent, \"apply-entity\");\r\n    externalES = EditorState.acceptSelection(externalES, oldSelection);\r\n    return externalES\r\n\r\n\r\n  }\r\n\r\n\r\n  function hasOnAtTag() {\r\n\r\n    if (friendsList.length <= 0) { return false }\r\n\r\n    let isAtOn = false;\r\n    const contentState = externalES.getCurrentContent();\r\n    contentState.getBlocksAsArray().forEach(function (block) {\r\n\r\n      const metaArr = block.getCharacterList();\r\n      metaArr.forEach(function (item, index) {\r\n\r\n        const tagKey = item.getEntity()\r\n        if (tagKey) {\r\n          const { mentionType, mentionHeadKey, mentionBodyKey } = contentState.getEntity(tagKey).getData()\r\n          if (mentionType) {\r\n\r\n            if (mentionType === \"shortMentionOn\") {\r\n              return isAtOn = [friendsList[tabIndex % friendsList.length], \"\", \"\", tagKey]\r\n            }\r\n            else if (mentionType.indexOf(\"longMentionOnAt\") >= 0) {\r\n              return isAtOn = [friendsList[tabIndex % friendsList.length], mentionHeadKey, mentionBodyKey, tagKey]\r\n            }\r\n          }\r\n        }\r\n      })\r\n\r\n      if (isAtOn) { return isAtOn }\r\n    })\r\n    return isAtOn\r\n  }\r\n\r\n  function MentionButton({ isMentionPanelOn, setIsMentionPanelOn, ...props }) {\r\n\r\n    const theme = useTheme()\r\n\r\n    return (\r\n      <>\r\n        <Button {...props}\r\n\r\n          style={{\r\n\r\n            backgroundColor: isMentionPanelOn ? theme.palette.primary.main : \"\",// theme.palette.background.default,\r\n\r\n\r\n            color: theme.palette.type === \"light\"\r\n              ? isMentionPanelOn\r\n                ? theme.palette.primary.contrastText\r\n                : theme.palette.primary.main\r\n              : isMentionPanelOn\r\n                ? theme.palette.primary.contrastText\r\n                : theme.palette.text.secondary\r\n\r\n\r\n          }}\r\n          onClick={function () {\r\n\r\n            setIsMentionPanelOn(pre => !pre)\r\n          }}\r\n\r\n        >\r\n          <AlternateEmailSharp />\r\n        </Button>\r\n\r\n      </>\r\n    )\r\n\r\n  }\r\n\r\n  function MentionPanel({ isMentionPanelOn, setIsMentionPanelOn, ...props }) {\r\n\r\n\r\n    return (\r\n      <Paper\r\n        style={{\r\n          position: \"relative\",\r\n          // backgroundColor:\"skyblue\",\r\n          // height:\"100px\",\r\n          // width:\"100px\",\r\n\r\n        }}\r\n\r\n      >\r\n        {isMentionPanelOn && <Panel inMentionPanel={true} />}\r\n\r\n      </Paper>\r\n    )\r\n  }\r\n\r\n\r\n  return {\r\n\r\n    mentionPlugin: {\r\n\r\n\r\n      handleBeforeInput(chars, editorState, evenTimeStamp, { setEditorState }) {\r\n\r\n        const [anchorKey, anchorOffset, focusKey, focusOffset, isBackward, hasfocus] = externalES.getSelection().toArray()\r\n        const [anchorStartKey, anchorStartOffset, anchorFocusKey, anchorFocusOffset, isAnchorBackward, isAnchorFocused]\r\n          = [!isBackward ? anchorKey : focusKey, !isBackward ? anchorOffset : focusOffset, isBackward ? anchorKey : focusKey, isBackward ? anchorOffset : focusOffset,]\r\n\r\n\r\n\r\n\r\n        if (hasOnAtTag() && isMobile && (!isFirefox)) {\r\n          externalES = editorState;\r\n          externalSetEditorState = setEditorState;\r\n\r\n          let newSelection = externalES.getSelection()\r\n          let newContent = externalES.getCurrentContent()\r\n\r\n          newSelection = newSelection.merge({\r\n            isBackward: false,\r\n            hasFocus: true,\r\n          })\r\n\r\n\r\n          newContent = Modifier.replaceText(\r\n            newContent,\r\n            newSelection,\r\n            chars,\r\n          )\r\n\r\n          newSelection = newSelection.merge({\r\n            anchorOffset: anchorStartOffset + chars.length * 2,\r\n            focusOffset: anchorFocusOffset + chars.length * 2,\r\n            isBackward: false,\r\n            hasFocus: true,\r\n          })\r\n\r\n\r\n          externalES = EditorState.push(externalES, newContent, \"insert-characters\");\r\n          externalES = EditorState.acceptSelection(externalES, newSelection)\r\n\r\n          setEditorState(externalES)\r\n\r\n          return \"handled\"\r\n        }\r\n\r\n      },\r\n\r\n      handleReturn(e, newState, { setEditorState }) {\r\n        //   alert(\"mention handle return\")\r\n        if (hasOnAtTag()) {\r\n          insertMention(...hasOnAtTag())\r\n          return \"handled\"\r\n        }\r\n        else {\r\n          setEditorState(RichUtils.insertSoftNewline(newState))\r\n          return \"handled\"\r\n\r\n          //////\r\n          const externalES = newState\r\n          let contentState = externalES.getCurrentContent();\r\n          let selection = externalES.getSelection()\r\n\r\n          const currentKey = selection.getEndKey()\r\n\r\n          let newContentBlockArr = contentState.getBlocksAsArray()\r\n\r\n          const currentBlock = contentState.getBlockForKey(currentKey)\r\n\r\n          const currentType = currentBlock.getType()\r\n\r\n          if ((currentType === \"colorBlock\") || (currentType === \"imageBlock\")) {\r\n\r\n            setEditorState(RichUtils.insertSoftNewline(newState))\r\n            return \"handled\"\r\n          }\r\n          else {\r\n            return 'not-handled';\r\n          }\r\n\r\n\r\n        }\r\n\r\n        return 'not-handled';\r\n      },\r\n\r\n\r\n\r\n      keyBindingFn(e, { getEditorState, setEditorState, ...obj }) {\r\n\r\n        if ((e.keyCode === 40) && hasOnAtTag()) {\r\n          tabIndex = tabIndex + 1;\r\n          return \"fire-arrow\";\r\n        }\r\n\r\n        else if ((e.keyCode === 38) && hasOnAtTag()) {\r\n          tabIndex = tabIndex - 1;\r\n          return \"fire-arrow\";\r\n        }\r\n\r\n        // else if ((e.keyCode === 13) && hasOnAtTag()) {\r\n        //   return \"fire-enter\";\r\n        // }\r\n\r\n\r\n      },\r\n\r\n      handleKeyCommand(command, editorState, evenTimeStamp, { setEditorState }) {\r\n\r\n        if (command === \"fire-arrow\") {\r\n          externalSetEditorState(externalES)\r\n          return \"handled\"\r\n        }\r\n\r\n        // if (command === \"fire-enter\") {\r\n        //   alert(\"xxdd\")\r\n        //   insertMention(...hasOnAtTag())\r\n        //   return \"handled\"\r\n        // }\r\n\r\n\r\n        return 'not-handled';\r\n      },\r\n\r\n\r\n      onChange: function (editorState, { setEditorState }) {\r\n        externalES = editorState\r\n        externalSetEditorState = setEditorState\r\n        externalES = taggingMention()\r\n        return externalES\r\n\r\n      },\r\n\r\n      decorators: [\r\n        {\r\n          strategy: mentionStrategy,\r\n          component: Mention\r\n        }\r\n      ],\r\n\r\n    },\r\n\r\n    MentionButton,\r\n\r\n    MentionPanel,\r\n  }\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\nconst formatStringToCamelCase = str => {\r\n  const splitted = str.split(\"-\");\r\n  if (splitted.length === 1) return splitted[0];\r\n  return (\r\n    splitted[0] +\r\n    splitted\r\n      .slice(1)\r\n      .map(word => word[0].toUpperCase() + word.slice(1))\r\n      .join(\"\")\r\n  );\r\n};\r\n\r\nconst getStyleObjectFromString = str => {\r\n  const style = {};\r\n  str.split(\";\").forEach(el => {\r\n    const [property, value] = el.split(\":\");\r\n    if (!property) return;\r\n\r\n    const formattedProperty = formatStringToCamelCase(property.trim());\r\n    style[formattedProperty] = value.trim();\r\n  });\r\n\r\n  return style;\r\n};","import { useState, useRef, useEffect, useContext, useCallback, createContext, useMemo } from 'react';\r\nimport { Context } from \"./ContextProvider\"\r\n\r\n\r\nimport { EditorState, ContentState, ContentBlock, CharacterMetadata, SelectionState, convertToRaw, convertFromRaw, RichUtils, Modifier, convertFromHTML, AtomicBlockUtils } from 'draft-js';\r\nimport Editor from \"draft-js-plugins-editor\";\r\nimport Immutable from 'immutable';\r\n\r\nimport { makeStyles, styled, useTheme, withStyles } from '@material-ui/core/styles';\r\nimport { Typography, Button, ButtonGroup, Container, Paper, Avatar, Box, Chip } from \"@material-ui/core\";\r\nimport { Image, AlternateEmailSharp, DeleteOutlineOutlined, HorizontalSplit, HorizontalSplitOutlined, FormatAlignCenter, FormatAlignRight, PaletteOutlined ,Select  } from \"@material-ui/icons\";\r\n\r\n\r\nimport {\r\n  isMobile,\r\n  isFirefox,\r\n  isChrome,\r\n  browserName,\r\n  engineName,\r\n} from \"react-device-detect\";\r\n\r\nexport default function createDeleteBlogPlugin() {\r\n\r\n  let externalES = null;\r\n  let externalSetEditorState = null;\r\n\r\n\r\n  function deleteBlock(editor) {\r\n\r\n    let contentState = externalES.getCurrentContent();\r\n    let selection = externalES.getSelection()\r\n\r\n    const currentKey = selection.getEndKey()\r\n\r\n    let newContentBlockArr = contentState.getBlocksAsArray()\r\n\r\n    const currentBlock = contentState.getBlockForKey(currentKey)\r\n\r\n    const currentType = currentBlock.getType()\r\n\r\n    if ((currentType !== \"unstyled\") && (currentType !== \"centerBlock\") && (currentType !== \"rightBlock\") && (currentType !== \"colorBlock\")) { return }\r\n\r\n    if (newContentBlockArr.length <= 1) {\r\n      externalES = EditorState.createEmpty()\r\n      setTimeout(() => {\r\n        externalSetEditorState(externalES)\r\n        editor.current.focus()\r\n      }, 0);\r\n      return null\r\n    }\r\n\r\n\r\n\r\n    newContentBlockArr = newContentBlockArr.filter((item) => {\r\n      return item.key !== currentKey\r\n    })\r\n\r\n    contentState = ContentState.createFromBlockArray(newContentBlockArr)\r\n    externalES = EditorState.createWithContent(contentState)\r\n\r\n    // setTimeout(() => {\r\n    externalSetEditorState(externalES)\r\n    // }, 0);\r\n    return externalES\r\n\r\n  }\r\n\r\n  function addTopLine(editor, isTopLine = true) {\r\n    let contentState = externalES.getCurrentContent();\r\n    let selection = externalES.getSelection()\r\n    const selectionBefore = contentState.getSelectionBefore()\r\n    const selectionAfter = contentState.getSelectionAfter()\r\n    const currentKey = selection.getEndKey()\r\n    let newContentBlockArr = contentState.getBlocksAsArray()\r\n    const currentBlock = contentState.getBlockForKey(currentKey)\r\n    const currentType = currentBlock.getType()\r\n\r\n\r\n    const key = genKey()\r\n    newContentBlockArr =\r\n      isTopLine\r\n        ? [new ContentBlock({ key, type: \"unstyled\", text: '', }), ...newContentBlockArr]\r\n        : [...newContentBlockArr, new ContentBlock({ key, type: \"unstyled\", text: '', }),]\r\n\r\n    contentState = ContentState.createFromBlockArray(newContentBlockArr)\r\n\r\n\r\n    selection = selection.merge({\r\n      anchorKey: key,\r\n      focusKey: key,\r\n      anchorOffset: 0,\r\n      focusOffset: 0,\r\n      isBackward: false,\r\n      hasFocus: true,\r\n    })\r\n\r\n\r\n    externalES = EditorState.createWithContent(contentState)\r\n    //  externalES = EditorState.push(externalES, contentState, 'insert-fragment');\r\n    externalES = EditorState.acceptSelection(externalES, selection);\r\n    externalSetEditorState(externalES)\r\n    setTimeout(() => {\r\n      editor.current.focus()\r\n    }, 0);\r\n    return externalES\r\n\r\n\r\n  }\r\n\r\n  function centerBlock(editor, pos = \"centerBlock\") {\r\n\r\n    let contentState = externalES.getCurrentContent();\r\n    let selection = externalES.getSelection()\r\n\r\n    const currentKey = selection.getEndKey()\r\n\r\n    let newContentBlockArr = contentState.getBlocksAsArray()\r\n\r\n    const currentBlock = contentState.getBlockForKey(currentKey)\r\n\r\n    const currentType = currentBlock.getType()\r\n\r\n    if (currentType !== \"unstyled\" && currentType !== \"centerBlock\" && currentType !== \"rightBlock\") { return }\r\n\r\n    contentState = Modifier.setBlockType(contentState, selection, currentType === \"unstyled\" ? pos : currentType === pos ? \"unstyled\" : pos)\r\n\r\n    externalES = EditorState.push(externalES, contentState, \"change-block-type\");\r\n    externalES = EditorState.acceptSelection(externalES, selection)\r\n\r\n    externalSetEditorState(externalES)\r\n    setTimeout(() => {\r\n      editor.current.focus()\r\n    }, 0);\r\n\r\n  }\r\n\r\n  function addBackColor(editor){\r\n\r\n    let contentState = externalES.getCurrentContent();\r\n    let selection = externalES.getSelection()\r\n\r\n    const currentKey = selection.getEndKey()\r\n\r\n    let newContentBlockArr = contentState.getBlocksAsArray()\r\n\r\n    const currentBlock = contentState.getBlockForKey(currentKey)\r\n\r\n    const currentType = currentBlock.getType()\r\n\r\n\r\n    contentState = Modifier.setBlockType(contentState, selection, \"colorBlock\" )\r\n\r\n    externalES = EditorState.push(externalES, contentState, \"change-block-type\");\r\n    externalES = EditorState.acceptSelection(externalES, selection)\r\n\r\n    externalSetEditorState(externalES)\r\n    setTimeout(() => {\r\n      editor.current.focus()\r\n    }, 0);\r\n\r\n\r\n  }\r\n\r\n\r\n\r\n  function DeleteBlogButton({ editor, ...props }) {\r\n\r\n    const theme = useTheme()\r\n    return (\r\n\r\n      <Button {...props}\r\n\r\n        style={{\r\n\r\n          color: theme.palette.type === \"light\"\r\n            ? theme.palette.primary.main\r\n            : theme.palette.text.secondary\r\n        }}\r\n        onClick={function () {\r\n          deleteBlock(editor)\r\n          // topImage(editor)\r\n        }}\r\n\r\n      >\r\n        <DeleteOutlineOutlined />\r\n      </Button>\r\n\r\n    )\r\n  }\r\n\r\n  function AddTopLineButton({ editor, ...props }) {\r\n\r\n    const theme = useTheme()\r\n    return <Button {...props}\r\n\r\n      style={{\r\n        color: theme.palette.type === \"light\"\r\n          ? theme.palette.primary.main\r\n          : theme.palette.text.secondary\r\n      }}\r\n      onClick={function () {\r\n        addTopLine(editor)\r\n      }}\r\n\r\n    >\r\n      <HorizontalSplitOutlined style={{ transform: \"rotate(180deg)\" }} />\r\n    </Button>\r\n  }\r\n\r\n  function AddBottomLineButton({ editor, ...props }) {\r\n\r\n    const theme = useTheme()\r\n    return <Button {...props}\r\n\r\n      style={{\r\n        color: theme.palette.type === \"light\"\r\n          ? theme.palette.primary.main\r\n          : theme.palette.text.secondary\r\n      }}\r\n      onClick={function () {\r\n        addTopLine(editor, false)\r\n      }}\r\n\r\n    >\r\n      <HorizontalSplitOutlined />\r\n    </Button>\r\n  }\r\n\r\n  function AlignCenterButton({ editor, isCenterOn, setIsCenterOn, ...props }) {\r\n\r\n\r\n    const theme = useTheme()\r\n    return <Button {...props}\r\n\r\n      style={{\r\n        backgroundColor: isCenterOn ? theme.palette.primary.main : \"\",// theme.palette.background.default,\r\n        color: theme.palette.type === \"light\"\r\n          ? isCenterOn\r\n            ? theme.palette.primary.contrastText\r\n            : theme.palette.primary.main\r\n          : isCenterOn\r\n            ? theme.palette.primary.contrastText\r\n            : theme.palette.text.secondary\r\n      }}\r\n      onClick={function () {\r\n        centerBlock(editor, \"centerBlock\")\r\n      }}\r\n\r\n    >\r\n      <FormatAlignCenter />\r\n    </Button>\r\n  }\r\n\r\n  function AlignRightButton({ editor, isRightOn, setIsRightOn, ...props }) {\r\n\r\n\r\n    const theme = useTheme()\r\n    return <Button {...props}\r\n\r\n      style={{\r\n        backgroundColor: isRightOn ? theme.palette.primary.main : \"\",// theme.palette.background.default,\r\n        color: theme.palette.type === \"light\"\r\n          ? isRightOn\r\n            ? theme.palette.primary.contrastText\r\n            : theme.palette.primary.main\r\n          : isRightOn\r\n            ? theme.palette.primary.contrastText\r\n            : theme.palette.text.secondary\r\n      }}\r\n      onClick={function () {\r\n        centerBlock(editor, \"rightBlock\")\r\n      }}\r\n\r\n    >\r\n      <FormatAlignRight />\r\n    </Button>\r\n  }\r\n\r\n  function AddBackColorButton({editor,...props}){\r\n\r\n    const theme = useTheme()\r\n    return <Button {...props}\r\n      style={{\r\n        color: theme.palette.type === \"light\"\r\n          ? theme.palette.primary.main\r\n          : theme.palette.text.secondary\r\n      }}\r\n      onClick={function () {\r\n        addBackColor(editor, false)\r\n      }}\r\n    >\r\n      <PaletteOutlined />\r\n    </Button>\r\n\r\n  }\r\n\r\n\r\n  function BackColorPanel({...props}){\r\n\r\n\r\n    return(\r\n      <>\r\nddd\r\n      </>\r\n    )\r\n  }\r\n\r\n\r\n\r\n\r\n\r\n\r\n  return {\r\n\r\n    DeleteBlogButton,\r\n    AddTopLineButton,\r\n    AddBottomLineButton,\r\n    AlignCenterButton,\r\n    AlignRightButton,\r\n    AddBackColorButton,\r\n    BackColorPanel,\r\n\r\n    deleteBlogPlugin: {\r\n      onChange: function (editorState, { setEditorState }) {\r\n        externalES = editorState\r\n        externalSetEditorState = setEditorState\r\n\r\n        return externalES\r\n\r\n      },\r\n    }\r\n\r\n  }\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\nfunction genKey(length = 4) {\r\n\r\n  var result = '';\r\n  var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n  var charactersLength = characters.length;\r\n  for (var i = 0; i < length; i++) {\r\n    result += characters.charAt(Math.floor(Math.random() * charactersLength));\r\n  }\r\n  return result;\r\n}","import { useState, useRef, useEffect, useContext, useCallback, createContext, useMemo } from 'react';\r\nimport { Context } from \"./ContextProvider\"\r\n\r\n\r\nimport { EditorState, ContentState, ContentBlock, CharacterMetadata, SelectionState, convertToRaw, convertFromRaw, RichUtils, Modifier, convertFromHTML, AtomicBlockUtils } from 'draft-js';\r\nimport Editor from \"draft-js-plugins-editor\";\r\nimport Immutable from 'immutable';\r\n\r\nimport chainable from 'draft-js-plugins-chainable';\r\n\r\nimport axios from 'axios';\r\nimport url from './config';\r\n\r\nimport createImagePlugin from './ImagePlugin';\r\nimport createBoldPlugin from './BoldPlugin';\r\nimport createEmojiPlugin from './EmojiPlugin';\r\nimport createMentionPlugin from './MentionPlugin';\r\nimport createLinkPlugin from './LinkPlugin';\r\nimport createDeleteBlogPlugin from './DeleteBlogPlugin';\r\nimport createBackColorPlugin from './BackColorPlugin';\r\n\r\nimport { stateToHTML } from 'draft-js-export-html';\r\nimport ReactHtmlParser, { processNodes, convertNodeToElement, htmlparser2, } from 'react-html-parser';\r\nimport { makeStyles, styled, useTheme } from '@material-ui/core/styles';\r\n\r\nimport { Typography, Button, ButtonGroup, Container, Paper, Box, Avatar, Grid } from \"@material-ui/core\";\r\nimport { Image, Brightness4, Brightness5, FormatBold, FormatItalic, FormatUnderlined, InsertEmoticon, PaletteOutlined } from \"@material-ui/icons\";\r\nimport useMediaQuery from '@material-ui/core/useMediaQuery';\r\n\r\nimport {\r\n  isMobile,\r\n  isFirefox,\r\n  isChrome,\r\n  browserName,\r\n  engineName,\r\n} from \"react-device-detect\";\r\n\r\n\r\n//import yellow from '@material-ui/core/colors/yellow';\r\n\r\n\r\n\r\nconst { boldPlugin, BoldButton, ItalicButton, UnderlineButton, LargeButton, SmallButton, } = createBoldPlugin()\r\nconst { emojiPlugin, EmojiButton, EmojiPanel } = createEmojiPlugin()\r\nconst { imagePlugin, ImageButton, TopImageButton, ImageBlog, hasImageBlock } = createImagePlugin()\r\nconst { mentionPlugin, MentionButton, MentionPanel, } = createMentionPlugin()\r\nconst { linkPlugin } = createLinkPlugin()\r\nconst { deleteBlogPlugin, DeleteBlogButton, AddTopLineButton, AddBottomLineButton, AlignCenterButton, AlignRightButton, } = createDeleteBlogPlugin()\r\nconst { backColorPlugin, AddBackColorButton, BackColorPanel } = createBackColorPlugin()\r\n\r\n\r\n\r\n\r\nexport const useStyles = makeStyles(theme => {\r\n\r\n  // console.log(theme.backgourndImageArr)\r\n  const obj = {}\r\n\r\n  theme.backgourndImageArr.forEach((element, index) => {\r\n    obj[\"css\" + index] = element\r\n  });\r\n\r\n\r\n  console.log(obj)\r\n  //const obj = { css1: { ...theme.backgourndImageArr[0] }, css2: { ...theme.backgourndImageArr[0] } }\r\n\r\n\r\n  return {\r\n    ...obj,\r\n    editorPaperCss: ({ isLight, breakpointsAttribute, isEditorFocusOn }) => {\r\n      // console.log(isLight)\r\n      return {\r\n        // backgroundColor:\"pink\",\r\n        borderWidth: \"1px\", borderStyle: \"none\",// borderRadius: \"25px\",\r\n        borderColor: isEditorFocusOn ? theme.palette.primary.main : theme.palette.text.secondary,\r\n        //overflow:\"hidden\",\r\n        //  paddingLeft: theme.spacing(1),\r\n        //  paddingRight: theme.spacing(1),\r\n        // wordBreak: \"break-all\",\r\n\r\n        wordBreak: \"break-all\",\r\n        whiteSpace: \"pre-wrap\",\r\n        lineBreak: \"anywhere\",\r\n        //  width:\"100%\"\r\n        // minHeight: \"20vh\",\r\n        //theme.typography.fontSize * 10 + \"px\",\r\n\r\n        //whiteSpace: \"pre-line\",\r\n        //...breakpointsAttribute([\"width\", \"100%\", \"100%\", \"75%\", \"75%\", \"75%\"])\r\n      }\r\n    },\r\n\r\n    unstyledBlockCss: () => {\r\n      return {\r\n\r\n        paddingLeft: theme.spacing(1),\r\n        paddingRight: theme.spacing(1),\r\n      }\r\n    },\r\n    imageBlockCss: () => {\r\n      return {\r\n        margin: 0,\r\n        padding: 0,\r\n        //   position: \"relative\",\r\n        width: \"100%\",\r\n        height: 0,\r\n        paddingBottom: \"56.25%\",\r\n      }\r\n    },\r\n    centerBlockCss: () => {\r\n      return {\r\n        // display: \"flex\",\r\n        // justifyContent: \"center\",\r\n        paddingLeft: theme.spacing(1),\r\n        paddingRight: theme.spacing(1),\r\n        textAlign: \"center\",\r\n      }\r\n\r\n    },\r\n    rightBlockCss: () => {\r\n      return {\r\n        paddingLeft: theme.spacing(1),\r\n        paddingRight: theme.spacing(1),\r\n        textAlign: \"end\",\r\n\r\n      }\r\n    },\r\n\r\n\r\n\r\n\r\n    colorBlockCss: () => {\r\n      // console.log(backImageArr, backImageIndex)\r\n      // if (!backImageArr) { return {} }\r\n      return {\r\n        position: \"relative\",\r\n        display: \"flex\",\r\n        backgroundColor: \"wheat\",\r\n        // width:\"100%\",\r\n        height: 0,\r\n        paddingBottom: \"56.25%\",\r\n        alignItems: \"center\",\r\n        justifyContent: \"center\",\r\n\r\n        overflow: \"auto\",\r\n        // overflow: \"hidden\",\r\n\r\n        // backgroundImage: \"url(https://mernchen.herokuapp.com/api/picture/download/60a204e70270cc001728285f)\",\r\n        // backgroundImage: \"url(https://mernchen.herokuapp.com/api/picture/download/60a2062e95f2250017420aa4)\",\r\n        //  backgroundImage: \"url(https://mernchen.herokuapp.com/api/picture/download/60b701a9dc07780017dcfd38)\",\r\n        //    backgroundImage: backImageArr[backImageIndex],\r\n\r\n        //  backgroundImage: \"url(https://mernchen.herokuapp.com/api/picture/download/60b6f77fae1acf0017a96c4b)\",\r\n        //  backgroundImage: \"url(https://picsum.photos/800/450)\",\r\n        backgroundSize: \"contain\",\r\n        //color:\"white\",\r\n        // aspectRatio: \"16 / 9\",\r\n\r\n        \"& > div\": {\r\n          textAlign: \"center\",\r\n          position: \"absolute\",\r\n          top: \"50%\",\r\n          transform: \"translateY(-50%)\",\r\n          // color: \"pink\",\r\n\r\n        }\r\n\r\n\r\n\r\n\r\n      }\r\n\r\n\r\n    },\r\n\r\n    className1: props => {\r\n\r\n      return {\r\n        background: 'linear-gradient(45deg, #FE6B8B 30%, #FF8E53 90%)',\r\n        // fontSize:200,\r\n        '&:hover': { background: 'linear-gradient(45deg, #FE6B8B 30%, #FF8E53 90%)', },\r\n      }\r\n    },\r\n\r\n\r\n\r\n  }\r\n})\r\n\r\n\r\nconst initialState = {\r\n  entityMap: {\r\n    // \"0\": {\r\n    //     type: \"image\",\r\n    //     mutability: \"IMMUTABLE\",\r\n    //     data: {\r\n    //         src:\r\n    //             \"https://www.draft-js-plugins.com/images/canada-landscape-small.jpg\"\r\n    //     }\r\n    // }\r\n  },\r\n  blocks: [\r\n    // {\r\n    //   key: \"1111\",\r\n    //   text: \"ewijveoij http://weibo.com/aas vvv @mmm fdsfd  \\n \\n \\n \\n \\n dsd\",//`  @aaa @dds http://asd.com `,//  \\uD83D\\uDE47\\u200D\\u2640\\uFE0F   `,   //  \\uD83D\\uDE33`,\r\n    //   type: \"unstyled\",\r\n    //   // type:\"unstyled\",\r\n    //   depth: 0,\r\n    //   inlineStyleRanges: [\r\n    //     //    {\r\n    //     //         offset: 4,\r\n    //     //         length: 10,\r\n    //     //         style: \"HIGHLIGHT\"\r\n    //     //    },\r\n    //   ],\r\n    //   entityRanges: [],\r\n    //   data: {}\r\n    // },\r\n\r\n\r\n\r\n    // {\r\n    //   key: \"2222\",\r\n    //   text: `  @aaa @dds http://asd.com `,//  \\uD83D\\uDE47\\u200D\\u2640\\uFE0F   `,   //  \\uD83D\\uDE33`,\r\n    //   type: \"unstyled\",\r\n    //   depth: 0,\r\n\r\n    //   // data: {\r\n    //   //   imgUrl: \"https://source.unsplash.com/random/800x800\",//\"blob:http://localhost:3000/3d815879-af57-4950-a82c-a6301402fa99\",\r\n    //   //   imgId: \"\",\r\n    //   //   imgArr: [\"https://source.unsplash.com/random/1300x400\", \"https://mernchen.herokuapp.com/api/picture/download/5f197ef0452cc60017f9f488\", \"https://source.unsplash.com/random/800x751\", \"https://source.unsplash.com/random/100x252\"]\r\n    //   // }\r\n    // },\r\n\r\n\r\n  ]\r\n};\r\n\r\nexport default function DraftEditor() {\r\n\r\n  const { isLight, setIsLight, breakpointsAttribute,\r\n    editorContent,\r\n    setEditorContent,\r\n    lgSizeObj, smSizeObj, deviceSize,\r\n    picArr, setPicArr,\r\n    postArr, setPostArr,\r\n    postPicArr, setPostPicArr,\r\n    // backImageArr, setBackImageArr,\r\n    // backImageIndex, setBackImageIndex,\r\n  } = useContext(Context)\r\n  const theme = useTheme()\r\n\r\n  // const [picArr,setPicArr] = useState([])\r\n\r\n  const [isBoldOn, setIsBoldOn] = useState(false)\r\n  const [isItalicOn, setIsItalicOn] = useState(false)\r\n  const [isUnderlineOn, setIsUnderlineOn] = useState(false)\r\n  const [isLargeOn, setIsLargeOn] = useState(false)\r\n  const [isSmallOn, setIsSmallOn] = useState(false)\r\n\r\n\r\n  const [isEmojiPanelOn, setIsEmojiPanelOn] = useState(false)\r\n  const [isMentionPanelOn, setIsMentionPanelOn] = useState(false)\r\n  const [isBackColorPanelOn, setIsBackColorPanelOn] = useState(false)\r\n\r\n  const [isCenterOn, setIsCenterOn] = useState(false)\r\n  const [isRightOn, setIsRightOn] = useState(false)\r\n\r\n\r\n  const [isEditorFocusOn, setIsEditorFocusOn] = useState(false)\r\n\r\n  //const [picArr, setPicArr] = useState([])\r\n\r\n  const editor = useRef()\r\n  const { editorPaperCss, className1, unstyledBlockCss, imageBlockCss, centerBlockCss, rightBlockCss, colorBlockCss, ...restCss } = useStyles({ isLight, isEditorFocusOn, breakpointsAttribute })\r\n\r\n  //console.log(backImageCssArr)\r\n  //const [editorState, setEditorState] = useState(EditorState.createEmpty())\r\n  //const [editorState, setEditorState] = useState(EditorState.createWithContent(ContentState.createFromText('some')))\r\n  const [editorState, setEditorState] = useState(EditorState.createWithContent(convertFromRaw(initialState)))\r\n\r\n  useEffect(function () {\r\n    setTimeout(() => {\r\n      editor.current.focus()\r\n      EditorState.moveFocusToEnd(editorState)\r\n    }, 0);\r\n  }, [])\r\n\r\n\r\n  function toPreHtml(editorContent, postID = \"local\") {\r\n\r\n\r\n    const preHtml = stateToHTML(\r\n      editorContent.getCurrentContent(),\r\n      {\r\n        defaultBlockTag: \"div\",\r\n\r\n        inlineStyles: {\r\n          LARGE: { style: { fontSize: lgSizeObj[deviceSize] }, },\r\n          //   LARGE: { style: { fontSize:\"3.5rem\" }},\r\n          SMALL: { style: { fontSize: smSizeObj[deviceSize] }, },\r\n          //   linkStyle: { style: { fontSize: 0 } }\r\n          //  LARGE: { attributes: { class: \"largeText\" } },\r\n        },\r\n\r\n\r\n        blockStyleFn: function (block) {\r\n          const type = block.getType()\r\n          // console.log(type)\r\n\r\n          if (type === \"unstyled\") {\r\n            return {\r\n              attributes: {\r\n                //className: unstyledBlockCss,\r\n\r\n              },\r\n              style: {\r\n                paddingLeft: \"8px\",\r\n                paddingRight: \"8px\",\r\n              }\r\n            }\r\n          }\r\n          if (type === \"centerBlock\") {\r\n            return {\r\n              attributes: {\r\n                className: centerBlockCss,\r\n              },\r\n            }\r\n          }\r\n          if (type === \"rightBlock\") {\r\n            return {\r\n              attributes: {\r\n                className: rightBlockCss,\r\n              },\r\n\r\n            }\r\n          }\r\n          if (type === \"imageBlock\") {\r\n\r\n          }\r\n          if (type === \"colorBlock\") {\r\n\r\n            return {\r\n              attributes: {\r\n\r\n                colorblock: \"true\",\r\n                backimage: block.getData().toJS().img,\r\n                textcolor: block.getData().toJS().textColor,\r\n              },\r\n              // style: {\r\n              //   backgroundImage: block.getData().toJS().img,//\"url(https://mernchen.herokuapp.com/api/picture/download/60a204e70270cc001728285f)\",\r\n              //   color:block.getData().toJS().textColor,\r\n              // },\r\n            }\r\n          }\r\n        },\r\n\r\n        blockRenderers: {\r\n          imageBlock: function (block) {\r\n            const text = block.getText()\r\n            const data = block.getData().toObject()\r\n            const type = block.getType()\r\n\r\n            //  return `<img src=${data.imgUrl} style=max-width:300px;display:block;margin-left:auto;margin-right:auto;/>`\r\n            //  return `<imgtag id=${data.imgId} style=max-width:100%;display:block;margin-left:auto;margin-right:auto;/>`\r\n            return `<imgtag id=\"${postID}\">` + escape(block.getText()) + '</imgtag>'\r\n            // return `<div>ffd</div>`\r\n            // return '<imgtag />'\r\n          },\r\n          // colorBlock: function (block) {\r\n          //   return `<colorBlock>` + (block.getText()) + `</colorBlock>`\r\n          // },\r\n        },\r\n\r\n        entityStyleFn: function (entity) {\r\n          const { type, data, mutablity } = entity.toObject()\r\n          if (type === \"shortMentionOff\") {\r\n            return {\r\n              element: \"shortMentionoff\",\r\n            }\r\n          }\r\n          if (type === \"longMentionOff_HEAD\") {\r\n\r\n            return {\r\n\r\n              element: \"longmentionoff_head\",\r\n              attributes: {\r\n                imgurl: data.imgurl,\r\n                person: data.person,\r\n              },\r\n              style: {}\r\n            }\r\n          }\r\n          if (type === \"longMentionOff_BODY\") {\r\n\r\n            return {\r\n\r\n              element: \"longmentionoff_body\",\r\n              attributes: {\r\n                imgurl: data.imgurl,\r\n                person: data.person,\r\n              },\r\n\r\n            }\r\n\r\n          }\r\n          if (type === \"EMOJI\") {\r\n            console.log(data.url)\r\n\r\n            return {\r\n              element: \"emoji\",\r\n              attributes: {\r\n                imgurl: data.url,\r\n                symbol: data.symbol\r\n              }\r\n            }\r\n          }\r\n          // if (type === \"linkOn\") {\r\n          //   const {linkType,linkAddress,linkHost} = data\r\n          // }\r\n          if (type === \"linkOff\") {\r\n            // alert(\"xxx\")\r\n            const { linkType, linkAddress, linkHost } = data\r\n            return {\r\n              element: \"linkoff\",\r\n              attributes: {\r\n                ...data\r\n              }\r\n            }\r\n          }\r\n\r\n        },\r\n\r\n      }\r\n    )\r\n    return preHtml\r\n  }\r\n\r\n\r\n  return (\r\n\r\n    <Container disableGutters={false}>\r\n\r\n      {/* <Avatar />lorem jkdlks */}\r\n      {/* <Avatar src={\"https://i.pravatar.cc/300\"} /> */}\r\n      {/* <Typography gutterBottom variant=\"body2\" color=\"textSecondary\" noWrap align=\"right\">lorem jdlks djlsfjlkj lkjfljeoiw lkj fdsoij dfslk  jlkfdj jkdjf  fjdkj  kjdlsjd  jeiwohj hdflshjl ljoisdo</Typography> */}\r\n\r\n\r\n      <Box style={{\r\n        marginBottom: \"5px\",\r\n\r\n        display: \"flex\", alignItems: \"center\", justifyContent: \"flex-start\", flexWrap: isMobile ? \"wrap\" : \"wrap\",\r\n\r\n        gap: theme.spacing(1),\r\n        //   width: \"100%\",\r\n      }}>\r\n        <Paper\r\n          //    elevation\r\n          style={{\r\n\r\n            ...(isMobile && !isFirefox) && { marginRight: theme.spacing(1) },\r\n            display: \"flex\", alignItems: \"center\", justifyContent: \"flex-start\", flexWrap: \"wrap\",\r\n            gap: theme.spacing(1),\r\n            width: \"fit-content\",\r\n          }}>\r\n          <ButtonGroup variant=\"text\" style={{}}>\r\n\r\n            <BoldButton editor={editor} isBoldOn={isBoldOn} setIsBoldOn={setIsBoldOn} />\r\n            <ItalicButton editor={editor} isItalicOn={isItalicOn} setIsItalicOn={setIsItalicOn} />\r\n            <UnderlineButton editor={editor} isUnderlineOn={isUnderlineOn} setIsUnderlineOn={setIsUnderlineOn} />\r\n\r\n            <LargeButton editor={editor} isLargeOn={isLargeOn} setIsLargeOn={setIsLargeOn} />\r\n            <SmallButton editor={editor} isSmallOn={isSmallOn} setIsSmallOn={setIsSmallOn} />\r\n\r\n            {/* <CenterButton editor={editor} isCenterOn={isCenterOn} setIsCenterOn={setIsCenterOn} /> */}\r\n\r\n          </ButtonGroup>\r\n        </Paper>\r\n        <Paper\r\n          style={{\r\n\r\n            display: \"flex\", alignItems: \"center\", justifyContent: \"flex-start\", flexWrap: \"wrap\",\r\n            gap: theme.spacing(1),\r\n            width: \"fit-content\",\r\n          }}>\r\n          <ButtonGroup variant=\"text\" style={{}}>\r\n\r\n            {!isMobile && <EmojiButton color=\"primary\" fontSize=\"small\" isEmojiPanelOn={isEmojiPanelOn} setIsEmojiPanelOn={setIsEmojiPanelOn} />}\r\n\r\n            <MentionButton color=\"primary\" fontSize=\"small\" isMentionPanelOn={isMentionPanelOn} setIsMentionPanelOn={setIsMentionPanelOn} />\r\n\r\n            <ImageButton color=\"primary\" fontSize=\"small\" picArr={picArr} setPicArr={setPicArr} editor={editor} />\r\n            {/* <TopImageButton color=\"primary\" fontSize=\"small\"  editor={editor} />  */}\r\n          </ButtonGroup>\r\n        </Paper>\r\n        <Paper\r\n          style={{\r\n\r\n            display: \"flex\", alignItems: \"center\", justifyContent: \"flex-start\", flexWrap: \"wrap\",\r\n            gap: theme.spacing(1),\r\n            width: \"fit-content\",\r\n          }}>\r\n          <ButtonGroup variant=\"text\" style={{}}>\r\n            <AddTopLineButton editor={editor} />\r\n            <DeleteBlogButton editor={editor} />\r\n            <AddBottomLineButton editor={editor} />\r\n            <AlignCenterButton editor={editor} isCenterOn={isCenterOn} setIsCenterOn={setIsCenterOn} />\r\n            <AlignRightButton editor={editor} isRightOn={isRightOn} setIsRightOn={setIsRightOn} />\r\n            <AddBackColorButton editor={editor} color=\"primary\" fontSize=\"small\" isBackColorPanelOn={isBackColorPanelOn} setIsBackColorPanelOn={setIsBackColorPanelOn} />\r\n\r\n            <Button\r\n\r\n              onClick={function () {\r\n                setIsLight(pre => !pre)\r\n                editor.current.focus()\r\n              }}\r\n              style={{\r\n                color: theme.palette.type === \"dark\"\r\n\r\n                  ? theme.palette.text.secondary\r\n                  : theme.palette.primary.main\r\n\r\n              }}\r\n            >\r\n              {isLight\r\n                ? <Brightness5 />\r\n                : <Brightness4 />\r\n              }\r\n            </Button>\r\n          </ButtonGroup>\r\n        </Paper>\r\n\r\n      </Box>\r\n\r\n\r\n      <Paper\r\n\r\n        elevation={isEditorFocusOn ? 5 : 1}\r\n        //  className={editorPaperClass}\r\n        classes={{ root: editorPaperCss }}\r\n        style={{\r\n          // backgroundColor: \"pink\"\r\n          // backgroundImage\r\n          // minHeight: \"20vh\",\r\n          // backgroundImage:\"url(https://source.unsplash.com/random/800x800)\",\r\n          // opacity:0.3\r\n        }}\r\n        onClick={function () {\r\n\r\n          let editorState_ = EditorState.moveSelectionToEnd(editorState);\r\n\r\n          setEditorState(EditorState.forceSelection(editorState_, editorState.getSelection()));\r\n          setIsEditorFocusOn(true)\r\n        }}\r\n      >\r\n\r\n        <Editor\r\n          ref={function (element) { editor.current = element; }}\r\n          editorState={editorState}\r\n\r\n\r\n          onChange={function (newState, { ...props }) {\r\n\r\n\r\n            const { BOLD, ITALIC, UNDERLINE, LARGE, SMALL } = newState.getCurrentInlineStyle().toObject()\r\n            const selection = newState.getSelection()\r\n            const contentState = newState.getCurrentContent()\r\n            const currentKey = selection.getFocusKey()\r\n            const currentBlock = contentState.getBlockForKey(currentKey)\r\n            const currentType = currentBlock.getType()\r\n\r\n            setIsCenterOn(currentType === \"centerBlock\")\r\n            setIsRightOn(currentType === \"rightBlock\")\r\n            //  setIsBackColorPanelOn(currentType === \"colorBlock\")\r\n\r\n            setIsEditorFocusOn(selection.hasFocus)\r\n\r\n            setIsBoldOn(Boolean(BOLD))\r\n            setIsItalicOn(Boolean(ITALIC))\r\n            setIsUnderlineOn(Boolean(UNDERLINE))\r\n            setIsLargeOn(Boolean(LARGE))\r\n            setIsSmallOn(Boolean(SMALL))\r\n\r\n            setEditorContent(newState)\r\n            setEditorState(newState)\r\n\r\n          }}\r\n\r\n          plugins={//chainable(\r\n            [\r\n              //    focusPlugin,\r\n              boldPlugin,\r\n              imagePlugin,\r\n              emojiPlugin,\r\n              mentionPlugin,\r\n              linkPlugin,\r\n              deleteBlogPlugin,\r\n              backColorPlugin,\r\n            ]\r\n            // )\r\n          }\r\n\r\n\r\n          // placeholder=\"hihihi\"\r\n          preserveSelectionOnBlur={true}\r\n\r\n          customStyleMap={\r\n            Immutable.Map({\r\n              // stylename1_: {\r\n              //   color: \"rgba(200,0,0,1)\",\r\n\r\n            })\r\n          }\r\n\r\n          customStyleFn={function (style, block) {\r\n\r\n            const styleNames = style.toObject();\r\n\r\n            if (styleNames.LARGE && styleNames.SMALL) {\r\n\r\n            }\r\n            else if (Boolean(styleNames.LARGE)) {\r\n              return {\r\n                //color: \"red\",  // display:\"flex\",   // justifyContent:\"center\",\r\n                fontSize: lgSizeObj[deviceSize],\r\n              }\r\n            }\r\n            else if (Boolean(styleNames.SMALL)) {\r\n              return {\r\n                //color: \"blue\", \r\n                fontSize: smSizeObj[deviceSize]\r\n              }\r\n            }\r\n            else if (Boolean(styleNames.CENTER)) {\r\n\r\n              return {\r\n                display: \"flex\",\r\n                justifyContent: \"center\",\r\n              }\r\n            }\r\n            else {\r\n\r\n            }\r\n          }}\r\n\r\n          blockRenderMap={\r\n            Immutable.Map({\r\n              // 'unstyled': { \r\n              //   element: 'h3',\r\n              //   wrapper: <Typography variant='body2'/>,\r\n              //  }\r\n\r\n              // \"colorBlock\": {\r\n              //   style: \"backgournd-color:red\"\r\n              // }\r\n            })\r\n          }\r\n\r\n\r\n\r\n          blockStyleFn={function (block) {\r\n            const type = block.getType()\r\n            const text = block.getText()\r\n\r\n            //    const {colorBlockCss0} = useStyles(data.img)\r\n\r\n            // console.log(colorBlockCss)\r\n\r\n            if (type === \"unstyled\") {\r\n              return unstyledBlockCss\r\n            }\r\n            if ((type === \"atomic\") && (text === \"imageBlockText\")) {\r\n              return imageBlockCss\r\n            }\r\n            if (type === \"centerBlock\") {\r\n              return centerBlockCss\r\n            }\r\n            if (type === \"rightBlock\") {\r\n              return rightBlockCss\r\n            }\r\n            if (type === \"colorBlock\") {\r\n              console.log(restCss)\r\n              const imgUrl = block.getData().toJS().img\r\n              const index = theme.backgourndImageArr.findIndex(item => {\r\n                return item.backgroundImage === imgUrl\r\n              })\r\n\r\n              return colorBlockCss + \" \" + restCss[\"css\" + index]\r\n            }\r\n          }}\r\n\r\n          blockRendererFn={function (block) {\r\n\r\n            const text = block.getText()\r\n            const data = block.getData().toObject()\r\n            const type = block.getType()\r\n            //   const entityId = editorState.getCurrentContent().getEntityAt(0);\r\n            if (((type === \"atomic\") && (text === \"imageBlockText\")) || (type === \"imageBlock\")) {\r\n              //   console.log(JSON.stringify(data))\r\n              return {\r\n                component: function AAA(props) { return <ImageBlog {...props} picArr={picArr} setPicArr={setPicArr} editor={editor} /> },\r\n                editable: false\r\n              }\r\n            }\r\n\r\n            else {\r\n              return null\r\n            }\r\n\r\n          }}\r\n          handleKeyCommand={function (command, editorState, evenTimeStamp, { getEditorState }) {\r\n\r\n            if (command === \"bold\") {\r\n              setIsBoldOn(pre => !pre)\r\n\r\n              setEditorState(RichUtils.handleKeyCommand(editorState, command))\r\n            }\r\n            else if (command === \"italic\") {\r\n              setIsItalicOn(pre => !pre)\r\n\r\n              setEditorState(RichUtils.handleKeyCommand(editorState, command))\r\n            }\r\n            else if (command === \"underline\") {\r\n              setIsUnderlineOn(pre => !pre)\r\n\r\n              setEditorState(RichUtils.handleKeyCommand(editorState, command))\r\n            }\r\n          }}\r\n        />\r\n\r\n      </Paper>\r\n\r\n      <Button variant=\"contained\" color=\"primary\" disabled={false}\r\n\r\n        style={{ display: \"block\", width: \"100%\", marginTop: theme.spacing(1) }}\r\n        onClick={function (e) {\r\n\r\n          editor.current.focus()\r\n\r\n\r\n          const postID = String(Math.floor(Math.random() * 1000000)) + \"_\" + picArr.length\r\n\r\n\r\n          axios.post(`${url}/article`, {\r\n            ownerName: \"aaa\",\r\n            content: toPreHtml(editorContent, postID),\r\n            postID,\r\n          }).then((response) => {\r\n\r\n\r\n            console.log(response.data)\r\n          })\r\n\r\n\r\n          if (picArr.length > 0) {\r\n\r\n            const data = new FormData();\r\n            const obj = { ownerName: \"aaa\", picName: [] };\r\n            picArr.forEach((pic, index) => {\r\n              const picID = postID + \"_\" + index\r\n              data.append('file', pic)\r\n              obj.picName.push(picID)\r\n              pic.picID = picID\r\n              console.log(picID)\r\n            })\r\n\r\n\r\n            data.append('obj', JSON.stringify(obj));\r\n\r\n            axios.post(`${url}/picture/uploadpicture`, data, {\r\n              headers: { 'content-type': 'multipart/form-data' },\r\n            })\r\n\r\n          }\r\n\r\n\r\n\r\n          setPostArr(pre => { return [toPreHtml(editorContent, \"local\"), ...pre,] })\r\n          setPostPicArr(pre => { return [picArr, ...pre,] })\r\n\r\n        }}\r\n      >Post</Button>\r\n\r\n      <BackColorPanel\r\n        editor={editor}\r\n        isBackColorPanelOn={isBackColorPanelOn}\r\n\r\n      />\r\n\r\n      {!isMobile && <EmojiPanel isEmojiPanelOn={isEmojiPanelOn} />}\r\n\r\n      <MentionPanel isMentionPanelOn={isMentionPanelOn} />\r\n\r\n      {/* <div style={{ whiteSpace: \"pre-wrap\", display: \"flex\", fontSize: 15 }}>\r\n        <div>{JSON.stringify(editorState.getCurrentContent(), null, 2)}</div>\r\n        <hr />\r\n        <div>{JSON.stringify(convertToRaw(editorState.getCurrentContent()), null, 2)}</div>\r\n      </div> */}\r\n\r\n      {/* {toPreHtml(editorContent)} */}\r\n    </Container>\r\n  )\r\n\r\n}\r\n\r\n","import React, { useState, useRef, useEffect } from 'react';\r\n\r\n\r\n\r\nimport { EditorState, ContentState, ContentBlock, CharacterMetadata, SelectionState, convertToRaw, convertFromRaw, RichUtils, Modifier, convertFromHTML, AtomicBlockUtils } from 'draft-js';\r\nimport Editor from \"draft-js-plugins-editor\";\r\nimport Immutable from 'immutable';\r\n\r\n\r\nimport { Typography, Button, ButtonGroup, Container, Link, Box } from \"@material-ui/core\";\r\nimport { CropOriginal, Image, Brightness4, Brightness5, FormatBold, FormatItalic, Link as LinkIcon } from \"@material-ui/icons\";\r\nimport { makeStyles, styled, useTheme } from '@material-ui/core/styles';\r\n\r\n\r\n\r\nexport default function createLlinkPlugin() {\r\n\r\n\r\n  let externalES = null;\r\n  let externalSetEditorState = null;\r\n\r\n  function LinkComponent(props) {\r\n\r\n    const theme = useTheme()\r\n    const { contentState, entityKey, blockKey, offsetKey, start, end, decoratedText } = props;\r\n    const { linkType, linkAddress, linkHost } = contentState.getEntity(entityKey).getData()\r\n\r\n    if (linkType === \"linkOn\") {\r\n      return (\r\n        // <span href={linkAddress} style={{ backgroundColor: \"#FAF\", fontSize: Math.max(fontSize2 * 0.7, 0.7) + \"rem\" }}>\r\n        //   {props.children}\r\n        // </span>\r\n        // <Box component=\"span\" color={theme.palette.primary.light}>{props.children}</Box>\r\n        <Link>{props.children}</Link>\r\n      )\r\n    }\r\n    else if (linkType === \"linkOff\") {\r\n\r\n      return (\r\n        // <Box component=\"span\" color={theme.palette.primary.light}>{props.children}</Box>\r\n        <Link>{props.children}</Link>\r\n      )\r\n\r\n      return (\r\n        <Box component=\"span\" color={theme.palette.primary.light}>\r\n          {/* <Box component=\"span\" color={theme.palette.primary.light} style={{ display: \"none\" }}>{props.children}</Box> */}\r\n          <Box component=\"span\" color={theme.palette.primary.light} > {props.children}</Box>\r\n          {/* {linkHost} */}\r\n        </Box>\r\n      )\r\n    }\r\n  }\r\n\r\n  function linkStrategy(contentBlock, callback, contentState) {\r\n\r\n    contentBlock.findEntityRanges(\r\n      function (character) {\r\n        const entityKey = character.getEntity();\r\n        return (\r\n          entityKey !== null && (\r\n            contentState.getEntity(entityKey).getType() === \"linkOn\" ||\r\n            contentState.getEntity(entityKey).getType() === \"linkOff\"\r\n          )\r\n        );\r\n      },\r\n      callback\r\n    );\r\n  }\r\n\r\n  function taggingLink() {\r\n\r\n    const [anchorKey, anchorOffset, focusKey, focusOffset, isBackward, hasfocus] = externalES.getSelection().toArray();\r\n    const [anchorStartKey, anchorStartOffset, anchorFocusKey, anchorFocusOffset, isAnchorBackward, isAnchorFocused]\r\n      = [!isBackward ? anchorKey : focusKey, !isBackward ? anchorOffset : focusOffset, isBackward ? anchorKey : focusKey, isBackward ? anchorOffset : focusOffset,];\r\n\r\n\r\n    const oldSelection = externalES.getSelection();\r\n    let newContent = externalES.getCurrentContent();\r\n    let newSelection = externalES.getSelection();\r\n\r\n\r\n\r\n    externalES.getCurrentContent().getBlocksAsArray().forEach(function (block) {\r\n      const blockKey = block.getKey();\r\n      const blockType = block.getType();\r\n      const blockText = block.getText();\r\n\r\n\r\n      const regx = /\\s([a-zA-Z]{1,10}:\\/\\/)(([a-zA-Z0-9-_]+\\.?)+(:\\d{0,6})?)(\\/[^\\s\\r\\n\\/]+){0,7}(\\/)?/g\r\n\r\n      const metaArr = block.getCharacterList();\r\n      metaArr.forEach(function (item, index) {\r\n\r\n        if (item.getEntity()) {\r\n          const entityType = newContent.getEntity(item.getEntity()).getType()\r\n\r\n          if ((entityType === \"linkOn\") || (entityType === \"linkOff\")) {\r\n            newSelection = externalES.getSelection().merge({\r\n              anchorKey: blockKey,\r\n              anchorOffset: index,\r\n              focusKey: blockKey,\r\n              focusOffset: index + 1,\r\n              isBackward: false,\r\n              hasFocus: false,\r\n            })\r\n            newContent = Modifier.applyEntity(newContent, newSelection, null)\r\n          }\r\n        }\r\n        if (item.getStyle()) {\r\n          const styleArr = item.getStyle().toArray()\r\n          if (styleArr.includes(\"linkStyle\")) {\r\n            newSelection = externalES.getSelection().merge({\r\n              anchorKey: blockKey,\r\n              anchorOffset: index,\r\n              focusKey: blockKey,\r\n              focusOffset: index + 1,\r\n              isBackward: false,\r\n              hasFocus: false,\r\n            })\r\n          //  newContent = Modifier.removeInlineStyle(newContent, newSelection, \"linkStyle\")\r\n          }\r\n        }\r\n      })\r\n\r\n      let matchArr;\r\n      while ((matchArr = regx.exec(blockText)) !== null) {\r\n\r\n        const start = matchArr.index;\r\n        const end = matchArr.index + matchArr[0].length\r\n        const contentLenth = end - start;\r\n        const contentFocusAt = anchorFocusOffset - start;\r\n        const linkAddress = blockText.substring(start, end);\r\n        const linkHost = \" \" + matchArr[2];\r\n\r\n      \r\n\r\n        const linkOn = hasfocus && (blockKey === anchorFocusKey) && (contentFocusAt > 0) && (contentFocusAt <= contentLenth)\r\n        const linkOff = ((!hasfocus) || (blockKey !== anchorFocusKey) || (contentFocusAt <= 0) || (contentFocusAt - contentLenth > 0))\r\n\r\n\r\n\r\n\r\n        if (linkOn) {\r\n          newContent = newContent.createEntity(\"linkOn\", \"MUTABLE\", { linkType: \"linkOn\", linkAddress, linkHost });\r\n          const entityKey = newContent.getLastCreatedEntityKey();\r\n          newSelection = externalES.getSelection().merge({\r\n            anchorKey: blockKey,\r\n            anchorOffset: start+1,   //[...blockText][start] === \" \" ? start + 1 : start,\r\n            focusKey: blockKey,\r\n            focusOffset: end,\r\n            isBackward: false,\r\n            hasFocus: false,\r\n          })\r\n          newContent = Modifier.applyEntity(newContent, newSelection, entityKey)\r\n        }\r\n        else if (linkOff) {\r\n          newContent = newContent.createEntity(\"linkOff\", \"MUTABLE\", { linkType: \"linkOff\", linkAddress, linkHost });\r\n          const entityKey = newContent.getLastCreatedEntityKey();\r\n          newSelection = externalES.getSelection().merge({\r\n            anchorKey: blockKey,\r\n            anchorOffset: start+1,   //[...blockText][start] === \" \" ? start + 1 : start,\r\n            focusKey: blockKey,\r\n            focusOffset: end,\r\n            isBackward: false,\r\n            hasFocus: false,\r\n          })\r\n          newContent = Modifier.applyEntity(newContent, newSelection, entityKey)\r\n          // newContent = Modifier.applyInlineStyle(newContent, newSelection, \"linkStyle\")\r\n\r\n\r\n\r\n\r\n        }\r\n\r\n\r\n\r\n\r\n\r\n      }\r\n    });\r\n\r\n    externalES = EditorState.push(externalES, newContent, \"insert-fragment\");\r\n    externalES = EditorState.acceptSelection(externalES, oldSelection);\r\n    return externalES;\r\n\r\n\r\n\r\n\r\n\r\n  };\r\n\r\n\r\n\r\n\r\n  return {\r\n\r\n    linkPlugin: {\r\n      onChange(editorState, { setEditorState }) {\r\n        externalES = editorState\r\n        externalSetEditorState = setEditorState\r\n        externalES = taggingLink();\r\n        return externalES\r\n      },\r\n\r\n      decorators: [\r\n        {\r\n          strategy: linkStrategy,\r\n          component: LinkComponent\r\n        }\r\n      ],\r\n    }\r\n\r\n  }\r\n\r\n\r\n}","import { useState, useRef, useEffect, useContext, useCallback, createContext, useMemo } from 'react';\r\n\r\n\r\n\r\nimport { EditorState, ContentState, ContentBlock, CharacterMetadata, SelectionState, convertToRaw, convertFromRaw, RichUtils, Modifier, convertFromHTML, AtomicBlockUtils } from 'draft-js';\r\nimport Editor from \"draft-js-plugins-editor\";\r\nimport Immutable from 'immutable';\r\n\r\nimport { makeStyles, styled, useTheme, withStyles } from '@material-ui/core/styles';\r\nimport { Typography, Button, ButtonGroup, Container, Paper, Avatar, Box, Chip } from \"@material-ui/core\";\r\nimport { Image, AlternateEmailSharp, DeleteOutlineOutlined, HorizontalSplit, HorizontalSplitOutlined, FormatAlignCenter, FormatAlignRight, PaletteOutlined, Select } from \"@material-ui/icons\";\r\n\r\nimport {\r\n  isMobile,\r\n  isFirefox,\r\n  isChrome,\r\n  browserName,\r\n  engineName,\r\n} from \"react-device-detect\";\r\n\r\nexport default function createBackColorPlugin() {\r\n\r\n  let externalES = null;\r\n  let externalSetEditorState = null;\r\n  let isColorBlockOn = false;\r\n\r\n  function addBackColor(editor, imgUrl, textColor) {\r\n\r\n    let contentState = externalES.getCurrentContent();\r\n    let selection = externalES.getSelection()\r\n\r\n    const currentKey = selection.getEndKey()\r\n\r\n    let newContentBlockArr = contentState.getBlocksAsArray()\r\n\r\n    const currentBlock = contentState.getBlockForKey(currentKey)\r\n\r\n    const currentType = currentBlock.getType()\r\n\r\n    // if (currentType !== \"unstyled\" && currentType !== \"centerBlock\" && currentType !== \"rightBlock\") { return }\r\n\r\n\r\n    contentState = Modifier.setBlockType(contentState, selection, currentType === \"colorBlock\" ? \"colorBlock\" : \"colorBlock\")\r\n    contentState = Modifier.setBlockData(contentState, selection, {img:imgUrl,textColor})\r\n    externalES = EditorState.push(externalES, contentState, \"change-block-type\");\r\n    externalES = EditorState.acceptSelection(externalES, selection)\r\n\r\n    externalSetEditorState(externalES)\r\n    setTimeout(() => {\r\n      editor.current.focus()\r\n    }, 0);\r\n\r\n\r\n  }\r\n\r\n\r\n\r\n\r\n\r\n  function AddBackColorButton({ editor, isBackColorPanelOn, setIsBackColorPanelOn, ...props }) {\r\n\r\n    const theme = useTheme()\r\n    return <Button {...props}\r\n\r\n      style={{\r\n\r\n        backgroundColor: isBackColorPanelOn ? theme.palette.primary.main : \"\",// theme.palette.background.default,\r\n\r\n\r\n        color: theme.palette.type === \"light\"\r\n          ? isBackColorPanelOn\r\n            ? theme.palette.primary.contrastText\r\n            : theme.palette.primary.main\r\n          : isBackColorPanelOn\r\n            ? theme.palette.primary.contrastText\r\n            : theme.palette.text.secondary\r\n\r\n\r\n      }}\r\n\r\n\r\n\r\n\r\n      onClick={function () {\r\n        // addBackColor(editor, false)\r\n\r\n        setIsBackColorPanelOn(pre => !pre)\r\n      }}\r\n    >\r\n      <PaletteOutlined />\r\n    </Button>\r\n\r\n  }\r\n\r\n\r\n  function BackColorPanel({ editor, isBackColorPanelOn, backImageArr, setBackImageArr, backImageIndex, setBackImageIndex, ...props }) {\r\n\r\n    const theme = useTheme()\r\n  \r\n\r\n\r\n    return (\r\n      <Box\r\n        style={{\r\n          maxWidth: \"100%\",\r\n          overflow: \"auto\",\r\n          // marginBottom: \"10px\",\r\n          marginTop: isBackColorPanelOn ? \"10px\" : 0,\r\n          //  height: isEmojiPanelOn ? \"auto\" : 0,\r\n          maxHeight: isBackColorPanelOn ? \"35vh\" : 0,\r\n\r\n          transitionProperty: \"height,max-height, opacity\",\r\n          transitionDuration: \"0.2s\",\r\n          opacity: isBackColorPanelOn ? 1 : 0,\r\n          // marginBottom: isEmojiPanelOn ? theme.spacing(2) : 0\r\n          marginBottom: theme.spacing(2),\r\n\r\n          display: \"flex\",\r\n          justifyContent: \"space-between\",\r\n        }}>\r\n\r\n\r\n        {theme.backgourndImageArr.map((img, index) => {\r\n          return (\r\n            <Button\r\n              key={index}\r\n              style={{\r\n                backgroundImage: img.backgroundImage,\r\n                backgroundSize: \"contain\",\r\n                width: \"80px\",\r\n                height: \"45px\",\r\n              }}\r\n              onClick={function () {\r\n              //  alert( img.backgroundImage)\r\n                addBackColor(editor,  img.backgroundImage, img.color||\"white\")\r\n              }}\r\n            />\r\n          )\r\n\r\n        })}\r\n\r\n        {/* <Button style={{\r\n          backgroundImage: \"url(https://mernchen.herokuapp.com/api/picture/download/60b7028076fa440017fb5779)\",\r\n          backgroundSize: \"contain\",\r\n          width: \"80px\",\r\n          height: \"45px\",\r\n        }}>{' '}</Button>\r\n\r\n        <Button style={{\r\n          backgroundImage: \"url(https://mernchen.herokuapp.com/api/picture/download/60b6f77fae1acf0017a96c4b)\",\r\n          backgroundSize: \"contain\",\r\n          width: \"80px\",\r\n          height: \"45px\",\r\n        }}>{' '}</Button>\r\n\r\n        <Button style={{\r\n          backgroundImage: \"url(https://mernchen.herokuapp.com/api/picture/download/60b701a9dc07780017dcfd38)\",\r\n          backgroundSize: \"contain\",\r\n          width: \"80px\",\r\n          height: \"45px\",\r\n        }}>{' '}</Button> */}\r\n\r\n\r\n      </Box>\r\n    )\r\n  }\r\n\r\n\r\n\r\n\r\n\r\n\r\n  return {\r\n\r\n\r\n    AddBackColorButton,\r\n    BackColorPanel,\r\n\r\n    backColorPlugin: {\r\n\r\n      blockStyleFn:function (block) {\r\n\r\n      },\r\n\r\n\r\n\r\n      onChange: function (editorState, { setEditorState }) {\r\n        externalES = editorState\r\n        externalSetEditorState = setEditorState\r\n        return externalES\r\n\r\n      },\r\n\r\n      //  keyBindingFn(e, { getEditorState, setEditorState, ...obj }) {\r\n\r\n\r\n\r\n      // if ((e.keyCode === 13)&&(isColorBlockOn)) {\r\n      //   return \"fire-enterX\";\r\n\r\n      // }\r\n\r\n\r\n      // },\r\n\r\n\r\n      // handleReturn(e,editorState,...props){\r\n      //   console.log(props)\r\n      // },\r\n\r\n\r\n      // handleKeyCommand(command, editorState, evenTimeStamp, { setEditorState }) {\r\n\r\n\r\n      //  if (command === \"fire-enterX\") {\r\n\r\n\r\n\r\n\r\n      //   externalES = RichUtils.insertSoftNewline(externalES)\r\n      //   setEditorState(externalES)\r\n      //    return \"handled\"\r\n      //  }\r\n\r\n\r\n      //  return 'not-handled';\r\n      // },\r\n\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\nfunction genKey(length = 4) {\r\n\r\n  var result = '';\r\n  var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n  var charactersLength = characters.length;\r\n  for (var i = 0; i < length; i++) {\r\n    result += characters.charAt(Math.floor(Math.random() * charactersLength));\r\n  }\r\n  return result;\r\n}","import { useState, useRef, useEffect, useContext, useCallback, createContext, useMemo } from 'react';\r\nimport { Context } from \"./ContextProvider\"\r\n\r\n\r\nimport { EditorState, ContentState, ContentBlock, CharacterMetadata, SelectionState, convertToRaw, convertFromRaw, RichUtils, Modifier, convertFromHTML, AtomicBlockUtils } from 'draft-js';\r\nimport Editor from \"draft-js-plugins-editor\";\r\nimport Immutable from 'immutable';\r\nimport Masonry from 'react-masonry-css';\r\nimport { makeStyles, styled, useTheme } from '@material-ui/core/styles';\r\n\r\nimport { stateToHTML } from 'draft-js-export-html';\r\nimport ReactHtmlParser, { processNodes, convertNodeToElement, htmlparser2, } from 'react-html-parser';\r\n\r\n\r\nimport DetectableOverflow from 'react-detectable-overflow';\r\n\r\n\r\n\r\nimport { Typography, Button, ButtonGroup, Container, Paper, Box, Avatar, Grid, Chip, Link } from \"@material-ui/core\";\r\nimport { Image, Brightness4, Brightness5, FormatBold, FormatItalic, FormatUnderlined, InsertEmoticon, NavigateBeforeSharp } from \"@material-ui/icons\";\r\nimport useMediaQuery from '@material-ui/core/useMediaQuery';\r\n\r\nimport { useStyles } from './DraftEditor';\r\nimport { useStyles as mentionStyles } from './MentionPlugin';\r\n\r\nimport url from './config';\r\n\r\nimport {\r\n  isMobile,\r\n  isFirefox,\r\n  isChrome,\r\n  browserName,\r\n  engineName,\r\n} from \"react-device-detect\";\r\n\r\nimport Lightbox from 'react-image-lightbox';\r\nimport 'react-image-lightbox/style.css'; // This only needs to be imported once in your app\r\n\r\nimport LazyLoad from 'react-lazyload';\r\nimport { useInView } from 'react-intersection-observer';\r\n\r\nexport default function Content({ style }) {\r\n\r\n  const { editorContent, setEditorContent, lgSizeObj, smSizeObj, deviceSize, picArr, setPicArr,\r\n    postArr, setPostArr,\r\n    postPicArr, setPostPicArr,\r\n    getSinglePost,\r\n  } = useContext(Context);\r\n\r\n  const theme = useTheme()\r\n  const { editorPaperCss, className1, unstyledBlockCss, imageBlockCss, centerBlockCss, rightBlockCss, } = useStyles({})\r\n  const { mentionHeadRoot, mentionBodyRoot, mentionBodyRoot2, mentionHeadAvatar, mentionHeadLabel, mentionHeadLabel2, mentionBodyLabel, } = mentionStyles();\r\n\r\n\r\n  function toHtml(preHtml, imgArr, inView) {\r\n    //  alert(\"bbbb\")\r\n    const html = ReactHtmlParser(preHtml, {\r\n\r\n\r\n\r\n      transform: function transformFn(node, index) {\r\n\r\n\r\n\r\n        if (node.name === \"imgtag\") {\r\n          return (inView && <ImgTag key={index} picArr={imgArr} picName={node.attribs.id} />)\r\n        }\r\n        if (node.name === \"emoji\") {\r\n\r\n          //   console.log(node.attribs.symbol, node.attribs.imgurl)\r\n          return (\r\n            <Typography variant=\"body2\"\r\n              key={index}\r\n              style={{\r\n                backgroundRepeat: \"no-repeat\",\r\n                backgroundPosition: \"center center\",\r\n                backgroundSize: \"contain\",\r\n                display: \"inline-block\",\r\n                textAlign: \"right\",\r\n                color: \"rgba(0,0,0,0)\",\r\n                backgroundImage: node.attribs.imgurl,\r\n                transform: isMobile ? \"scale(1.2)\" : \"scale(1.2)\",\r\n                marginLeft: theme.typography.fontSize * 0.12,\r\n                marginRight: theme.typography.fontSize * 0.12,\r\n              }}\r\n            >{node.attribs.symbol}</Typography>\r\n          )\r\n        }\r\n        if (node.name === \"longmentionoff_head\") {\r\n          return (<span key={index}></span>)\r\n        }\r\n        if (node.name === \"longmentionoff_body\") {\r\n\r\n          const arr = [];\r\n          node.children.forEach(element => {\r\n            arr.push(convertNodeToElement(element))\r\n          })\r\n          return (\r\n            <Chip classes={{ root: mentionBodyRoot2, label: mentionBodyLabel }}\r\n              key={index}\r\n              avatar={< Avatar alt={null} src={node.attribs.imgurl.replace(\"url(\", \"\").replace(\")\", \"\")}   //src={friendObj[person]}\r\n              />}\r\n              label={\r\n                <Typography variant=\"body2\">\r\n                  {arr.map((element, index) => {\r\n                    return <span key={index}>{element}</span>\r\n                  })}\r\n                </Typography>\r\n              }\r\n            // label={< Typography variant=\"body2\" >{node.attribs.person}</Typography >}\r\n            />\r\n          )\r\n        }\r\n        if (Object.keys(node.attribs || {}).includes(\"colorblock\")) {\r\n\r\n          const arr = [];\r\n          const arr2 = [];\r\n          const backimage = node.attribs.backimage\r\n          const textcolor = node.attribs.textcolor\r\n          node.children.forEach(item => {\r\n\r\n            arr.push(item.type === \"tag\" ? item : item.data)\r\n            arr2.push(convertNodeToElement(item))\r\n          })\r\n          return (\r\n            <BackColorTag arr={arr} transformFn={transformFn} index={index} arr2={arr2} backimage={backimage} textcolor={textcolor} inView={inView} key={Math.random()} />\r\n          )\r\n        }\r\n        if (node.name === \"linkoff\") {\r\n\r\n          const arr = [];\r\n          node.children.forEach(element => {\r\n            arr.push(convertNodeToElement(element))\r\n          })\r\n          return <span key={index}><LinkTag toHtml={toHtml} node={node} imgArr={imgArr} index={index} /></span>\r\n        }\r\n\r\n      },\r\n    })\r\n\r\n    return html\r\n  }\r\n\r\n  const breakpointColumnsObj = {\r\n    [theme.breakpoints.values.xs]: 1,\r\n    [theme.breakpoints.values.sm]: 1,\r\n    [theme.breakpoints.values.md]: 2,\r\n    [theme.breakpoints.values.lg]: 3,\r\n    [theme.breakpoints.values.xl]: 4,\r\n  };\r\n\r\n  const { ref, inView, entry } = useInView({\r\n    /* Optional options */\r\n    threshold: 0.8,\r\n    triggerOnce: false,\r\n    initialInView: true,\r\n  });\r\n\r\n  useEffect(function () {\r\n    setTimeout(() => {\r\n      if (inView) {\r\n        getSinglePost(postArr.length)\r\n      }\r\n    }, 300);\r\n\r\n\r\n  }, [postArr, inView])\r\n\r\n  return (\r\n    <>\r\n\r\n      <Container disableGutters={false}   >\r\n\r\n        <Masonry\r\n          breakpointCols={breakpointColumnsObj}\r\n          className=\"my-masonry-grid\"\r\n          columnClassName=\"my-masonry-grid_column\"\r\n        >\r\n\r\n          {postArr.map(function (item, index) {\r\n\r\n\r\n\r\n\r\n\r\n            return (\r\n              // <LazyLoad offset={0}>\r\n\r\n              // <Paper classes={{ root: editorPaperCss }} elevation={3}\r\n              //   style={{ overflow: \"hidden\", padding: \"0px\", whiteSpace: \"normal\" }} key={index}>\r\n\r\n\r\n              //   {toHtml(postArr[index], postPicArr[index])}\r\n\r\n\r\n\r\n              // </Paper>\r\n              // </LazyLoad>\r\n\r\n              <PaperContent postArr={postArr} postPicArr={postPicArr} index={index} editorPaperCss={editorPaperCss} toHtml={toHtml} />\r\n            )\r\n\r\n          })}\r\n\r\n\r\n        </Masonry>\r\n\r\n        <div style={{ margin: \"auto\", backgroundColor: \"pink\", width: \"100%\", height: \"30px\",opacity:0 }} ref={ref}>{inView + \"\"}</div>\r\n\r\n      </Container>\r\n\r\n\r\n    </>\r\n  )\r\n\r\n}\r\n\r\nfunction PaperContent({ postArr, postPicArr, index, editorPaperCss, toHtml }) {\r\n\r\n  const { ref, inView, entry } = useInView({\r\n    /* Optional options */\r\n    threshold: 0,\r\n    triggerOnce: true,\r\n    initialInView: false,\r\n  });\r\n\r\n\r\n  return (\r\n    <Paper classes={{ root: editorPaperCss }} elevation={3} ref={ref}\r\n      style={{ overflow: \"hidden\", padding: \"0px\", whiteSpace: \"normal\", }} key={index}>\r\n\r\n      {/* {`${inView}`} */}\r\n      {toHtml(postArr[index], postPicArr[index], inView)}\r\n\r\n\r\n\r\n    </Paper>\r\n\r\n  )\r\n}\r\n\r\n\r\n\r\nfunction ImgTag({ picArr, picName, ...props }) {\r\n\r\n  //  const { editorContent, setEditorContent, lgSizeObj, smSizeObj, deviceSize, picArr, setPicArr } = useContext(Context1);\r\n  const theme = useTheme()\r\n  const picNum = picName === \"local\" ? picArr.length : Number(picName.split(\"_\")[1])\r\n  const imgArr = picArr\r\n\r\n\r\n\r\n  const [photoIndex, setPhotoIndex] = useState(0)\r\n  const [isOpen, setIsOpen] = useState(false)\r\n\r\n  if (picNum === 1) {\r\n\r\n    const images = picName === \"local\"\r\n      ? [imgArr[0].localUrl]\r\n      : [`${url}/picture/downloadpicture/${picName}_0`]\r\n\r\n\r\n    return (\r\n\r\n\r\n\r\n      <div style={{\r\n\r\n        position: \"relative\",\r\n        width: \"100%\",\r\n        height: 0,\r\n        paddingBottom: \"56.25%\",\r\n\r\n        backgroundRepeat: \"no-repeat\",\r\n        backgroundPositionX: \"center\",\r\n        backgroundPositionY: \"center\",\r\n        backgroundSize: \"cover\",\r\n        backgroundImage: picName === \"local\" ? \"url(\" + imgArr[0].localUrl + \")\" : `url(${url}/picture/downloadpicture/${picName}_0)`,\r\n\r\n        backgroundColor: theme.palette.divider,   //\"skyblue\",\r\n        overflow: \"hidden\",\r\n\r\n      }} onClick={function () {\r\n\r\n        setIsOpen(true)\r\n\r\n\r\n      }} >\r\n        {isOpen && <Lightbox\r\n          mainSrc={images[photoIndex]}\r\n          nextSrc={images[(photoIndex + 1) % images.length]}\r\n          prevSrc={images[(photoIndex + images.length - 1) % images.length]}\r\n          onCloseRequest={() => setIsOpen(false)}\r\n          onMovePrevRequest={() =>\r\n            setPhotoIndex(\r\n              pre => (pre + images.length - 1) % images.length,\r\n            )\r\n          }\r\n          onMoveNextRequest={() =>\r\n            setPhotoIndex(\r\n              pre => (pre + images.length + 1) % images.length,\r\n            )\r\n          }\r\n        />}\r\n      </div>\r\n\r\n\r\n\r\n    )\r\n  }\r\n  else if (picNum === 2) {\r\n\r\n    const images = picName === \"local\"\r\n      ? [imgArr[0].localUrl, imgArr[1].localUrl]\r\n      : [`${url}/picture/downloadpicture/${picName}_0`, `${url}/picture/downloadpicture/${picName}_1`]\r\n\r\n\r\n    return (\r\n\r\n\r\n\r\n      <div style={{\r\n        position: \"relative\",\r\n        width: \"100%\",\r\n        height: 0,\r\n        paddingBottom: \"56.25%\",\r\n        backgroundPositionX: \"center\",\r\n        backgroundPositionY: \"center\",\r\n        backgroundColor: theme.palette.divider,   //\"skyblue\",\r\n        overflow: \"hidden\",\r\n        //    padding:0,\r\n\r\n      }}>\r\n\r\n\r\n        <div style={{\r\n          position: \"absolute\",\r\n          width: \"50%\",\r\n          height: \"100%\",\r\n          //  paddingBottom: \"25%\",//  \"112.5%\", \r\n          backgroundColor: \"pink\",\r\n          left: \"0%\",\r\n          top: \"0%\",\r\n          backgroundRepeat: \"no-repeat\",\r\n          overflow: \"hidden\",\r\n          backgroundPositionX: \"center\",\r\n          backgroundPositionY: \"center\",\r\n          backgroundSize: \"cover\",\r\n          //  backgroundImage: \"url(\" + imgArr[0].localUrl + \")\",\r\n          backgroundImage: picName === \"local\" ? \"url(\" + imgArr[0].localUrl + \")\" : `url(${url}/picture/downloadpicture/${picName}_0)`,\r\n          transform: \"translateX(-1px) translateY(0px)\",\r\n          backgroundColor: \"wheat\",\r\n        }}\r\n          onClick={function () {\r\n            setPhotoIndex(0)\r\n            setIsOpen(true)\r\n            //    setPicArr(pre => [pre[1]])\r\n          }}\r\n\r\n        />\r\n        <div style={{\r\n          position: \"absolute\",\r\n          width: \"50%\",\r\n          height: \"100%\",\r\n          //  paddingBottom: \"25%\",//  \"112.5%\", \r\n          backgroundColor: \"wheat\",\r\n          left: \"50%\",\r\n          top: \"0%\",\r\n          backgroundRepeat: \"no-repeat\",\r\n          overflow: \"hidden\",\r\n          backgroundPositionX: \"center\",\r\n          backgroundPositionY: \"center\",\r\n          backgroundSize: \"cover\",\r\n          // backgroundImage: \"url(\" + imgArr[1].localUrl + \")\",\r\n          backgroundImage: picName === \"local\" ? \"url(\" + imgArr[1].localUrl + \")\" : `url(${url}/picture/downloadpicture/${picName}_1)`,\r\n\r\n          transform: \"translateX(1px) translateY(0px)\",\r\n          backgroundColor: \"wheat\",\r\n        }}\r\n          onClick={function () {\r\n            //    setPicArr(pre => [pre[0]])\r\n            setPhotoIndex(1)\r\n            setIsOpen(true)\r\n          }}\r\n        />\r\n\r\n\r\n        {isOpen && <Lightbox\r\n          mainSrc={images[photoIndex]}\r\n          nextSrc={images[(photoIndex + 1) % images.length]}\r\n          prevSrc={images[(photoIndex + images.length - 1) % images.length]}\r\n          onCloseRequest={() => setIsOpen(false)}\r\n          onMovePrevRequest={() =>\r\n            setPhotoIndex(\r\n              pre => (pre + images.length - 1) % images.length,\r\n            )\r\n          }\r\n          onMoveNextRequest={() =>\r\n            setPhotoIndex(\r\n              pre => (pre + images.length + 1) % images.length,\r\n            )\r\n          }\r\n        />}\r\n\r\n\r\n      </div>\r\n\r\n    )\r\n  }\r\n  else if (picNum === 3) {\r\n\r\n    const images = picName === \"local\"\r\n      ? [imgArr[0].localUrl, imgArr[1].localUrl, imgArr[2].localUrl]\r\n      : [`${url}/picture/downloadpicture/${picName}_0`, `${url}/picture/downloadpicture/${picName}_1`, `${url}/picture/downloadpicture/${picName}_2`]\r\n\r\n    return (\r\n\r\n\r\n\r\n      <div style={{\r\n        position: \"relative\",\r\n        width: \"100%\",\r\n        height: 0,\r\n        paddingBottom: \"56.25%\",\r\n        backgroundPositionX: \"center\",\r\n        backgroundPositionY: \"center\",\r\n        backgroundColor: theme.palette.divider,   //\"skyblue\",\r\n        overflow: \"hidden\",\r\n        //    padding:0,\r\n      }}>\r\n\r\n\r\n        <div style={{\r\n          position: \"absolute\",\r\n          width: \"50%\",\r\n          height: \"100%\",\r\n          //  paddingBottom: \"25%\",//  \"112.5%\", \r\n          backgroundColor: \"pink\",\r\n          left: \"0%\",\r\n          top: \"0%\",\r\n          backgroundRepeat: \"no-repeat\",\r\n          overflow: \"hidden\",\r\n          backgroundPositionX: \"center\",\r\n          backgroundPositionY: \"center\",\r\n          backgroundSize: \"cover\",\r\n          //  backgroundImage: \"url(\" + imgArr[0].localUrl + \")\",\r\n          backgroundImage: picName === \"local\" ? \"url(\" + imgArr[0].localUrl + \")\" : `url(${url}/picture/downloadpicture/${picName}_0)`,\r\n\r\n          transform: \"translateX(-1px) translateY(0px)\",\r\n          backgroundColor: \"wheat\",\r\n        }}\r\n          onClick={function () {\r\n            //    setPicArr(pre => [pre[1], pre[2]])\r\n            setPhotoIndex(0)\r\n            setIsOpen(true)\r\n          }}\r\n\r\n        />\r\n        <div style={{\r\n          position: \"absolute\",\r\n          width: \"50%\",\r\n          height: \"50%\",\r\n          backgroundColor: \"wheat\",\r\n          left: \"50%\",\r\n          top: \"0%\",\r\n          backgroundRepeat: \"no-repeat\",\r\n          overflow: \"hidden\",\r\n          backgroundPositionX: \"center\",\r\n          backgroundPositionY: \"center\",\r\n          backgroundSize: \"cover\",\r\n          // backgroundImage: \"url(\" + imgArr[1].localUrl + \")\",\r\n          backgroundImage: picName === \"local\" ? \"url(\" + imgArr[1].localUrl + \")\" : `url(${url}/picture/downloadpicture/${picName}_1)`,\r\n          transform: \"translateX(1px) translateY(-1px)\",\r\n\r\n\r\n        }} onClick={\r\n          function () {\r\n            //   setPicArr(pre => [pre[0], pre[2]])\r\n            setPhotoIndex(1)\r\n            setIsOpen(true)\r\n          }} />\r\n\r\n        <div style={{\r\n          position: \"absolute\",\r\n          width: \"50%\",\r\n          height: \"50%\",\r\n          backgroundColor: \"wheat\",\r\n          left: \"50%\",\r\n          top: \"50%\",\r\n          backgroundRepeat: \"no-repeat\",\r\n          overflow: \"hidden\",\r\n          backgroundPositionX: \"center\",\r\n          backgroundPositionY: \"center\",\r\n          backgroundSize: \"cover\",\r\n          //   backgroundImage: \"url(\" + imgArr[2].localUrl + \")\",\r\n          backgroundImage: picName === \"local\" ? \"url(\" + imgArr[2].localUrl + \")\" : `url(${url}/picture/downloadpicture/${picName}_2)`,\r\n          transform: \"translateX(1px) translateY(1px)\",\r\n\r\n        }} onClick={\r\n          function () {\r\n            //   setPicArr(pre => [pre[0], pre[1]])\r\n            setPhotoIndex(2)\r\n            setIsOpen(true)\r\n          }} />\r\n\r\n        {isOpen && <Lightbox\r\n          mainSrc={images[photoIndex]}\r\n          nextSrc={images[(photoIndex + 1) % images.length]}\r\n          prevSrc={images[(photoIndex + images.length - 1) % images.length]}\r\n          onCloseRequest={() => setIsOpen(false)}\r\n          onMovePrevRequest={() =>\r\n            setPhotoIndex(\r\n              pre => (pre + images.length - 1) % images.length,\r\n            )\r\n          }\r\n          onMoveNextRequest={() =>\r\n            setPhotoIndex(\r\n              pre => (pre + images.length + 1) % images.length,\r\n            )\r\n          }\r\n        />}\r\n\r\n\r\n      </div>\r\n\r\n\r\n\r\n    )\r\n  }\r\n\r\n  else {\r\n\r\n\r\n    const images = picName === \"local\"\r\n      ? [imgArr[0].localUrl, imgArr[1].localUrl, imgArr[2].localUrl, imgArr[3].localUrl]\r\n      : [`${url}/picture/downloadpicture/${picName}_0`, `${url}/picture/downloadpicture/${picName}_1`, `${url}/picture/downloadpicture/${picName}_2`, `${url}/picture/downloadpicture/${picName}_3`]\r\n\r\n\r\n    return (\r\n\r\n\r\n      <div style={{\r\n        position: \"relative\",\r\n        width: \"100%\",\r\n        height: 0,\r\n        paddingBottom: \"56.25%\",\r\n        backgroundPositionX: \"center\",\r\n        backgroundPositionY: \"center\",\r\n        backgroundColor: theme.palette.divider,   //\"skyblue\",\r\n        overflow: \"hidden\",\r\n        //   padding:0,\r\n      }}>\r\n\r\n\r\n        <div style={{\r\n          position: \"absolute\",\r\n          width: \"50%\",\r\n          height: \"50%\",\r\n          backgroundColor: \"wheat\",\r\n          top: \"0%\",\r\n          left: \"0%\",\r\n          backgroundRepeat: \"no-repeat\",\r\n          overflow: \"hidden\",\r\n          backgroundPositionX: \"center\",\r\n          backgroundPositionY: \"center\",\r\n          backgroundSize: \"cover\",\r\n          // backgroundImage: \"url(\" + imgArr[0].localUrl + \")\",\r\n          backgroundImage: picName === \"local\" ? \"url(\" + imgArr[0].localUrl + \")\" : `url(${url}/picture/downloadpicture/${picName}_0)`,\r\n\r\n          transform: \"translateX(-1px) translateY(-1px)\",\r\n\r\n        }} onClick={function () {\r\n          //  setPicArr(pre => [pre[1], pre[2], pre[3]])\r\n          setPhotoIndex(0)\r\n          setIsOpen(true)\r\n        }} />\r\n\r\n        <div style={{\r\n          position: \"absolute\",\r\n          width: \"50%\",\r\n          height: \"50%\",\r\n          backgroundColor: \"wheat\",\r\n          top: \"0%\",\r\n          left: \"50%\",\r\n          backgroundRepeat: \"no-repeat\",\r\n          overflow: \"hidden\",\r\n          backgroundPositionX: \"center\",\r\n          backgroundPositionY: \"center\",\r\n          backgroundSize: \"cover\",\r\n          //   backgroundImage: \"url(\" + imgArr[1].localUrl + \")\",\r\n          backgroundImage: picName === \"local\" ? \"url(\" + imgArr[1].localUrl + \")\" : `url(${url}/picture/downloadpicture/${picName}_1)`,\r\n          transform: \"translateX(1px) translateY(-1px)\",\r\n\r\n        }} onClick={function () {\r\n          //   setPicArr(pre => [pre[0], pre[2], pre[3]])\r\n          setPhotoIndex(1)\r\n          setIsOpen(true)\r\n        }} />\r\n\r\n        <div style={{\r\n          position: \"absolute\",\r\n          width: \"50%\",\r\n          height: \"50%\",\r\n          backgroundColor: \"wheat\",\r\n          top: \"50%\",\r\n          left: \"0%\",\r\n          backgroundRepeat: \"no-repeat\",\r\n          overflow: \"hidden\",\r\n          backgroundPositionX: \"center\",\r\n          backgroundPositionY: \"center\",\r\n          backgroundSize: \"cover\",\r\n          //    backgroundImage: \"url(\" + imgArr[2].localUrl + \")\",\r\n          backgroundImage: picName === \"local\" ? \"url(\" + imgArr[2].localUrl + \")\" : `url(${url}/picture/downloadpicture/${picName}_2)`,\r\n          transform: \"translateX(-1px) translateY(1px)\",\r\n        }}\r\n          onClick={\r\n            function () {\r\n              //      setPicArr(pre => [pre[0], pre[1], pre[3]])\r\n              setPhotoIndex(2)\r\n              setIsOpen(true)\r\n            }}\r\n        />\r\n\r\n        <div style={{\r\n          position: \"absolute\",\r\n          width: \"50%\",\r\n          height: \"50%\",\r\n          backgroundColor: \"wheat\",\r\n          top: \"50%\",\r\n          left: \"50%\",\r\n          backgroundRepeat: \"no-repeat\",\r\n          overflow: \"hidden\",\r\n          backgroundPositionX: \"center\",\r\n          backgroundPositionY: \"center\",\r\n          backgroundSize: \"cover\",\r\n          //   backgroundImage: \"url(\" + imgArr[3].localUrl + \")\",\r\n          backgroundImage: picName === \"local\" ? \"url(\" + imgArr[3].localUrl + \")\" : `url(${url}/picture/downloadpicture/${picName}_3)`,\r\n          transform: \"translateX(1px) translateY(1px)\",\r\n\r\n        }} onClick={\r\n          function () {\r\n            //   setPicArr(pre => [pre[1], pre[2], pre[3]])\r\n            setPhotoIndex(3)\r\n            setIsOpen(true)\r\n          }} />\r\n        {isOpen && <Lightbox\r\n          mainSrc={images[photoIndex]}\r\n          nextSrc={images[(photoIndex + 1) % images.length]}\r\n          prevSrc={images[(photoIndex + images.length - 1) % images.length]}\r\n          onCloseRequest={() => setIsOpen(false)}\r\n          onMovePrevRequest={() =>\r\n            setPhotoIndex(\r\n              pre => (pre + images.length - 1) % images.length,\r\n            )\r\n          }\r\n          onMoveNextRequest={() =>\r\n            setPhotoIndex(\r\n              pre => (pre + images.length + 1) % images.length,\r\n            )\r\n          }\r\n        />}\r\n\r\n      </div>\r\n\r\n\r\n\r\n\r\n\r\n    )\r\n\r\n\r\n\r\n  }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n}\r\n\r\nfunction LinkTag({ toHtml, node, index, imgArr, ...props }) {\r\n\r\n  const theme = useTheme()\r\n  const host = node.attribs.linkhost;\r\n  const address = node.attribs.linkaddress;\r\n\r\n\r\n\r\n  const [content, setContent] = useState(host.substr(1))\r\n\r\n  const arr = [];\r\n  node.children.forEach((element, index) => {\r\n    arr.push(convertNodeToElement(element))\r\n  })\r\n\r\n  return (\r\n    <span\r\n      target=\"_blank\"\r\n      //  key={index}\r\n      style={{\r\n        color: theme.palette.primary.main,\r\n        cursor: \"pointer\"\r\n      }}\r\n      onClick={function (e) {\r\n        e.stopPropagation()\r\n        setContent(\r\n          <Link href={address} target=\"_blank\" rel=\"noopener\">\r\n            {arr.map((element, index) => {\r\n              //    if (reactElementToJSXString(element) === \"<br>\") { return <></> }\r\n              return element\r\n            })}\r\n          </Link>\r\n        )\r\n\r\n      }}\r\n    >\r\n      <span key={index}>{content}</span>\r\n    </span>\r\n\r\n\r\n\r\n\r\n  )\r\n}\r\n\r\nfunction BackColorTag({ backimage, textcolor, transformFn, node, index, arr, arr2, inView, ...props }) {\r\n\r\n  const [isOverFlow, setIsOverFlow] = useState(false)\r\n  //console.log(backImage)\r\n  return (\r\n    <DetectableOverflow\r\n\r\n      onChange={function (overFlow) {\r\n        setIsOverFlow(overFlow)\r\n      }}\r\n\r\n      key={index}\r\n      style={{\r\n        // backgroundImage: \"url(https://mernchen.herokuapp.com/api/picture/download/60a204e70270cc001728285f)\",\r\n        // backgroundImage: \"url(https://mernchen.herokuapp.com/api/picture/download/60a2062e95f2250017420aa4)\",\r\n        // backgroundImage: \"url(https://mernchen.herokuapp.com/api/picture/download/60b701a9dc07780017dcfd38)\",\r\n        ...inView && { backgroundImage: backimage },\r\n        color: textcolor,\r\n        //  backgroundImage: \"url(https://mernchen.herokuapp.com/api/picture/download/60b6f77fae1acf0017a96c4b)\",\r\n\r\n\r\n        //  backgroundImage: \"url(https://picsum.photos/800/450)\",\r\n        backgroundSize: \"cover\",\r\n        position: \"relative\",\r\n\r\n        backgroundColor: \"wheat\",\r\n        //  width: \"100%\",\r\n        height: 0,\r\n\r\n        paddingBottom: \"56.25%\",\r\n        display: \"flex\",\r\n        alignItems: isOverFlow ? \"flex-start\" : \"center\",\r\n        justifyContent: \"center\",\r\n        overflow: \"auto\",\r\n\r\n      }}\r\n    >\r\n\r\n      <div style={{\r\n        textAlign: \"center\",\r\n        position: isOverFlow ? \"block\" : \"absolute\",\r\n        ...!isOverFlow && { top: \"50%\" },\r\n        ...!isOverFlow && { transform: \"translateY(-50%)\" },\r\n        // color: \"white\",\r\n\r\n        padding: \"8px\",\r\n        whiteSpace: \"pre-wrap\"\r\n      }}>\r\n\r\n        {arr.map((item, index) => {\r\n\r\n          if (item.name === \"span\") {\r\n            item.children = item.children.filter(item => {\r\n              return item.name !== \"br\"\r\n            })\r\n            return convertNodeToElement(item)\r\n          }\r\n\r\n\r\n          if (item.type !== \"tag\") { return <span key={index}>{item}</span> }\r\n          else if (item.name === \"span\") {\r\n            return arr2[index]\r\n          }\r\n          else {\r\n            return <span key={index} >{transformFn(item, index)}</span>\r\n          }\r\n\r\n\r\n        })}\r\n\r\n      </div>\r\n    </DetectableOverflow>\r\n  )\r\n\r\n\r\n}","import logo from './logo.svg';\nimport './App.css';\n\nimport CssBaseline from '@material-ui/core/CssBaseline';\nimport DraftEditor from \"./DraftEditor\";\nimport { Typography, Button, ButtonGroup, Container, Paper, Box, Avatar, Grid } from \"@material-ui/core\";\nimport Content from \"./Content\";\n\n\nimport DetectableOverflow from 'react-detectable-overflow';\nimport { useEffect, useState, useContext } from 'react';\n\n\nimport { useInView } from 'react-intersection-observer';\nimport { Context } from \"./ContextProvider\"\n\nfunction App() {\n\n  const { getSinglePost } = useContext(Context);\n\n  // const { ref, inView, entry } = useInView({\n  //   /* Optional options */\n  //   threshold: 0.8,\n  //   triggerOnce: false,\n  //   initialInView: true,\n  // });\n\n  // useEffect(function(){\n  //   if(inView){\n  //     getSinglePost()\n  //   }\n\n  // })\n\n\n  //console.log(entry)\n\n  return (\n\n    <>\n      <CssBaseline />\n\n\n      <Grid container\n        direction=\"row\"\n        justifyContent=\"space-around\"\n        alignItems=\"flex-start\"\n        spacing={0}\n      >\n        <Grid item xs={12} sm={12} md={10} lg={6} xl={6} >\n\n          <DraftEditor />\n        </Grid>\n\n      </Grid>\n\n      {/* <div style={{ margin: \"0px\" }} /> */}\n\n\n\n      <Content />\n\n\n      {/* <div style={{ margin: \"auto\", backgroundColor: \"pink\", width: \"200px\", height: \"30px\" }} ref={ref}>{inView + \"\"}</div> */}\n\n    </>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\n\nimport ContextProvider from \"./ContextProvider\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <ContextProvider>\n      <App />\n    </ContextProvider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n\nreportWebVitals();\n"],"sourceRoot":""}